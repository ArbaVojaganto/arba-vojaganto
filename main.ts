
  const html = `

  
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <!--
      <link rel="stylesheet" href="stylesheet.css">
    -->
    <style>

      /* reset.css begin */

      /* http://meyerweb.com/eric/tools/css/reset/ 
         v2.0 | 20110126
         License: none (public domain)
      */

      html, body, div, span, applet, object, iframe,
      h1, h2, h3, h4, h5, h6, p, blockquote, pre,
      a, abbr, acronym, address, big, cite, code,
      del, dfn, em, img, ins, kbd, q, s, samp,
      small, strike, strong, sub, sup, tt, var,
      b, u, i, center,
      dl, dt, dd, ol, ul, li,
      fieldset, form, label, legend,
      table, caption, tbody, tfoot, thead, tr, th, td,
      article, aside, canvas, details, embed, 
      figure, figcaption, footer, header, hgroup, 
      menu, nav, output, ruby, section, summary,
      time, mark, audio, video {
      	margin: 0;
      	padding: 0;
      	border: 0;
      	font-size: 100%;
      	font: inherit;
      	vertical-align: baseline;
      }
      /* HTML5 display-role reset for older browsers */
      article, aside, details, figcaption, figure, 
      footer, header, hgroup, menu, nav, section {
      	display: block;
      }
      body {
      	line-height: 1;
      }
      ol, ul {
      	list-style: none;
      }
      blockquote, q {
      	quotes: none;
      }
      blockquote:before, blockquote:after,
      q:before, q:after {
      	content: '';
      	content: none;
      }
      table {
      	border-collapse: collapse;
      	border-spacing: 0;
      }
      /* reset.css end */




    body {
      overflow: hidden;
      margin: 0;
      border: 0;
      background-color: white;
    }

    #network-graph {
      position: relative;
      display: flex;
      justify-content: space-between;
    }

    #network-graph-canvas {
      position: absolute;
      z-index: 3;
    }

    #network-graph-global-menu {
      z-index:4;
    }

    #file-uploader{
      background-color: #f4f4f4;
      margin: 10px;
      padding: 10px;
      border: #ddd dashed 5px;
      min-height: 200px;
      text-align: center;
      display: grid;
    }
    #dragDropArea p{
        color: #999;
        font-weight: bold;
        font-size: 14px;
        font-size: 1.4em;
    }
    #dragDropArea .drag-drop-buttons{
        margin-top: 20px;
        font-size: 12px;
        font-size: 1.2em;
    }
    .drag-drop-buttons input{
        margin: auto;
    }

    img.uploaderPreview {
      width: 300px;
      height: 300px;
    }

    img.thumbnail {
      width: 500px; height: 500px;
      object-fit: contain;
    }


    #network-graph-local-menu {
      z-index: 5;
    }

    .node-detail {
      z-index: 5;
      display: grid;
    }

    .accordion-child {
      margin-left: 1em;
    }

    #open,
    #close {
      cursor:pointer;
      background: black;
      color: white;
    }

    #mask {
      background: rgba(0, 0, 0, 0.4);
      position: fixed;
      top: 0;
      bottom: 0;
      right: 0;
      left: 0;
      z-index: 10;
    }

    #modal {
      background: #fff;
      color: #555;
      width: 900px;
      height: 900px;
      padding: 40px;
      border-radius: 4px;
      position: absolute;
      top: 40px;
      left: 0;
      right: 0;
      margin: 0 auto;
      z-index: 11;
      transition: 0.4s;
    }

    #modal p {
      margin: 0 0 20px;
    } 

    #mask.hidden {
      display: none;
    }

    #modal.hidden {
      transform: translate(0, -1200px);
    }

    #modal iframe{
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    }


    #select-file {
      z-index: 12;
    }


    .accordion ul {
    	list-style: none;
    	margin:0;
    }
    label{
    	cursor: pointer;
    }
    .toggle{
      z-index: 12;
    }
    .toggle + ul{
    	max-height: 0;
    	overflow: hidden;
    	/*max-height: 500px;
    	transition: all .5s ease;
      */
    }
    .toggle:checked + ul{
      max-height: 1000px;
    	/*
    	transition: all 2s ease-in;
      */
    }

    .three-canvas {
      position: absolute;
      z-index: 2;
    }

    </style>

</head>

<body>

  <div id="mask" class="hidden"></div>
  <div id="modal" class="hidden"></div>

  <div id="network-graph">
  </div>

  <script>
    remoteStorageURL = "https://raw.githubusercontent.com/ArbaVojaganto/arba-vojaganto/main/"
  </script>
  <script src="data:text/plain;base64,Y29uc3QgSEVYX0NIQVJTID0gIjAxMjM0NTY3ODlhYmNkZWYiLnNwbGl0KCIiKTsKY29uc3QgRVhUUkEgPSBbCiAgICAtMjE0NzQ4MzY0OCwKICAgIDgzODg2MDgsCiAgICAzMjc2OCwKICAgIDEyOApdOwpjb25zdCBTSElGVCA9IFsKICAgIDI0LAogICAgMTYsCiAgICA4LAogICAgMApdOwpjb25zdCBLID0gWwogICAgMTExNjM1MjQwOCwKICAgIDE4OTk0NDc0NDEsCiAgICAzMDQ5MzIzNDcxLAogICAgMzkyMTAwOTU3MywKICAgIDk2MTk4NzE2MywKICAgIDE1MDg5NzA5OTMsCiAgICAyNDUzNjM1NzQ4LAogICAgMjg3MDc2MzIyMSwKICAgIDM2MjQzODEwODAsCiAgICAzMTA1OTg0MDEsCiAgICA2MDcyMjUyNzgsCiAgICAxNDI2ODgxOTg3LAogICAgMTkyNTA3ODM4OCwKICAgIDIxNjIwNzgyMDYsCiAgICAyNjE0ODg4MTAzLAogICAgMzI0ODIyMjU4MCwKICAgIDM4MzUzOTA0MDEsCiAgICA0MDIyMjI0Nzc0LAogICAgMjY0MzQ3MDc4LAogICAgNjA0ODA3NjI4LAogICAgNzcwMjU1OTgzLAogICAgMTI0OTE1MDEyMiwKICAgIDE1NTUwODE2OTIsCiAgICAxOTk2MDY0OTg2LAogICAgMjU1NDIyMDg4MiwKICAgIDI4MjE4MzQzNDksCiAgICAyOTUyOTk2ODA4LAogICAgMzIxMDMxMzY3MSwKICAgIDMzMzY1NzE4OTEsCiAgICAzNTg0NTI4NzExLAogICAgMTEzOTI2OTkzLAogICAgMzM4MjQxODk1LAogICAgNjY2MzA3MjA1LAogICAgNzczNTI5OTEyLAogICAgMTI5NDc1NzM3MiwKICAgIDEzOTYxODIyOTEsCiAgICAxNjk1MTgzNzAwLAogICAgMTk4NjY2MTA1MSwKICAgIDIxNzcwMjYzNTAsCiAgICAyNDU2OTU2MDM3LAogICAgMjczMDQ4NTkyMSwKICAgIDI4MjAzMDI0MTEsCiAgICAzMjU5NzMwODAwLAogICAgMzM0NTc2NDc3MSwKICAgIDM1MTYwNjU4MTcsCiAgICAzNjAwMzUyODA0LAogICAgNDA5NDU3MTkwOSwKICAgIDI3NTQyMzM0NCwKICAgIDQzMDIyNzczNCwKICAgIDUwNjk0ODYxNiwKICAgIDY1OTA2MDU1NiwKICAgIDg4Mzk5Nzg3NywKICAgIDk1ODEzOTU3MSwKICAgIDEzMjI4MjIyMTgsCiAgICAxNTM3MDAyMDYzLAogICAgMTc0Nzg3Mzc3OSwKICAgIDE5NTU1NjIyMjIsCiAgICAyMDI0MTA0ODE1LAogICAgMjIyNzczMDQ1MiwKICAgIDIzNjE4NTI0MjQsCiAgICAyNDI4NDM2NDc0LAogICAgMjc1NjczNDE4NywKICAgIDMyMDQwMzE0NzksCiAgICAzMzI5MzI1Mjk4LCAKXTsKY29uc3QgYmxvY2tzID0gW107CmNsYXNzIFNoYTI1NiB7CiAgICAjYmxvY2s7CiAgICAjYmxvY2tzOwogICAgI2J5dGVzOwogICAgI2ZpbmFsaXplZDsKICAgICNmaXJzdDsKICAgICNoMDsKICAgICNoMTsKICAgICNoMjsKICAgICNoMzsKICAgICNoNDsKICAgICNoNTsKICAgICNoNjsKICAgICNoNzsKICAgICNoYXNoZWQ7CiAgICAjaEJ5dGVzOwogICAgI2lzMjI0OwogICAgI2xhc3RCeXRlSW5kZXggPSAwOwogICAgI3N0YXJ0OwogICAgY29uc3RydWN0b3IoaXMyMjQxID0gZmFsc2UsIHNoYXJlZE1lbW9yeTEgPSBmYWxzZSl7CiAgICAgICAgdGhpcy5pbml0KGlzMjI0MSwgc2hhcmVkTWVtb3J5MSk7CiAgICB9CiAgICBpbml0KGlzMjI0LCBzaGFyZWRNZW1vcnkpIHsKICAgICAgICBpZiAoc2hhcmVkTWVtb3J5KSB7CiAgICAgICAgICAgIGJsb2Nrc1swXSA9IGJsb2Nrc1sxNl0gPSBibG9ja3NbMV0gPSBibG9ja3NbMl0gPSBibG9ja3NbM10gPSBibG9ja3NbNF0gPSBibG9ja3NbNV0gPSBibG9ja3NbNl0gPSBibG9ja3NbN10gPSBibG9ja3NbOF0gPSBibG9ja3NbOV0gPSBibG9ja3NbMTBdID0gYmxvY2tzWzExXSA9IGJsb2Nrc1sxMl0gPSBibG9ja3NbMTNdID0gYmxvY2tzWzE0XSA9IGJsb2Nrc1sxNV0gPSAwOwogICAgICAgICAgICB0aGlzLiNibG9ja3MgPSBibG9ja3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy4jYmxvY2tzID0gWwogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzMjI0KSB7CiAgICAgICAgICAgIHRoaXMuI2gwID0gMzIzODM3MTAzMjsKICAgICAgICAgICAgdGhpcy4jaDEgPSA5MTQxNTA2NjM7CiAgICAgICAgICAgIHRoaXMuI2gyID0gODEyNzAyOTk5OwogICAgICAgICAgICB0aGlzLiNoMyA9IDQxNDQ5MTI2OTc7CiAgICAgICAgICAgIHRoaXMuI2g0ID0gNDI5MDc3NTg1NzsKICAgICAgICAgICAgdGhpcy4jaDUgPSAxNzUwNjAzMDI1OwogICAgICAgICAgICB0aGlzLiNoNiA9IDE2OTQwNzY4Mzk7CiAgICAgICAgICAgIHRoaXMuI2g3ID0gMzIwNDA3NTQyODsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLiNoMCA9IDE3NzkwMzM3MDM7CiAgICAgICAgICAgIHRoaXMuI2gxID0gMzE0NDEzNDI3NzsKICAgICAgICAgICAgdGhpcy4jaDIgPSAxMDEzOTA0MjQyOwogICAgICAgICAgICB0aGlzLiNoMyA9IDI3NzM0ODA3NjI7CiAgICAgICAgICAgIHRoaXMuI2g0ID0gMTM1OTg5MzExOTsKICAgICAgICAgICAgdGhpcy4jaDUgPSAyNjAwODIyOTI0OwogICAgICAgICAgICB0aGlzLiNoNiA9IDUyODczNDYzNTsKICAgICAgICAgICAgdGhpcy4jaDcgPSAxNTQxNDU5MjI1OwogICAgICAgIH0KICAgICAgICB0aGlzLiNibG9jayA9IHRoaXMuI3N0YXJ0ID0gdGhpcy4jYnl0ZXMgPSB0aGlzLiNoQnl0ZXMgPSAwOwogICAgICAgIHRoaXMuI2ZpbmFsaXplZCA9IHRoaXMuI2hhc2hlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuI2ZpcnN0ID0gdHJ1ZTsKICAgICAgICB0aGlzLiNpczIyNCA9IGlzMjI0OwogICAgfQogICAgdXBkYXRlKG1lc3NhZ2UpIHsKICAgICAgICBpZiAodGhpcy4jZmluYWxpemVkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBsZXQgbXNnOwogICAgICAgIGlmIChtZXNzYWdlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsKICAgICAgICAgICAgbXNnID0gbmV3IFVpbnQ4QXJyYXkobWVzc2FnZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbXNnID0gbWVzc2FnZTsKICAgICAgICB9CiAgICAgICAgbGV0IGluZGV4ID0gMDsKICAgICAgICBjb25zdCBsZW5ndGggPSBtc2cubGVuZ3RoOwogICAgICAgIGNvbnN0IGJsb2NrczEgPSB0aGlzLiNibG9ja3M7CiAgICAgICAgd2hpbGUoaW5kZXggPCBsZW5ndGgpewogICAgICAgICAgICBsZXQgaTsKICAgICAgICAgICAgaWYgKHRoaXMuI2hhc2hlZCkgewogICAgICAgICAgICAgICAgdGhpcy4jaGFzaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBibG9ja3MxWzBdID0gdGhpcy4jYmxvY2s7CiAgICAgICAgICAgICAgICBibG9ja3MxWzE2XSA9IGJsb2NrczFbMV0gPSBibG9ja3MxWzJdID0gYmxvY2tzMVszXSA9IGJsb2NrczFbNF0gPSBibG9ja3MxWzVdID0gYmxvY2tzMVs2XSA9IGJsb2NrczFbN10gPSBibG9ja3MxWzhdID0gYmxvY2tzMVs5XSA9IGJsb2NrczFbMTBdID0gYmxvY2tzMVsxMV0gPSBibG9ja3MxWzEyXSA9IGJsb2NrczFbMTNdID0gYmxvY2tzMVsxNF0gPSBibG9ja3MxWzE1XSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBtc2cgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICBmb3IoaSA9IHRoaXMuI3N0YXJ0OyBpbmRleCA8IGxlbmd0aCAmJiBpIDwgNjQ7ICsraW5kZXgpewogICAgICAgICAgICAgICAgICAgIGJsb2NrczFbaSA+PiAyXSB8PSBtc2dbaW5kZXhdIDw8IFNISUZUWyhpKyspICYgM107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IoaSA9IHRoaXMuI3N0YXJ0OyBpbmRleCA8IGxlbmd0aCAmJiBpIDwgNjQ7ICsraW5kZXgpewogICAgICAgICAgICAgICAgICAgIGxldCBjb2RlID0gbXNnLmNoYXJDb2RlQXQoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGlmIChjb2RlIDwgMTI4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrczFbaSA+PiAyXSB8PSBjb2RlIDw8IFNISUZUWyhpKyspICYgM107CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlIDwgMjA0OCkgewogICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MxW2kgPj4gMl0gfD0gKDE5MiB8IGNvZGUgPj4gNikgPDwgU0hJRlRbKGkrKykgJiAzXTsKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzMVtpID4+IDJdIHw9ICgxMjggfCBjb2RlICYgNjMpIDw8IFNISUZUWyhpKyspICYgM107CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlIDwgNTUyOTYgfHwgY29kZSA+PSA1NzM0NCkgewogICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MxW2kgPj4gMl0gfD0gKDIyNCB8IGNvZGUgPj4gMTIpIDw8IFNISUZUWyhpKyspICYgM107CiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrczFbaSA+PiAyXSB8PSAoMTI4IHwgY29kZSA+PiA2ICYgNjMpIDw8IFNISUZUWyhpKyspICYgM107CiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrczFbaSA+PiAyXSB8PSAoMTI4IHwgY29kZSAmIDYzKSA8PCBTSElGVFsoaSsrKSAmIDNdOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSA2NTUzNiArICgoY29kZSAmIDEwMjMpIDw8IDEwIHwgbXNnLmNoYXJDb2RlQXQoKytpbmRleCkgJiAxMDIzKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzMVtpID4+IDJdIHw9ICgyNDAgfCBjb2RlID4+IDE4KSA8PCBTSElGVFsoaSsrKSAmIDNdOwogICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MxW2kgPj4gMl0gfD0gKDEyOCB8IGNvZGUgPj4gMTIgJiA2MykgPDwgU0hJRlRbKGkrKykgJiAzXTsKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzMVtpID4+IDJdIHw9ICgxMjggfCBjb2RlID4+IDYgJiA2MykgPDwgU0hJRlRbKGkrKykgJiAzXTsKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzMVtpID4+IDJdIHw9ICgxMjggfCBjb2RlICYgNjMpIDw8IFNISUZUWyhpKyspICYgM107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuI2xhc3RCeXRlSW5kZXggPSBpOwogICAgICAgICAgICB0aGlzLiNieXRlcyArPSBpIC0gdGhpcy4jc3RhcnQ7CiAgICAgICAgICAgIGlmIChpID49IDY0KSB7CiAgICAgICAgICAgICAgICB0aGlzLiNibG9jayA9IGJsb2NrczFbMTZdOwogICAgICAgICAgICAgICAgdGhpcy4jc3RhcnQgPSBpIC0gNjQ7CiAgICAgICAgICAgICAgICB0aGlzLmhhc2goKTsKICAgICAgICAgICAgICAgIHRoaXMuI2hhc2hlZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLiNzdGFydCA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuI2J5dGVzID4gNDI5NDk2NzI5NSkgewogICAgICAgICAgICB0aGlzLiNoQnl0ZXMgKz0gdGhpcy4jYnl0ZXMgLyA0Mjk0OTY3Mjk2IDw8IDA7CiAgICAgICAgICAgIHRoaXMuI2J5dGVzID0gdGhpcy4jYnl0ZXMgJSA0Mjk0OTY3Mjk2OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGZpbmFsaXplKCkgewogICAgICAgIGlmICh0aGlzLiNmaW5hbGl6ZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLiNmaW5hbGl6ZWQgPSB0cnVlOwogICAgICAgIGNvbnN0IGJsb2NrczEgPSB0aGlzLiNibG9ja3M7CiAgICAgICAgY29uc3QgaSA9IHRoaXMuI2xhc3RCeXRlSW5kZXg7CiAgICAgICAgYmxvY2tzMVsxNl0gPSB0aGlzLiNibG9jazsKICAgICAgICBibG9ja3MxW2kgPj4gMl0gfD0gRVhUUkFbaSAmIDNdOwogICAgICAgIHRoaXMuI2Jsb2NrID0gYmxvY2tzMVsxNl07CiAgICAgICAgaWYgKGkgPj0gNTYpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLiNoYXNoZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuaGFzaCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJsb2NrczFbMF0gPSB0aGlzLiNibG9jazsKICAgICAgICAgICAgYmxvY2tzMVsxNl0gPSBibG9ja3MxWzFdID0gYmxvY2tzMVsyXSA9IGJsb2NrczFbM10gPSBibG9ja3MxWzRdID0gYmxvY2tzMVs1XSA9IGJsb2NrczFbNl0gPSBibG9ja3MxWzddID0gYmxvY2tzMVs4XSA9IGJsb2NrczFbOV0gPSBibG9ja3MxWzEwXSA9IGJsb2NrczFbMTFdID0gYmxvY2tzMVsxMl0gPSBibG9ja3MxWzEzXSA9IGJsb2NrczFbMTRdID0gYmxvY2tzMVsxNV0gPSAwOwogICAgICAgIH0KICAgICAgICBibG9ja3MxWzE0XSA9IHRoaXMuI2hCeXRlcyA8PCAzIHwgdGhpcy4jYnl0ZXMgPj4+IDI5OwogICAgICAgIGJsb2NrczFbMTVdID0gdGhpcy4jYnl0ZXMgPDwgMzsKICAgICAgICB0aGlzLmhhc2goKTsKICAgIH0KICAgIGhhc2goKSB7CiAgICAgICAgbGV0IGEgPSB0aGlzLiNoMDsKICAgICAgICBsZXQgYiA9IHRoaXMuI2gxOwogICAgICAgIGxldCBjID0gdGhpcy4jaDI7CiAgICAgICAgbGV0IGQgPSB0aGlzLiNoMzsKICAgICAgICBsZXQgZSA9IHRoaXMuI2g0OwogICAgICAgIGxldCBmID0gdGhpcy4jaDU7CiAgICAgICAgbGV0IGcgPSB0aGlzLiNoNjsKICAgICAgICBsZXQgaCA9IHRoaXMuI2g3OwogICAgICAgIGNvbnN0IGJsb2NrczEgPSB0aGlzLiNibG9ja3M7CiAgICAgICAgbGV0IHMwOwogICAgICAgIGxldCBzMTsKICAgICAgICBsZXQgbWFqOwogICAgICAgIGxldCB0MTsKICAgICAgICBsZXQgdDI7CiAgICAgICAgbGV0IGNoOwogICAgICAgIGxldCBhYjsKICAgICAgICBsZXQgZGE7CiAgICAgICAgbGV0IGNkOwogICAgICAgIGxldCBiYzsKICAgICAgICBmb3IobGV0IGogPSAxNjsgaiA8IDY0OyArK2opewogICAgICAgICAgICB0MSA9IGJsb2NrczFbaiAtIDE1XTsKICAgICAgICAgICAgczAgPSAodDEgPj4+IDcgfCB0MSA8PCAyNSkgXiAodDEgPj4+IDE4IHwgdDEgPDwgMTQpIF4gdDEgPj4+IDM7CiAgICAgICAgICAgIHQxID0gYmxvY2tzMVtqIC0gMl07CiAgICAgICAgICAgIHMxID0gKHQxID4+PiAxNyB8IHQxIDw8IDE1KSBeICh0MSA+Pj4gMTkgfCB0MSA8PCAxMykgXiB0MSA+Pj4gMTA7CiAgICAgICAgICAgIGJsb2NrczFbal0gPSBibG9ja3MxW2ogLSAxNl0gKyBzMCArIGJsb2NrczFbaiAtIDddICsgczEgPDwgMDsKICAgICAgICB9CiAgICAgICAgYmMgPSBiICYgYzsKICAgICAgICBmb3IobGV0IGoxID0gMDsgajEgPCA2NDsgajEgKz0gNCl7CiAgICAgICAgICAgIGlmICh0aGlzLiNmaXJzdCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuI2lzMjI0KSB7CiAgICAgICAgICAgICAgICAgICAgYWIgPSAzMDAwMzI7CiAgICAgICAgICAgICAgICAgICAgdDEgPSBibG9ja3MxWzBdIC0gMTQxMzI1NzgxOTsKICAgICAgICAgICAgICAgICAgICBoID0gdDEgLSAxNTAwNTQ1OTkgPDwgMDsKICAgICAgICAgICAgICAgICAgICBkID0gdDEgKyAyNDE3NzA3NyA8PCAwOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhYiA9IDcwNDc1MTEwOTsKICAgICAgICAgICAgICAgICAgICB0MSA9IGJsb2NrczFbMF0gLSAyMTAyNDQyNDg7CiAgICAgICAgICAgICAgICAgICAgaCA9IHQxIC0gMTUyMTQ4NjUzNCA8PCAwOwogICAgICAgICAgICAgICAgICAgIGQgPSB0MSArIDE0MzY5NDU2NSA8PCAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy4jZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHMwID0gKGEgPj4+IDIgfCBhIDw8IDMwKSBeIChhID4+PiAxMyB8IGEgPDwgMTkpIF4gKGEgPj4+IDIyIHwgYSA8PCAxMCk7CiAgICAgICAgICAgICAgICBzMSA9IChlID4+PiA2IHwgZSA8PCAyNikgXiAoZSA+Pj4gMTEgfCBlIDw8IDIxKSBeIChlID4+PiAyNSB8IGUgPDwgNyk7CiAgICAgICAgICAgICAgICBhYiA9IGEgJiBiOwogICAgICAgICAgICAgICAgbWFqID0gYWIgXiBhICYgYyBeIGJjOwogICAgICAgICAgICAgICAgY2ggPSBlICYgZiBeIH5lICYgZzsKICAgICAgICAgICAgICAgIHQxID0gaCArIHMxICsgY2ggKyBLW2oxXSArIGJsb2NrczFbajFdOwogICAgICAgICAgICAgICAgdDIgPSBzMCArIG1hajsKICAgICAgICAgICAgICAgIGggPSBkICsgdDEgPDwgMDsKICAgICAgICAgICAgICAgIGQgPSB0MSArIHQyIDw8IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgczAgPSAoZCA+Pj4gMiB8IGQgPDwgMzApIF4gKGQgPj4+IDEzIHwgZCA8PCAxOSkgXiAoZCA+Pj4gMjIgfCBkIDw8IDEwKTsKICAgICAgICAgICAgczEgPSAoaCA+Pj4gNiB8IGggPDwgMjYpIF4gKGggPj4+IDExIHwgaCA8PCAyMSkgXiAoaCA+Pj4gMjUgfCBoIDw8IDcpOwogICAgICAgICAgICBkYSA9IGQgJiBhOwogICAgICAgICAgICBtYWogPSBkYSBeIGQgJiBiIF4gYWI7CiAgICAgICAgICAgIGNoID0gaCAmIGUgXiB+aCAmIGY7CiAgICAgICAgICAgIHQxID0gZyArIHMxICsgY2ggKyBLW2oxICsgMV0gKyBibG9ja3MxW2oxICsgMV07CiAgICAgICAgICAgIHQyID0gczAgKyBtYWo7CiAgICAgICAgICAgIGcgPSBjICsgdDEgPDwgMDsKICAgICAgICAgICAgYyA9IHQxICsgdDIgPDwgMDsKICAgICAgICAgICAgczAgPSAoYyA+Pj4gMiB8IGMgPDwgMzApIF4gKGMgPj4+IDEzIHwgYyA8PCAxOSkgXiAoYyA+Pj4gMjIgfCBjIDw8IDEwKTsKICAgICAgICAgICAgczEgPSAoZyA+Pj4gNiB8IGcgPDwgMjYpIF4gKGcgPj4+IDExIHwgZyA8PCAyMSkgXiAoZyA+Pj4gMjUgfCBnIDw8IDcpOwogICAgICAgICAgICBjZCA9IGMgJiBkOwogICAgICAgICAgICBtYWogPSBjZCBeIGMgJiBhIF4gZGE7CiAgICAgICAgICAgIGNoID0gZyAmIGggXiB+ZyAmIGU7CiAgICAgICAgICAgIHQxID0gZiArIHMxICsgY2ggKyBLW2oxICsgMl0gKyBibG9ja3MxW2oxICsgMl07CiAgICAgICAgICAgIHQyID0gczAgKyBtYWo7CiAgICAgICAgICAgIGYgPSBiICsgdDEgPDwgMDsKICAgICAgICAgICAgYiA9IHQxICsgdDIgPDwgMDsKICAgICAgICAgICAgczAgPSAoYiA+Pj4gMiB8IGIgPDwgMzApIF4gKGIgPj4+IDEzIHwgYiA8PCAxOSkgXiAoYiA+Pj4gMjIgfCBiIDw8IDEwKTsKICAgICAgICAgICAgczEgPSAoZiA+Pj4gNiB8IGYgPDwgMjYpIF4gKGYgPj4+IDExIHwgZiA8PCAyMSkgXiAoZiA+Pj4gMjUgfCBmIDw8IDcpOwogICAgICAgICAgICBiYyA9IGIgJiBjOwogICAgICAgICAgICBtYWogPSBiYyBeIGIgJiBkIF4gY2Q7CiAgICAgICAgICAgIGNoID0gZiAmIGcgXiB+ZiAmIGg7CiAgICAgICAgICAgIHQxID0gZSArIHMxICsgY2ggKyBLW2oxICsgM10gKyBibG9ja3MxW2oxICsgM107CiAgICAgICAgICAgIHQyID0gczAgKyBtYWo7CiAgICAgICAgICAgIGUgPSBhICsgdDEgPDwgMDsKICAgICAgICAgICAgYSA9IHQxICsgdDIgPDwgMDsKICAgICAgICB9CiAgICAgICAgdGhpcy4jaDAgPSB0aGlzLiNoMCArIGEgPDwgMDsKICAgICAgICB0aGlzLiNoMSA9IHRoaXMuI2gxICsgYiA8PCAwOwogICAgICAgIHRoaXMuI2gyID0gdGhpcy4jaDIgKyBjIDw8IDA7CiAgICAgICAgdGhpcy4jaDMgPSB0aGlzLiNoMyArIGQgPDwgMDsKICAgICAgICB0aGlzLiNoNCA9IHRoaXMuI2g0ICsgZSA8PCAwOwogICAgICAgIHRoaXMuI2g1ID0gdGhpcy4jaDUgKyBmIDw8IDA7CiAgICAgICAgdGhpcy4jaDYgPSB0aGlzLiNoNiArIGcgPDwgMDsKICAgICAgICB0aGlzLiNoNyA9IHRoaXMuI2g3ICsgaCA8PCAwOwogICAgfQogICAgaGV4KCkgewogICAgICAgIHRoaXMuZmluYWxpemUoKTsKICAgICAgICBjb25zdCBoMCA9IHRoaXMuI2gwOwogICAgICAgIGNvbnN0IGgxID0gdGhpcy4jaDE7CiAgICAgICAgY29uc3QgaDIgPSB0aGlzLiNoMjsKICAgICAgICBjb25zdCBoMyA9IHRoaXMuI2gzOwogICAgICAgIGNvbnN0IGg0ID0gdGhpcy4jaDQ7CiAgICAgICAgY29uc3QgaDUgPSB0aGlzLiNoNTsKICAgICAgICBjb25zdCBoNiA9IHRoaXMuI2g2OwogICAgICAgIGNvbnN0IGg3ID0gdGhpcy4jaDc7CiAgICAgICAgbGV0IGhleCA9IEhFWF9DSEFSU1toMCA+PiAyOCAmIDE1XSArIEhFWF9DSEFSU1toMCA+PiAyNCAmIDE1XSArIEhFWF9DSEFSU1toMCA+PiAyMCAmIDE1XSArIEhFWF9DSEFSU1toMCA+PiAxNiAmIDE1XSArIEhFWF9DSEFSU1toMCA+PiAxMiAmIDE1XSArIEhFWF9DSEFSU1toMCA+PiA4ICYgMTVdICsgSEVYX0NIQVJTW2gwID4+IDQgJiAxNV0gKyBIRVhfQ0hBUlNbaDAgJiAxNV0gKyBIRVhfQ0hBUlNbaDEgPj4gMjggJiAxNV0gKyBIRVhfQ0hBUlNbaDEgPj4gMjQgJiAxNV0gKyBIRVhfQ0hBUlNbaDEgPj4gMjAgJiAxNV0gKyBIRVhfQ0hBUlNbaDEgPj4gMTYgJiAxNV0gKyBIRVhfQ0hBUlNbaDEgPj4gMTIgJiAxNV0gKyBIRVhfQ0hBUlNbaDEgPj4gOCAmIDE1XSArIEhFWF9DSEFSU1toMSA+PiA0ICYgMTVdICsgSEVYX0NIQVJTW2gxICYgMTVdICsgSEVYX0NIQVJTW2gyID4+IDI4ICYgMTVdICsgSEVYX0NIQVJTW2gyID4+IDI0ICYgMTVdICsgSEVYX0NIQVJTW2gyID4+IDIwICYgMTVdICsgSEVYX0NIQVJTW2gyID4+IDE2ICYgMTVdICsgSEVYX0NIQVJTW2gyID4+IDEyICYgMTVdICsgSEVYX0NIQVJTW2gyID4+IDggJiAxNV0gKyBIRVhfQ0hBUlNbaDIgPj4gNCAmIDE1XSArIEhFWF9DSEFSU1toMiAmIDE1XSArIEhFWF9DSEFSU1toMyA+PiAyOCAmIDE1XSArIEhFWF9DSEFSU1toMyA+PiAyNCAmIDE1XSArIEhFWF9DSEFSU1toMyA+PiAyMCAmIDE1XSArIEhFWF9DSEFSU1toMyA+PiAxNiAmIDE1XSArIEhFWF9DSEFSU1toMyA+PiAxMiAmIDE1XSArIEhFWF9DSEFSU1toMyA+PiA4ICYgMTVdICsgSEVYX0NIQVJTW2gzID4+IDQgJiAxNV0gKyBIRVhfQ0hBUlNbaDMgJiAxNV0gKyBIRVhfQ0hBUlNbaDQgPj4gMjggJiAxNV0gKyBIRVhfQ0hBUlNbaDQgPj4gMjQgJiAxNV0gKyBIRVhfQ0hBUlNbaDQgPj4gMjAgJiAxNV0gKyBIRVhfQ0hBUlNbaDQgPj4gMTYgJiAxNV0gKyBIRVhfQ0hBUlNbaDQgPj4gMTIgJiAxNV0gKyBIRVhfQ0hBUlNbaDQgPj4gOCAmIDE1XSArIEhFWF9DSEFSU1toNCA+PiA0ICYgMTVdICsgSEVYX0NIQVJTW2g0ICYgMTVdICsgSEVYX0NIQVJTW2g1ID4+IDI4ICYgMTVdICsgSEVYX0NIQVJTW2g1ID4+IDI0ICYgMTVdICsgSEVYX0NIQVJTW2g1ID4+IDIwICYgMTVdICsgSEVYX0NIQVJTW2g1ID4+IDE2ICYgMTVdICsgSEVYX0NIQVJTW2g1ID4+IDEyICYgMTVdICsgSEVYX0NIQVJTW2g1ID4+IDggJiAxNV0gKyBIRVhfQ0hBUlNbaDUgPj4gNCAmIDE1XSArIEhFWF9DSEFSU1toNSAmIDE1XSArIEhFWF9DSEFSU1toNiA+PiAyOCAmIDE1XSArIEhFWF9DSEFSU1toNiA+PiAyNCAmIDE1XSArIEhFWF9DSEFSU1toNiA+PiAyMCAmIDE1XSArIEhFWF9DSEFSU1toNiA+PiAxNiAmIDE1XSArIEhFWF9DSEFSU1toNiA+PiAxMiAmIDE1XSArIEhFWF9DSEFSU1toNiA+PiA4ICYgMTVdICsgSEVYX0NIQVJTW2g2ID4+IDQgJiAxNV0gKyBIRVhfQ0hBUlNbaDYgJiAxNV07CiAgICAgICAgaWYgKCF0aGlzLiNpczIyNCkgewogICAgICAgICAgICBoZXggKz0gSEVYX0NIQVJTW2g3ID4+IDI4ICYgMTVdICsgSEVYX0NIQVJTW2g3ID4+IDI0ICYgMTVdICsgSEVYX0NIQVJTW2g3ID4+IDIwICYgMTVdICsgSEVYX0NIQVJTW2g3ID4+IDE2ICYgMTVdICsgSEVYX0NIQVJTW2g3ID4+IDEyICYgMTVdICsgSEVYX0NIQVJTW2g3ID4+IDggJiAxNV0gKyBIRVhfQ0hBUlNbaDcgPj4gNCAmIDE1XSArIEhFWF9DSEFSU1toNyAmIDE1XTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhleDsKICAgIH0KICAgIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLmhleCgpOwogICAgfQogICAgZGlnZXN0KCkgewogICAgICAgIHRoaXMuZmluYWxpemUoKTsKICAgICAgICBjb25zdCBoMCA9IHRoaXMuI2gwOwogICAgICAgIGNvbnN0IGgxID0gdGhpcy4jaDE7CiAgICAgICAgY29uc3QgaDIgPSB0aGlzLiNoMjsKICAgICAgICBjb25zdCBoMyA9IHRoaXMuI2gzOwogICAgICAgIGNvbnN0IGg0ID0gdGhpcy4jaDQ7CiAgICAgICAgY29uc3QgaDUgPSB0aGlzLiNoNTsKICAgICAgICBjb25zdCBoNiA9IHRoaXMuI2g2OwogICAgICAgIGNvbnN0IGg3ID0gdGhpcy4jaDc7CiAgICAgICAgY29uc3QgYXJyID0gWwogICAgICAgICAgICBoMCA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDAgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGgwID4+IDggJiAyNTUsCiAgICAgICAgICAgIGgwICYgMjU1LAogICAgICAgICAgICBoMSA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDEgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGgxID4+IDggJiAyNTUsCiAgICAgICAgICAgIGgxICYgMjU1LAogICAgICAgICAgICBoMiA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDIgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGgyID4+IDggJiAyNTUsCiAgICAgICAgICAgIGgyICYgMjU1LAogICAgICAgICAgICBoMyA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDMgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGgzID4+IDggJiAyNTUsCiAgICAgICAgICAgIGgzICYgMjU1LAogICAgICAgICAgICBoNCA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDQgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGg0ID4+IDggJiAyNTUsCiAgICAgICAgICAgIGg0ICYgMjU1LAogICAgICAgICAgICBoNSA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDUgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGg1ID4+IDggJiAyNTUsCiAgICAgICAgICAgIGg1ICYgMjU1LAogICAgICAgICAgICBoNiA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDYgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGg2ID4+IDggJiAyNTUsCiAgICAgICAgICAgIGg2ICYgMjU1LCAKICAgICAgICBdOwogICAgICAgIGlmICghdGhpcy4jaXMyMjQpIHsKICAgICAgICAgICAgYXJyLnB1c2goaDcgPj4gMjQgJiAyNTUsIGg3ID4+IDE2ICYgMjU1LCBoNyA+PiA4ICYgMjU1LCBoNyAmIDI1NSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnI7CiAgICB9CiAgICBhcnJheSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5kaWdlc3QoKTsKICAgIH0KICAgIGFycmF5QnVmZmVyKCkgewogICAgICAgIHRoaXMuZmluYWxpemUoKTsKICAgICAgICBjb25zdCBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodGhpcy4jaXMyMjQgPyAyOCA6IDMyKTsKICAgICAgICBjb25zdCBkYXRhVmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpOwogICAgICAgIGRhdGFWaWV3LnNldFVpbnQzMigwLCB0aGlzLiNoMCk7CiAgICAgICAgZGF0YVZpZXcuc2V0VWludDMyKDQsIHRoaXMuI2gxKTsKICAgICAgICBkYXRhVmlldy5zZXRVaW50MzIoOCwgdGhpcy4jaDIpOwogICAgICAgIGRhdGFWaWV3LnNldFVpbnQzMigxMiwgdGhpcy4jaDMpOwogICAgICAgIGRhdGFWaWV3LnNldFVpbnQzMigxNiwgdGhpcy4jaDQpOwogICAgICAgIGRhdGFWaWV3LnNldFVpbnQzMigyMCwgdGhpcy4jaDUpOwogICAgICAgIGRhdGFWaWV3LnNldFVpbnQzMigyNCwgdGhpcy4jaDYpOwogICAgICAgIGlmICghdGhpcy4jaXMyMjQpIHsKICAgICAgICAgICAgZGF0YVZpZXcuc2V0VWludDMyKDI4LCB0aGlzLiNoNyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWZmZXI7CiAgICB9Cn0KY2xhc3MgSG1hY1NoYTI1NiBleHRlbmRzIFNoYTI1NiB7CiAgICAjaW5uZXI7CiAgICAjaXMyMjQ7CiAgICAjb0tleVBhZDsKICAgICNzaGFyZWRNZW1vcnk7CiAgICBjb25zdHJ1Y3RvcihzZWNyZXRLZXksIGlzMjI0MiA9IGZhbHNlLCBzaGFyZWRNZW1vcnkyID0gZmFsc2UpewogICAgICAgIHN1cGVyKGlzMjI0Miwgc2hhcmVkTWVtb3J5Mik7CiAgICAgICAgbGV0IGtleTsKICAgICAgICBpZiAodHlwZW9mIHNlY3JldEtleSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgY29uc3QgYnl0ZXMgPSBbXTsKICAgICAgICAgICAgY29uc3QgbGVuZ3RoID0gc2VjcmV0S2V5Lmxlbmd0aDsKICAgICAgICAgICAgbGV0IGluZGV4ID0gMDsKICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKXsKICAgICAgICAgICAgICAgIGxldCBjb2RlID0gc2VjcmV0S2V5LmNoYXJDb2RlQXQoaSk7CiAgICAgICAgICAgICAgICBpZiAoY29kZSA8IDEyOCkgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzW2luZGV4KytdID0gY29kZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA8IDIwNDgpIHsKICAgICAgICAgICAgICAgICAgICBieXRlc1tpbmRleCsrXSA9IDE5MiB8IGNvZGUgPj4gNjsKICAgICAgICAgICAgICAgICAgICBieXRlc1tpbmRleCsrXSA9IDEyOCB8IGNvZGUgJiA2MzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA8IDU1Mjk2IHx8IGNvZGUgPj0gNTczNDQpIHsKICAgICAgICAgICAgICAgICAgICBieXRlc1tpbmRleCsrXSA9IDIyNCB8IGNvZGUgPj4gMTI7CiAgICAgICAgICAgICAgICAgICAgYnl0ZXNbaW5kZXgrK10gPSAxMjggfCBjb2RlID4+IDYgJiA2MzsKICAgICAgICAgICAgICAgICAgICBieXRlc1tpbmRleCsrXSA9IDEyOCB8IGNvZGUgJiA2MzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29kZSA9IDY1NTM2ICsgKChjb2RlICYgMTAyMykgPDwgMTAgfCBzZWNyZXRLZXkuY2hhckNvZGVBdCgrK2kpICYgMTAyMyk7CiAgICAgICAgICAgICAgICAgICAgYnl0ZXNbaW5kZXgrK10gPSAyNDAgfCBjb2RlID4+IDE4OwogICAgICAgICAgICAgICAgICAgIGJ5dGVzW2luZGV4KytdID0gMTI4IHwgY29kZSA+PiAxMiAmIDYzOwogICAgICAgICAgICAgICAgICAgIGJ5dGVzW2luZGV4KytdID0gMTI4IHwgY29kZSA+PiA2ICYgNjM7CiAgICAgICAgICAgICAgICAgICAgYnl0ZXNbaW5kZXgrK10gPSAxMjggfCBjb2RlICYgNjM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAga2V5ID0gYnl0ZXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHNlY3JldEtleSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7CiAgICAgICAgICAgICAgICBrZXkgPSBuZXcgVWludDhBcnJheShzZWNyZXRLZXkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAga2V5ID0gc2VjcmV0S2V5OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChrZXkubGVuZ3RoID4gNjQpIHsKICAgICAgICAgICAga2V5ID0gbmV3IFNoYTI1NihpczIyNDIsIHRydWUpLnVwZGF0ZShrZXkpLmFycmF5KCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG9LZXlQYWQgPSBbXTsKICAgICAgICBjb25zdCBpS2V5UGFkID0gW107CiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDY0OyArK2kpewogICAgICAgICAgICBjb25zdCBiID0ga2V5W2ldIHx8IDA7CiAgICAgICAgICAgIG9LZXlQYWRbaV0gPSA5MiBeIGI7CiAgICAgICAgICAgIGlLZXlQYWRbaV0gPSA1NCBeIGI7CiAgICAgICAgfQogICAgICAgIHRoaXMudXBkYXRlKGlLZXlQYWQpOwogICAgICAgIHRoaXMuI29LZXlQYWQgPSBvS2V5UGFkOwogICAgICAgIHRoaXMuI2lubmVyID0gdHJ1ZTsKICAgICAgICB0aGlzLiNpczIyNCA9IGlzMjI0MjsKICAgICAgICB0aGlzLiNzaGFyZWRNZW1vcnkgPSBzaGFyZWRNZW1vcnkyOwogICAgfQogICAgZmluYWxpemUoKSB7CiAgICAgICAgc3VwZXIuZmluYWxpemUoKTsKICAgICAgICBpZiAodGhpcy4jaW5uZXIpIHsKICAgICAgICAgICAgdGhpcy4jaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgaW5uZXJIYXNoID0gdGhpcy5hcnJheSgpOwogICAgICAgICAgICBzdXBlci5pbml0KHRoaXMuI2lzMjI0LCB0aGlzLiNzaGFyZWRNZW1vcnkpOwogICAgICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLiNvS2V5UGFkKTsKICAgICAgICAgICAgdGhpcy51cGRhdGUoaW5uZXJIYXNoKTsKICAgICAgICAgICAgc3VwZXIuZmluYWxpemUoKTsKICAgICAgICB9CiAgICB9Cn0KY29uc3QgUmFuZ2UxID0gKHN0YXJ0LCBlbmQpPT57CiAgICByZXR1cm4gQXJyYXkuZnJvbSh7CiAgICAgICAgbGVuZ3RoOiBlbmQgLSBzdGFydCArIDEKICAgIH0sICh2LCBrKT0+ayArIHN0YXJ0CiAgICApOwp9Owpjb25zdCBSYW5nZVJhbmRvbSA9IChiZWdpbiwgZW5kKT0+ewogICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChlbmQgLSBiZWdpbikgKyBiZWdpbik7Cn07CmNvbnN0IGlzTnVsbCA9ICh2YWx1ZSk9PnsKICAgIHJldHVybiB2YWx1ZSA9PSBudWxsIHx8IHZhbHVlID09IHVuZGVmaW5lZDsKfTsKY29uc3Qgc3BsaXRGaWxlTmFtZSA9IChmaWxlcGF0aCk9PigoYXJyKT0+ewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG5hbWU6IGFyclswXSwKICAgICAgICAgICAgZXh0ZW50aW9uOiBhcnJbMV0KICAgICAgICB9OwogICAgfSkoZmlsZXBhdGguc3BsaXQoLyg/PVwuW14uXSskKS8pKQo7CmNvbnN0IGJ1ZmZlclRvSGFzaCA9IChoYXNoYWJsZSk9PnsKICAgIGNvbnN0IG1lc3NhZ2UgPSBoYXNoYWJsZTsKICAgIGNvbnN0IHNoYTI1NiA9IG5ldyBTaGEyNTYoKTsKICAgIHNoYTI1Ni51cGRhdGUobWVzc2FnZSk7CiAgICByZXR1cm4gc2hhMjU2LmhleCgpOwp9Owpjb25zdCByZWxIYXNoUGF0aCA9IChoYXNoLCBudW0pPT57CiAgICBjb25zdCBBID0gQXJyYXkuZnJvbShBcnJheShudW0pLCAodiwgayk9PmsKICAgICk7CiAgICByZXR1cm4gQS5tYXAoKGkxKT0+aGFzaC5zdWJzdHJpbmcoMCwgaTEgKyAxKQogICAgKS5qb2luKCIvIik7Cn07CmNvbnN0IFVyaVRvSGFzaCA9ICh1cmkpPT57CiAgICByZXR1cm4gdXJpLnJlcGxhY2UoL15bYS16XSo6LywgIiIpOwp9Owpjb25zdCBIYXNoVG9VcmkgPSAoaGFzaCk9PnsKICAgIHJldHVybiBgZW5zb3JiaToke2hhc2h9YDsKfTsKY29uc3QgZ2V0VmVjdG9yVGFnTWV0YSA9ICgpPT57CiAgICBjb25zdCBoYXNoID0gYnVmZmVyVG9IYXNoKCJ0YWciKTsKICAgIHJldHVybiB7CiAgICAgICAga2V5OiBoYXNoLAogICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgIHRhZzogMQogICAgICAgIH0KICAgIH07Cn07CmNvbnN0IGhhc2hUb1JlbW90ZVJlc291cmNlUGF0aCA9IChoYXNoKT0+ewogICAgcmV0dXJuIGAke3JlbEhhc2hQYXRoKGhhc2gsIDMpfS9gOwp9Owpjb25zdCBvcmdtb2RlUmVzb3VyY2VQYXRoID0gKGhhc2gpPT57CiAgICByZXR1cm4gewogICAgICAgIHByZWZpeDogInN0b3JhZ2Uvb3JnLyIsCiAgICAgICAgaGFzaERpcjogaGFzaFRvUmVtb3RlUmVzb3VyY2VQYXRoKGhhc2gpLAogICAgICAgIGhhc2g6IGhhc2gsCiAgICAgICAgZXh0ZW50aW9uOiAiLm9yZyIKICAgIH07Cn07CmNvbnN0IGJsb2JSZXNvdXJjZVBhdGggPSAoaGFzaCk9PnsKICAgIHJldHVybiB7CiAgICAgICAgcHJlZml4OiAic3RvcmFnZS9ibG9iLyIsCiAgICAgICAgaGFzaERpcjogaGFzaFRvUmVtb3RlUmVzb3VyY2VQYXRoKGhhc2gpLAogICAgICAgIGhhc2g6IGhhc2gKICAgIH07Cn07CmNvbnN0IG1ldGFSZXNvdXJjZVBhdGggPSAoaGFzaCk9PnsKICAgIHJldHVybiB7CiAgICAgICAgcHJlZml4OiAic3RvcmFnZS9tZXRhLyIsCiAgICAgICAgaGFzaERpcjogaGFzaFRvUmVtb3RlUmVzb3VyY2VQYXRoKGhhc2gpLAogICAgICAgIGhhc2g6IGhhc2gsCiAgICAgICAgZXh0ZW50aW9uOiAiLmpzb24iCiAgICB9Owp9Owpjb25zdCB0b2RheVN0cmluZyA9ICgpPT57CiAgICByZXR1cm4gbmV3IFJlZ0V4cCgiXlswLTldKy1bMC05XSstWzAtOV0rIikuZXhlYyhuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkpPy5bMF07Cn07CmNsYXNzIE5vZGUxIHsKICAgIGhhc2g7CiAgICB0aXRsZTsKICAgIGNyZWF0ZWRBdDsKICAgIHRodW1ibmFpbDsKICAgIGRlc2NyaXB0aW9uOwogICAgdmVjdG9yOwogICAgcmVtb3RlVXJpOwogICAgdHlwZTsKICAgIHJlZmVyZXJzID0gewogICAgfTsKICAgIGNvbnN0cnVjdG9yKGhhc2gyLCB0aXRsZSwgY3JlYXRlZEF0LCB0aHVtYm5haWwsIGRlc2NyaXB0aW9uLCB2ZWN0b3IsIHJlbW90ZVVyaSl7CiAgICAgICAgdGhpcy5oYXNoID0gaGFzaDI7CiAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlOwogICAgICAgIHRoaXMuY3JlYXRlZEF0ID0gY3JlYXRlZEF0OwogICAgICAgIHRoaXMudGh1bWJuYWlsID0gdGh1bWJuYWlsOwogICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjsKICAgICAgICB0aGlzLnZlY3RvciA9IHZlY3RvcjsKICAgICAgICB0aGlzLnJlbW90ZVVyaSA9IHJlbW90ZVVyaTsKICAgICAgICBjb25zb2xlLmxvZygiY3JlYXRlIG5vZGUgaW5zdGFuY2U6IiArIGhhc2gyKTsKICAgICAgICBjb25zdCBhbGxoYXNoID0gYnVmZmVyVG9IYXNoKCJub2RlIik7CiAgICAgICAgdmVjdG9yW2FsbGhhc2hdID0gdmVjdG9yW2FsbGhhc2hdID8/IHsKICAgICAgICAgICAgdGFnOiAxCiAgICAgICAgfTsKICAgICAgICBjb25zdCB0b2RheSA9IHRvZGF5U3RyaW5nKCk7CiAgICAgICAgY29uc29sZS5sb2codG9kYXkpOwogICAgICAgIGlmICghaXNOdWxsKHRvZGF5KSkgewogICAgICAgICAgICBjb25zdCB0b2RheUhhc2ggPSBidWZmZXJUb0hhc2godG9kYXkpOwogICAgICAgICAgICB2ZWN0b3JbdG9kYXlIYXNoXSA9IHZlY3Rvclt0b2RheUhhc2hdID8/IHsKICAgICAgICAgICAgICAgIHRhZzogMQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyB2YWxpZGF0aW9uID0gKG1ldGEpPT57CiAgICAgICAgaWYgKGlzTnVsbChtZXRhKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChpc051bGwobWV0YS5oYXNoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChpc051bGwobWV0YS50aXRsZSkpIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoaXNOdWxsKG1ldGEuY3JlYXRlZEF0KSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChpc051bGwobWV0YS50aHVtYm5haWwpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKGlzTnVsbChtZXRhLmRlc2NyaXB0aW9uKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChpc051bGwobWV0YS52ZWN0b3IpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKGlzTnVsbChtZXRhLnJlZmVyZXJzKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChpc051bGwobWV0YS5yZW1vdGVVcmkpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Owp9CmNvbnN0IEdldE5vZGVFZGdlcyA9ICh0YXJnZXQpPT57CiAgICBjb25zdCByZXQgPSB7CiAgICAgICAgLi4udGFyZ2V0LnZlY3RvciwKICAgICAgICAuLi50YXJnZXQucmVmZXJlcnMKICAgIH07CiAgICBkZWxldGUgcmV0W3RhcmdldC5oYXNoXTsKICAgIHJldHVybiBPYmplY3QuZW50cmllcyhyZXQpOwp9OwpjbGFzcyBFdmVudERpc3BhdGNoZXIgewogICAgTGlzdG5lcnNNYXAgPSB7CiAgICB9OwogICAgZ2V0TGlzdGVuZXJzID0gKGV2ZW50VHlwZSk9PnsKICAgICAgICBpZiAoIXRoaXMuTGlzdG5lcnNNYXBbZXZlbnRUeXBlXSkgewogICAgICAgICAgICB0aGlzLkxpc3RuZXJzTWFwW2V2ZW50VHlwZV0gPSBbXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuTGlzdG5lcnNNYXBbZXZlbnRUeXBlXTsKICAgIH07CiAgICBhZGRFdmVudExpc3RuZXIoZXZlbnRUeXBlLCBjYWxsYmFjaywgb3B0aW9ucyA9IHsKICAgIH0pIHsKICAgICAgICBjb25zdCBsaXN0bmVyID0gewogICAgICAgICAgICBvbmVTaG90OiAhIW9wdGlvbnMub25lU2hvdCwKICAgICAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrCiAgICAgICAgfTsKICAgICAgICB0aGlzLmdldExpc3RlbmVycyhldmVudFR5cGUpLnB1c2gobGlzdG5lcik7CiAgICB9CiAgICByZW1vdmVFdmVudExpc3RuZXIoZXZlbnRUeXBlLCBjYWxsYmFjaykgewogICAgICAgIGNvbnN0IGxpc3RuZXJMaXN0ID0gdGhpcy5nZXRMaXN0ZW5lcnMoZXZlbnRUeXBlKTsKICAgICAgICBjb25zdCBpbmRleCA9IGxpc3RuZXJMaXN0LmZpbmRJbmRleCgobGlzdG5lcik9PnsKICAgICAgICAgICAgbGlzdG5lciA9PT0gY2FsbGJhY2s7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKGluZGV4ID49IDApIHsKICAgICAgICAgICAgbGlzdG5lckxpc3Quc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB9CiAgICB9CiAgICByZW1vdmVBbGxFdmVudExpc3RuZXIoKSB7CiAgICAgICAgdGhpcy5MaXN0bmVyc01hcCA9IHsKICAgICAgICB9OwogICAgfQogICAgZGlzcGF0Y2hFdmVudChldmVudCkgewogICAgICAgIGNvbnN0IGxpc3RuZXJMaXN0ID0gdGhpcy5nZXRMaXN0ZW5lcnMoZXZlbnQudHlwZSk7CiAgICAgICAgbGlzdG5lckxpc3QuZm9yRWFjaCgoZSk9PnsKICAgICAgICAgICAgZS5jYWxsYmFjayhldmVudCk7CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgZmlsdGVyZWQgPSBsaXN0bmVyTGlzdC5maWx0ZXIoKGxpc3RuZXIpPT4hbGlzdG5lci5vbmVTaG90CiAgICAgICAgKTsKICAgICAgICB0aGlzLkxpc3RuZXJzTWFwW2V2ZW50LnR5cGVdID0gZmlsdGVyZWQ7CiAgICB9Cn0KY29uc3QgaXNNYXRyaXggPSAobyk9PnsKICAgIGlmIChBcnJheS5pc0FycmF5KG8pKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfTsKY29uc3QgbXVsdGlwbHlWZWN0b3IgPSAobTAsIG0xKT0+ewogICAgcmV0dXJuIHsKICAgICAgICB4OiBtMFswXSAqIG0xLnggKyBtMFsxXSAqIG0xLnkgKyBtMFsyXSwKICAgICAgICB5OiBtMFszXSAqIG0xLnggKyBtMFs0XSAqIG0xLnkgKyBtMFs1XQogICAgfTsKfTsKY29uc3QgbXVsdGlwbHlNYXRyaXggPSAobTAsIG0xKT0+ewogICAgcmV0dXJuIFsKICAgICAgICBtMFswXSAqIG0xWzBdICsgbTBbMV0gKiBtMVszXSArIG0wWzJdICogbTFbNl0sCiAgICAgICAgbTBbMF0gKiBtMVsxXSArIG0wWzFdICogbTFbNF0gKyBtMFsyXSAqIG0xWzddLAogICAgICAgIG0wWzBdICogbTFbMl0gKyBtMFsxXSAqIG0xWzVdICsgbTBbMl0gKiBtMVs4XSwKICAgICAgICBtMFszXSAqIG0xWzBdICsgbTBbNF0gKiBtMVszXSArIG0wWzVdICogbTFbNl0sCiAgICAgICAgbTBbM10gKiBtMVsxXSArIG0wWzRdICogbTFbNF0gKyBtMFs1XSAqIG0xWzddLAogICAgICAgIG0wWzNdICogbTFbMl0gKyBtMFs0XSAqIG0xWzVdICsgbTBbNV0gKiBtMVs4XSwKICAgICAgICBtMFs2XSAqIG0xWzBdICsgbTBbN10gKiBtMVszXSArIG0wWzhdICogbTFbNl0sCiAgICAgICAgbTBbNl0gKiBtMVsxXSArIG0wWzddICogbTFbNF0gKyBtMFs4XSAqIG0xWzddLAogICAgICAgIG0wWzZdICogbTFbMl0gKyBtMFs3XSAqIG0xWzVdICsgbTBbOF0gKiBtMVs4XSwgCiAgICBdOwp9Owpjb25zdCB0cmFuc2xhdGVNYXRyaXggPSAoeCwgeSk9PnsKICAgIHJldHVybiBbCiAgICAgICAgMSwKICAgICAgICAwLAogICAgICAgIHgsCiAgICAgICAgMCwKICAgICAgICAxLAogICAgICAgIHksCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDEKICAgIF07Cn07CmNvbnN0IHNjYWxlTWF0cml4ID0gKHgsIHkpPT57CiAgICByZXR1cm4gWwogICAgICAgIHgsCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgeSwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMCwKICAgICAgICAxCiAgICBdOwp9OwpjbGFzcyBDYW52YXNNYW5hZ2VyIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKICAgIGRvY3VtZW50OwogICAgcm9vdE5vZGU7CiAgICBncmFwaENhbnZhczsKICAgIF90cmFuc2xhdGluZyA9IGZhbHNlOwogICAgX3ByZVBvcyA9IHsKICAgICAgICB4OiAwLAogICAgICAgIHk6IDAKICAgIH07CiAgICBfcmVkcmF3RmxhZyA9IHRydWU7CiAgICBfbSA9IFsKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMAogICAgXTsKICAgIF9pbnYgPSBbCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDAKICAgIF07CiAgICBfdnYgPSB7CiAgICAgICAgeDogMCwKICAgICAgICB5OiAwLAogICAgICAgIHc6IDAsCiAgICAgICAgaDogMAogICAgfTsKICAgIF92cCA9IHsKICAgICAgICB4OiAwLAogICAgICAgIHk6IDAsCiAgICAgICAgdzogMCwKICAgICAgICBoOiAwCiAgICB9OwogICAgX3Jlc2l6ZVRpbWVvdXRJZCA9IC0xOwogICAgX3Jlc2l6ZVR5cGUgPSAnbm8gc2NhbGVNYXRyaXggdG9wIGxlZnQnOwogICAgd2lkdGggPSAoKT0+ewogICAgICAgIHJldHVybiB0aGlzLmdyYXBoQ2FudmFzID8gdGhpcy5ncmFwaENhbnZhcy53aWR0aCA6IC0xOwogICAgfTsKICAgIGhlaWdodCA9ICgpPT57CiAgICAgICAgcmV0dXJuIHRoaXMuZ3JhcGhDYW52YXMgPyB0aGlzLmdyYXBoQ2FudmFzLmhlaWdodCA6IC0xOwogICAgfTsKICAgIGlkID0gKCk9PnsKICAgICAgICByZXR1cm4gdGhpcy5ncmFwaENhbnZhcyA/IHRoaXMuZ3JhcGhDYW52YXMuaWQgOiAiIjsKICAgIH07CiAgICBjb25zdHJ1Y3Rvcihkb2N1bWVudDEsIHJvb3ROb2RlMSl7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLmRvY3VtZW50ID0gZG9jdW1lbnQxOwogICAgICAgIHRoaXMucm9vdE5vZGUgPSByb290Tm9kZTE7CiAgICAgICAgdGhpcy5ncmFwaENhbnZhcyA9IGRvY3VtZW50MS5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgICAgICB0aGlzLmdyYXBoQ2FudmFzLnN0eWxlLndpZHRoID0gd2luZG93LmlubmVyV2lkdGggKyAncHgnOwogICAgICAgIHRoaXMuZ3JhcGhDYW52YXMuc3R5bGUuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0ICsgJ3B4JzsKICAgICAgICB0aGlzLmdyYXBoQ2FudmFzLndpZHRoID0gTWF0aC5mbG9vcih3aW5kb3cuaW5uZXJXaWR0aCAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTsKICAgICAgICB0aGlzLmdyYXBoQ2FudmFzLmhlaWdodCA9IE1hdGguZmxvb3Iod2luZG93LmlubmVySGVpZ2h0ICogd2luZG93LmRldmljZVBpeGVsUmF0aW8pOwogICAgICAgIHRoaXMuZ3JhcGhDYW52YXMuaWQgPSAibmV0d29yay1ncmFwaC1jYW52YXMiOwogICAgICAgIHJvb3ROb2RlMS5hcHBlbmRDaGlsZCh0aGlzLmdyYXBoQ2FudmFzKTsKICAgIH0KICAgIGluaXQgPSAoKT0+ewogICAgICAgIHRoaXMuaW5pdE1vZGVsKCk7CiAgICAgICAgdGhpcy51cGRhdGVEb20oKTsKICAgICAgICB0aGlzLmluaXRDb250cm9sbGVyKCk7CiAgICB9OwogICAgaW5pdE1vZGVsID0gKCk9PnsKICAgICAgICB0aGlzLl90cmFuc2xhdGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMuX3JlZHJhd0ZsYWcgPSB0cnVlOwogICAgICAgIHRoaXMuX3Jlc2l6ZVRpbWVvdXRJZCA9IC0xOwogICAgICAgIHRoaXMuX3Jlc2l6ZVR5cGUgPSAnbm8gc2NhbGVNYXRyaXggdG9wIGxlZnQnOwogICAgICAgIHRoaXMudXBkYXRlVmlld1BvcnQoKTsKICAgICAgICB0aGlzLl92diA9IHsKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgdzogdGhpcy5fdnAudywKICAgICAgICAgICAgaDogdGhpcy5fdnAuaAogICAgICAgIH07CiAgICAgICAgdGhpcy51cGRhdGVQcmpNYXRyaXgoKTsKICAgIH07CiAgICBpbml0Q29udHJvbGxlciA9ICgpPT57CiAgICAgICAgaWYgKCF0aGlzLmdyYXBoQ2FudmFzKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5ncmFwaENhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsIChlKT0+ewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gewogICAgICAgICAgICAgICAgdHlwZTogJ2RibGNsaWNrJywKICAgICAgICAgICAgICAgIHdoaWNoOiBlLndoaWNoCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHN1cGVyLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuZ3JhcGhDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpPT57CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3Jlc2l6ZVRpbWVvdXRJZCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fdHJhbnNsYXRpbmcpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkgewogICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNsYXRpbmcgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGN1cnNvclBvcyA9IHsKICAgICAgICAgICAgICAgIHg6IGUucGFnZVgsCiAgICAgICAgICAgICAgICB5OiBlLnBhZ2VZCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuX3ByZVBvcyA9IHRoaXMuc2NyZWVuVG9Xb3JsZChjdXJzb3JQb3MpOwogICAgICAgICAgICBjb25zdCBldmVudCA9IHsKICAgICAgICAgICAgICAgIHR5cGU6ICdtb3VzZWRvd24nLAogICAgICAgICAgICAgICAgd2hpY2g6IGUud2hpY2gKICAgICAgICAgICAgfTsKICAgICAgICAgICAgc3VwZXIuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ncmFwaENhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCAoZSk9PnsKICAgICAgICAgICAgY29uc3QgY3Vyc29yUG9zID0gewogICAgICAgICAgICAgICAgeDogZS5wYWdlWCwKICAgICAgICAgICAgICAgIHk6IGUucGFnZVkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3QgY3VyUG9zID0gdGhpcy5zY3JlZW5Ub1dvcmxkKGN1cnNvclBvcyk7CiAgICAgICAgICAgIGlmICh0aGlzLl90cmFuc2xhdGluZykgewogICAgICAgICAgICAgICAgdGhpcy50cmFuc2xhdGUoewogICAgICAgICAgICAgICAgICAgIHg6IHRoaXMuX3ByZVBvcy54IC0gY3VyUG9zLngsCiAgICAgICAgICAgICAgICAgICAgeTogdGhpcy5fcHJlUG9zLnkgLSBjdXJQb3MueQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLl9wcmVQb3MgPSB0aGlzLnNjcmVlblRvV29ybGQoY3Vyc29yUG9zKTsKICAgICAgICAgICAgICAgIHRoaXMuX3JlZHJhd0ZsYWcgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ21vdXNlbW92ZScsCiAgICAgICAgICAgICAgICAgICAgd2hpY2g6IGUud2hpY2gsCiAgICAgICAgICAgICAgICAgICAgeDogY3VyUG9zLngsCiAgICAgICAgICAgICAgICAgICAgeTogY3VyUG9zLnkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBzdXBlci5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuZ3JhcGhDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIChlKT0+ewogICAgICAgICAgICB0aGlzLl90cmFuc2xhdGluZyA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBldmVudCA9IHsKICAgICAgICAgICAgICAgIHR5cGU6ICdtb3VzZXVwJywKICAgICAgICAgICAgICAgIHdoaWNoOiBlLndoaWNoCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHN1cGVyLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuZ3JhcGhDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V3aGVlbCcsIChlKT0+ewogICAgICAgICAgICBpZiAodGhpcy5fcmVzaXplVGltZW91dElkICE9PSAtMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGN1cnNvclBvcyA9IHsKICAgICAgICAgICAgICAgIHg6IGUucGFnZVgsCiAgICAgICAgICAgICAgICB5OiBlLnBhZ2VZCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IGN1clBvcyA9IHRoaXMuc2NyZWVuVG9Xb3JsZChjdXJzb3JQb3MpOwogICAgICAgICAgICBjb25zdCByYXRlID0gZS53aGVlbERlbHRhID4gMCA/IDEgLyAxLjIgOiAxLjI7CiAgICAgICAgICAgIHRoaXMuc2NhbGUoY3VyUG9zLCByYXRlKTsKICAgICAgICAgICAgdGhpcy5fcmVkcmF3RmxhZyA9IHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ncmFwaENhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoZSk9PnsKICAgICAgICAgICAgaWYgKHRoaXMuX3Jlc2l6ZVRpbWVvdXRJZCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9yZXNpemVUaW1lb3V0SWQpOwogICAgICAgICAgICAgICAgdGhpcy5fcmVzaXplVGltZW91dElkID0gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fcmVzaXplVGltZW91dElkID0gc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Jlc2l6ZVR5cGUgPT09ICdzY2FsZU1hdHJpeCBjZW50ZXInKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNpemVTY2FsZUNlbnRlcigpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9yZXNpemVUeXBlID09PSAnc2NhbGVNYXRyaXggdG9wIGxlZnQnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNpemVTY2FsZVRvcExlZnQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcmVzaXplVHlwZSA9PT0gJ25vIHNjYWxlTWF0cml4IGNlbnRlcicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZU5vU2NhbGVDZW50ZXIoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcmVzaXplVHlwZSA9PT0gJ25vIHNjYWxlTWF0cml4IHRvcCBsZWZ0JykgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVzaXplTm9TY2FsZVRvcExlZnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRG9tKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9yZWRyYXdGbGFnID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2l6ZVRpbWVvdXRJZCA9IC0xOwogICAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0pOwogICAgfTsKICAgIHVwZGF0ZVZpZXdQb3J0ID0gKCk9PnsKICAgICAgICB0aGlzLl92cCA9IHsKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgdzogd2luZG93LmlubmVyV2lkdGggKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbywKICAgICAgICAgICAgaDogd2luZG93LmlubmVySGVpZ2h0ICogd2luZG93LmRldmljZVBpeGVsUmF0aW8KICAgICAgICB9OwogICAgfTsKICAgIHVwZGF0ZVByak1hdHJpeCA9ICgpPT57CiAgICAgICAgY29uc3QgdHJhbnMgPSB0cmFuc2xhdGVNYXRyaXgoLXRoaXMuX3Z2LngsIC10aGlzLl92di55KTsKICAgICAgICBjb25zdCBpbnZUcmFucyA9IHRyYW5zbGF0ZU1hdHJpeCh0aGlzLl92di54LCB0aGlzLl92di55KTsKICAgICAgICBjb25zdCBzY2FsZSA9IHNjYWxlTWF0cml4KHRoaXMuX3ZwLncgLyB0aGlzLl92di53LCB0aGlzLl92cC5oIC8gdGhpcy5fdnYuaCk7CiAgICAgICAgY29uc3QgaW52U2NhbGUgPSBzY2FsZU1hdHJpeCh0aGlzLl92di53IC8gdGhpcy5fdnAudywgdGhpcy5fdnYuaCAvIHRoaXMuX3ZwLmgpOwogICAgICAgIHRoaXMuX20gPSBtdWx0aXBseU1hdHJpeChzY2FsZSwgdHJhbnMpOwogICAgICAgIHRoaXMuX2ludiA9IG11bHRpcGx5TWF0cml4KGludlRyYW5zLCBpbnZTY2FsZSk7CiAgICB9OwogICAgcmVzaXplU2NhbGVDZW50ZXIgPSAoKT0+ewogICAgICAgIGNvbnN0IHJhdGUgPSB7CiAgICAgICAgICAgIHg6IHRoaXMuX3Z2LncgLyB0aGlzLl92cC53LAogICAgICAgICAgICB5OiB0aGlzLl92di5oIC8gdGhpcy5fdnAuaAogICAgICAgIH07CiAgICAgICAgY29uc3QgdnZzcSA9IHsKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2l6ZTogMAogICAgICAgIH07CiAgICAgICAgaWYgKHRoaXMuX3Z2LncgPiB0aGlzLl92di5oKSB7CiAgICAgICAgICAgIHZ2c3EueSA9IHRoaXMuX3Z2Lnk7CiAgICAgICAgICAgIHZ2c3Euc2l6ZSA9IHRoaXMuX3Z2Lmg7CiAgICAgICAgICAgIHZ2c3EueCA9IHRoaXMuX3Z2LnggKyAodGhpcy5fdnYudyAtIHZ2c3Euc2l6ZSkgLyAyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZ2c3EueCA9IHRoaXMuX3Z2Lng7CiAgICAgICAgICAgIHZ2c3Euc2l6ZSA9IHRoaXMuX3Z2Lnc7CiAgICAgICAgICAgIHZ2c3EueSA9IHRoaXMuX3Z2LnkgKyAodGhpcy5fdnYuaCAtIHZ2c3Euc2l6ZSkgLyAyOwogICAgICAgIH0KICAgICAgICB0aGlzLnVwZGF0ZVZpZXdQb3J0KCk7CiAgICAgICAgY29uc3QgYXNwZWN0ID0gdGhpcy5fdnAudyAvIHRoaXMuX3ZwLmg7CiAgICAgICAgaWYgKGFzcGVjdCA+IDEpIHsKICAgICAgICAgICAgdGhpcy5fdnYueSA9IHZ2c3EueTsKICAgICAgICAgICAgdGhpcy5fdnYuaCA9IHZ2c3Euc2l6ZTsKICAgICAgICAgICAgdGhpcy5fdnYueCA9IHZ2c3EueCAtIHZ2c3Euc2l6ZSAqIGFzcGVjdCAvIDIgKyB2dnNxLnNpemUgLyAyOwogICAgICAgICAgICB0aGlzLl92di53ID0gdnZzcS5zaXplICogYXNwZWN0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3Z2LnggPSB2dnNxLng7CiAgICAgICAgICAgIHRoaXMuX3Z2LncgPSB2dnNxLnNpemU7CiAgICAgICAgICAgIHRoaXMuX3Z2LnkgPSB2dnNxLnkgLSB2dnNxLnNpemUgLyBhc3BlY3QgLyAyICsgdnZzcS5zaXplIC8gMjsKICAgICAgICAgICAgdGhpcy5fdnYuaCA9IHZ2c3Euc2l6ZSAvIGFzcGVjdDsKICAgICAgICB9CiAgICAgICAgdGhpcy51cGRhdGVQcmpNYXRyaXgoKTsKICAgIH07CiAgICByZXNpemVTY2FsZVRvcExlZnQgPSAoKT0+ewogICAgICAgIGNvbnN0IHJhdGUgPSB7CiAgICAgICAgICAgIHg6IHRoaXMuX3Z2LncgLyB0aGlzLl92cC53LAogICAgICAgICAgICB5OiB0aGlzLl92di5oIC8gdGhpcy5fdnAuaAogICAgICAgIH07CiAgICAgICAgY29uc3QgdnZzcSA9IHsKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2l6ZTogMAogICAgICAgIH07CiAgICAgICAgaWYgKHRoaXMuX3Z2LncgPiB0aGlzLl92di5oKSB7CiAgICAgICAgICAgIHZ2c3Euc2l6ZSA9IHRoaXMuX3Z2Lmg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdnZzcS5zaXplID0gdGhpcy5fdnYudzsKICAgICAgICB9CiAgICAgICAgdGhpcy51cGRhdGVWaWV3UG9ydCgpOwogICAgICAgIGNvbnN0IGFzcGVjdCA9IHRoaXMuX3ZwLncgLyB0aGlzLl92cC5oOwogICAgICAgIGlmIChhc3BlY3QgPiAxKSB7CiAgICAgICAgICAgIHRoaXMuX3Z2LmggPSB2dnNxLnNpemU7CiAgICAgICAgICAgIHRoaXMuX3Z2LncgPSB2dnNxLnNpemUgKiBhc3BlY3Q7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fdnYudyA9IHZ2c3Euc2l6ZTsKICAgICAgICAgICAgdGhpcy5fdnYuaCA9IHZ2c3Euc2l6ZSAvIGFzcGVjdDsKICAgICAgICB9CiAgICAgICAgdGhpcy51cGRhdGVQcmpNYXRyaXgoKTsKICAgIH07CiAgICByZXNpemVOb1NjYWxlQ2VudGVyID0gKCk9PnsKICAgICAgICBjb25zdCByYXRlID0gewogICAgICAgICAgICB4OiB0aGlzLl92di53IC8gdGhpcy5fdnAudywKICAgICAgICAgICAgeTogdGhpcy5fdnYuaCAvIHRoaXMuX3ZwLmgKICAgICAgICB9OwogICAgICAgIGNvbnN0IG9sZENlbnRlciA9IHsKICAgICAgICAgICAgeDogdGhpcy5fdnYueCArIHRoaXMuX3Z2LncgLyAyLAogICAgICAgICAgICB5OiB0aGlzLl92di55ICsgdGhpcy5fdnYuaCAvIDIKICAgICAgICB9OwogICAgICAgIHRoaXMudXBkYXRlVmlld1BvcnQoKTsKICAgICAgICB0aGlzLl92di53ID0gdGhpcy5fdnAudyAqIHJhdGUueDsKICAgICAgICB0aGlzLl92di5oID0gdGhpcy5fdnAuaCAqIHJhdGUueTsKICAgICAgICB0aGlzLl92di54ID0gb2xkQ2VudGVyLnggLSB0aGlzLl92di53IC8gMjsKICAgICAgICB0aGlzLl92di55ID0gb2xkQ2VudGVyLnkgLSB0aGlzLl92di5oIC8gMjsKICAgICAgICB0aGlzLnVwZGF0ZVByak1hdHJpeCgpOwogICAgfTsKICAgIHJlc2l6ZU5vU2NhbGVUb3BMZWZ0ID0gKCk9PnsKICAgICAgICBjb25zdCByYXRlID0gewogICAgICAgICAgICB4OiB0aGlzLl92di53IC8gdGhpcy5fdnAudywKICAgICAgICAgICAgeTogdGhpcy5fdnYuaCAvIHRoaXMuX3ZwLmgKICAgICAgICB9OwogICAgICAgIHRoaXMudXBkYXRlVmlld1BvcnQoKTsKICAgICAgICB0aGlzLl92di53ID0gdGhpcy5fdnAudyAqIHJhdGUueDsKICAgICAgICB0aGlzLl92di5oID0gdGhpcy5fdnAuaCAqIHJhdGUueTsKICAgICAgICB0aGlzLnVwZGF0ZVByak1hdHJpeCgpOwogICAgfTsKICAgIHRyYW5zbGF0ZSA9ICh2ZWMpPT57CiAgICAgICAgdGhpcy5fdnYueCArPSB2ZWMueDsKICAgICAgICB0aGlzLl92di55ICs9IHZlYy55OwogICAgICAgIHRoaXMudXBkYXRlUHJqTWF0cml4KCk7CiAgICB9OwogICAgc2NhbGUgPSAoY2VudGVyLCByYXRlKT0+ewogICAgICAgIGxldCB0b3BMZWZ0ID0gewogICAgICAgICAgICB4OiB0aGlzLl92di54LAogICAgICAgICAgICB5OiB0aGlzLl92di55CiAgICAgICAgfTsKICAgICAgICBsZXQgbWF0OwogICAgICAgIG1hdCA9IHRyYW5zbGF0ZU1hdHJpeCgtY2VudGVyLngsIC1jZW50ZXIueSk7CiAgICAgICAgbWF0ID0gbXVsdGlwbHlNYXRyaXgoc2NhbGVNYXRyaXgocmF0ZSwgcmF0ZSksIG1hdCk7CiAgICAgICAgbWF0ID0gbXVsdGlwbHlNYXRyaXgodHJhbnNsYXRlTWF0cml4KGNlbnRlci54LCBjZW50ZXIueSksIG1hdCk7CiAgICAgICAgdG9wTGVmdCA9IG11bHRpcGx5VmVjdG9yKG1hdCwgdG9wTGVmdCk7CiAgICAgICAgdGhpcy5fdnYueCA9IHRvcExlZnQueDsKICAgICAgICB0aGlzLl92di55ID0gdG9wTGVmdC55OwogICAgICAgIHRoaXMuX3Z2LncgKj0gcmF0ZTsKICAgICAgICB0aGlzLl92di5oICo9IHJhdGU7CiAgICAgICAgdGhpcy51cGRhdGVQcmpNYXRyaXgoKTsKICAgIH07CiAgICBzY3JlZW5Ub1dvcmxkID0gKHNjcmVlblBvcyk9PnsKICAgICAgICByZXR1cm4gbXVsdGlwbHlWZWN0b3IodGhpcy5faW52LCBzY3JlZW5Qb3MpOwogICAgfTsKICAgIHVwZGF0ZURvbSA9ICgpPT57CiAgICAgICAgaWYgKCF0aGlzLmdyYXBoQ2FudmFzKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5ncmFwaENhbnZhcy53aWR0aCA9IHRoaXMuX3ZwLnc7CiAgICAgICAgdGhpcy5ncmFwaENhbnZhcy5oZWlnaHQgPSB0aGlzLl92cC5oOwogICAgfTsKICAgIHVwZGF0ZVZpZXcgPSAoKT0+ewogICAgICAgIGlmICghdGhpcy5ncmFwaENhbnZhcykgcmV0dXJuOwogICAgICAgIGNvbnN0IGN0eCA9IHRoaXMuZ3JhcGhDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBpZiAoIWN0eCkgcmV0dXJuOwogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4LmNsZWFyUmVjdCh0aGlzLl92di54LCB0aGlzLl92di55LCB0aGlzLl92di53LCB0aGlzLl92di5oKTsKICAgICAgICBjdHguc2V0VHJhbnNmb3JtKHRoaXMuX21bMF0sIHRoaXMuX21bM10sIHRoaXMuX21bMV0sIHRoaXMuX21bNF0sIHRoaXMuX21bMl0sIHRoaXMuX21bNV0pOwogICAgfTsKICAgIHVwZGF0ZSA9ICgpPT57CiAgICAgICAgdGhpcy51cGRhdGVWaWV3KCk7CiAgICAgICAgdGhpcy5fcmVkcmF3RmxhZyA9IGZhbHNlOwogICAgfTsKICAgIGdldEdyYXBoQ2FudmFzID0gKCk9PnsKICAgICAgICByZXR1cm4gdGhpcy5ncmFwaENhbnZhczsKICAgIH07Cn0KY29uc3QgR2V0UmVxdWVzdCA9IGFzeW5jICh1cmksIHF1ZXJ5ID0gIiIpPT57CiAgICBjb25zb2xlLmxvZyhgSFRUUCBSRVFVRVNUIEdFVDoke3VyaX0ke3F1ZXJ5fWApOwogICAgcmV0dXJuIGF3YWl0IGZldGNoKHVyaSArIHF1ZXJ5KS50aGVuKChyZXNwb25zZSk9PnsKICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9KS5jYXRjaCgoZSk9PnsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfSk7Cn07CmNvbnN0IFBvc3RSZXF1ZXN0ID0gYXN5bmMgKHVyaSwgYm9keSwgZmlsZXMpPT57CiAgICBjb25zdCBmaWxlID0gZmlsZXNbMF07CiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgZm9ybURhdGEuc2V0KCJtZXRhIiwgSlNPTi5zdHJpbmdpZnkoYm9keSkpOwogICAgZm9ybURhdGEuc2V0KCJmaWxlIiwgZmlsZXNbMF0pOwogICAgY29uc3QgcGFyYW0gPSB7CiAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgYm9keTogZm9ybURhdGEKICAgIH07CiAgICByZXR1cm4gYXdhaXQgZmV0Y2godXJpLCBwYXJhbSkudGhlbigocmVzcG9uc2UpPT57CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTsKICAgIH0pLmNhdGNoKChlKT0+ewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgfSk7Cn07CmNvbnN0IERlbGV0ZVJlcXVlc3QgPSBhc3luYyAodXJpKT0+ewogICAgcmV0dXJuIGF3YWl0IGZldGNoKHVyaSwgewogICAgICAgIG1ldGhvZDogIkRFTEVURSIsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgiCiAgICAgICAgfQogICAgfSkudGhlbigocmVzcG9uc2UpPT57CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTsKICAgIH0pLmNhdGNoKChlKT0+ewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgfSk7Cn07CmNvbnN0IFB1dFJlcXVlc3QgPSBhc3luYyAodXJpLCBmb3JtRGF0YSk9PnsKICAgIGNvbnNvbGUubG9nKHsKICAgICAgICAuLi5mb3JtRGF0YS5nZXRBbGwKICAgIH0pOwogICAgY29uc3QgcGFyYW0gPSB7CiAgICAgICAgbWV0aG9kOiAiUFVUIiwKICAgICAgICBib2R5OiBmb3JtRGF0YQogICAgfTsKICAgIHJldHVybiBhd2FpdCBmZXRjaCh1cmksIHBhcmFtKS50aGVuKChyZXNwb25zZSk9PnsKICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9KS5jYXRjaCgoZSk9PnsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfSk7Cn07CmNvbnN0IFBhdGNoUmVxdWVzdCA9IGFzeW5jICh1cmkpPT57CiAgICByZXR1cm4gYXdhaXQgZmV0Y2godXJpLCB7CiAgICAgICAgbWV0aG9kOiAiUEFUQ0giLAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04IgogICAgICAgIH0KICAgIH0pLnRoZW4oKHJlc3BvbnNlKT0+ewogICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7CiAgICB9KS5jYXRjaCgoZSk9PnsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgIH0pOwp9Owpjb25zdCBDcmVhdGVUZXh0QXJlYSA9IChkb2N1bWVudDEsIHZhbHVlID0gJ3sidGl0bGUiOiAiIiwgImNvbnRlbnQiOiAiIn0nLCByb3dzID0gMTAsIGNvbHMgPSAxMCk9PnsKICAgIGxldCBhcmVhID0gZG9jdW1lbnQxLmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7CiAgICBhcmVhLnJlYWRPbmx5ID0gZmFsc2U7CiAgICBhcmVhLnZhbHVlID0gdmFsdWU7CiAgICBhcmVhLnJvd3MgPSByb3dzOwogICAgYXJlYS5jb2xzID0gY29sczsKICAgIHJldHVybiBhcmVhOwp9Owpjb25zdCBDcmVhdGVJbnB1dFRleHQgPSAoZG9jdW1lbnQxLCB2YWx1ZSA9ICIiKT0+ewogICAgbGV0IGlucHV0ID0gZG9jdW1lbnQxLmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICBpbnB1dC50eXBlID0gInRleHQiOwogICAgaW5wdXQudmFsdWUgPSAidGFnIjsKICAgIHJldHVybiBpbnB1dDsKfTsKY29uc3QgQ3JlYXRlSW5wdXRCdXR0b24gPSAoZG9jdW1lbnQxLCB2YWx1ZSA9ICIiLCBjYWxsYmFjayA9IChlKT0+ewp9KT0+ewogICAgbGV0IGJ1dHRvbiA9IGRvY3VtZW50MS5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgIGJ1dHRvbi5pbm5lclRleHQgPSB2YWx1ZTsKICAgIGJ1dHRvbi52YWx1ZSA9IHZhbHVlOwogICAgYnV0dG9uLm9uY2xpY2sgPSBjYWxsYmFjazsKICAgIHJldHVybiBidXR0b247Cn07CmNvbnN0IENyZWF0ZUltZyA9IChkb2N1bWVudDEsIHNyYywgd2lkdGggPSAwLCBoZWlnaHQgPSAwLCBhbHQgPSAiIik9PnsKICAgIGxldCBpbWcgPSBkb2N1bWVudDEuY3JlYXRlRWxlbWVudCgiaW1nIik7CiAgICBpbWcuc3JjID0gc3JjOwogICAgaWYgKHdpZHRoICE9IDApIGltZy53aWR0aCA9IHdpZHRoOwogICAgaWYgKGhlaWdodCAhPSAwKSBpbWcuaGVpZ2h0ID0gaGVpZ2h0OwogICAgaW1nLmFsdCA9IGFsdDsKICAgIHJldHVybiBpbWc7Cn07CmNvbnN0IENyZWF0ZUF1dG9jb21wbGV0ZUlucHV0ID0gKGRvY3VtZW50MSwgZGF0YUxpc3RJZCwgZGF0YUxpc3QgPSBbXSwgdmFsdWUgPSAiIik9PnsKICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQxLmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICBpbnB1dC50eXBlID0gInRleHQiOwogICAgaW5wdXQudmFsdWUgPSB2YWx1ZTsKICAgIGlucHV0LnNldEF0dHJpYnV0ZSgnbGlzdCcsIGRhdGFMaXN0SWQpOwogICAgaW5wdXQuYXV0b2NvbXBsZXRlID0gInRydWUiOwogICAgbGV0IGRsID0gZG9jdW1lbnQxLmNyZWF0ZUVsZW1lbnQoJ2RhdGFsaXN0Jyk7CiAgICBkbC5pZCA9IGRhdGFMaXN0SWQ7CiAgICBkYXRhTGlzdC5mb3JFYWNoKChlKT0+ewogICAgICAgIGxldCBvcHRpb24gPSBkb2N1bWVudDEuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgb3B0aW9uLnZhbHVlID0gZTsKICAgICAgICBkbC5hcHBlbmRDaGlsZChvcHRpb24pOwogICAgfSk7CiAgICBpbnB1dC5hcHBlbmRDaGlsZChkbCk7CiAgICByZXR1cm4gaW5wdXQ7Cn07CmNsYXNzIFN0b3JlZE5vZGVzIHsKICAgIGRpY3QgPSB7CiAgICB9OwogICAgb25SZWdpc3RlciA9ICgpPT57CiAgICB9OwogICAgY29uc3RydWN0b3IoKXsKICAgIH0KICAgIHRhZ0hhc2hEaWN0ID0gKCk9PnsKICAgICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKHRoaXMuZGljdCkuZmlsdGVyKChba2V5MSwgdmFsdWVdKT0+dmFsdWUudHlwZSA9PSAiVGFnTWV0YSIKICAgICAgICApLm1hcCgoW2tleTEsIHZhbHVlXSk9PlsKICAgICAgICAgICAgICAgIHZhbHVlLnRpdGxlLAogICAgICAgICAgICAgICAgdmFsdWUKICAgICAgICAgICAgXQogICAgICAgICkpOwogICAgfTsKICAgIGJsb2JIYXNoRGljdCA9ICgpPT57CiAgICAgICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyh0aGlzLmRpY3QpLmZpbHRlcigoW2tleTEsIHZhbHVlXSk9PnZhbHVlLnR5cGUgPT0gIkJsb2JNZXRhIgogICAgICAgICkpOwogICAgfTsKICAgIGZldGNoID0gYXN5bmMgKGhhc2gxKT0+ewogICAgICAgIGlmICghdGhpcy5kaWN0W2hhc2gxXSkgewogICAgICAgICAgICBjb25zdCB1cGRhdGVOb2RlcyA9IGF3YWl0IHRoaXMucmVtb3RlR2V0KGhhc2gxKTsKICAgICAgICAgICAgdXBkYXRlTm9kZXMuZm9yRWFjaCgoZSk9PnRoaXMuY2FjaGUoZSkKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuZGljdFtoYXNoMV07CiAgICB9OwogICAgdXBkYXRlID0gYXN5bmMgKG5vZGUsIG9wdGlvbkZvcm1EYXRhKT0+ewogICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShub2RlKSAhPSBKU09OLnN0cmluZ2lmeSh0aGlzLmRpY3Rbbm9kZS5oYXNoXSkpIHsKICAgICAgICAgICAgY29uc3QgdXBkYXRlTm9kZXMgPSBhd2FpdCB0aGlzLnJlbW90ZVB1dChub2RlLCBvcHRpb25Gb3JtRGF0YSk7CiAgICAgICAgICAgIHVwZGF0ZU5vZGVzLmZvckVhY2goKGUpPT50aGlzLmNhY2hlKGUpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybiB1cGRhdGVOb2RlczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgfTsKICAgIHJlbW90ZVB1dCA9IGFzeW5jIChub2RlLCBvcHRpb25Gb3JtRGF0YSk9PnsKICAgICAgICBvcHRpb25Gb3JtRGF0YS5zZXQoIm1ldGEiLCBKU09OLnN0cmluZ2lmeShub2RlKSk7CiAgICAgICAgY29uc29sZS5sb2coewogICAgICAgICAgICAuLi5vcHRpb25Gb3JtRGF0YQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUHV0UmVxdWVzdCgiL3Bvc3RzLyIgKyBub2RlLmhhc2gsIG9wdGlvbkZvcm1EYXRhKTsKICAgICAgICBpZiAoaXNOdWxsKHJlc3BvbnNlKSkgcmV0dXJuIFtdOwogICAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgY29uc29sZS5sb2coanNvbik7CiAgICAgICAgY29uc3Qgbm9kZXMgPSBPYmplY3QudmFsdWVzKGpzb24pLmZpbHRlcigobm9kZTEpPT57CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IE5vZGUxLnZhbGlkYXRpb24obm9kZTEpOwogICAgICAgICAgICBpZiAoIXJlc3VsdCkgdGhyb3cgbmV3IEVycm9yKCfjg5Djg6rjg4fjg7zjgrfjg6fjg7PkuI3og73jgapqc29u44GM5re35YWl44GX44Gm44GE44G+44GZJyk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIG5vZGVzOwogICAgfTsKICAgIGNhY2hlID0gKGUpPT57CiAgICAgICAgdGhpcy5kaWN0W2UuaGFzaF0gPSBlOwogICAgICAgIHRoaXMub25SZWdpc3RlcigpOwogICAgfTsKICAgIHNldFJlbW90ZUdldE1ldGhvZCA9IChtZXRob2QpPT57CiAgICAgICAgdGhpcy5yZW1vdGVHZXQgPSBtZXRob2Q7CiAgICB9OwogICAgcmVtb3RlR2V0ID0gYXN5bmMgKGhhc2gxLCBmb3JjZSA9IGZhbHNlKT0+ewogICAgICAgIGNvbnN0IHBhdGhTdHJ1Y3QgPSBtZXRhUmVzb3VyY2VQYXRoKGhhc2gxKTsKICAgICAgICBjb25zdCBwYXRoID0gcGF0aFN0cnVjdC5wcmVmaXggKyBwYXRoU3RydWN0Lmhhc2hEaXIgKyBwYXRoU3RydWN0Lmhhc2ggKyBwYXRoU3RydWN0LmV4dGVudGlvbjsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEdldFJlcXVlc3QocGF0aCk7CiAgICAgICAgaWYgKGlzTnVsbChyZXNwb25zZSkpIHJldHVybiBbXTsKICAgICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwogICAgICAgIGNvbnNvbGUubG9nKGpzb24pOwogICAgICAgIGlmIChOb2RlMS52YWxpZGF0aW9uKGpzb24pKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGByZW1vdGVHZXQ6ICR7anNvbn1gKTsKICAgICAgICAgICAgY29uc3Qgbm9kZUFycmF5ID0gWwogICAgICAgICAgICAgICAganNvbgogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gbm9kZUFycmF5OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybigiTm9kZeOBqOOBl+OBpuino+mHiOOBp+OBjeOBquOBhOOCguOBruOCkuWPluW+l+OBl+OBvuOBl+OBnyIpOwogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgfTsKfQpjbGFzcyBCbG9iTWV0YSBleHRlbmRzIE5vZGUxIHsKICAgIGV4dGVudGlvbjsKICAgIG1pbWVUeXBlOwogICAgdHlwZSA9ICJCbG9iTWV0YSI7CiAgICBjb25zdHJ1Y3RvcihoYXNoMSwgdGl0bGUxLCBleHRlbnRpb24sIGNyZWF0ZWRBdDEsIHRodW1ibmFpbDEsIGRlc2NyaXB0aW9uMSwgdmVjdG9yMSwgbWltZVR5cGUsIHJlbW90ZVVyaTEpewogICAgICAgIHN1cGVyKGhhc2gxLCB0aXRsZTEsIGNyZWF0ZWRBdDEsIHRodW1ibmFpbDEsIGRlc2NyaXB0aW9uMSwgdmVjdG9yMSwgcmVtb3RlVXJpMSk7CiAgICAgICAgdGhpcy5leHRlbnRpb24gPSBleHRlbnRpb247CiAgICAgICAgdGhpcy5taW1lVHlwZSA9IG1pbWVUeXBlOwogICAgICAgIGNvbnN0IGFsbGhhc2gxID0gYnVmZmVyVG9IYXNoKCJibG9iIik7CiAgICAgICAgdmVjdG9yMVthbGxoYXNoMV0gPSB2ZWN0b3IxW2FsbGhhc2gxXSA/PyB7CiAgICAgICAgICAgIHRhZzogMQogICAgICAgIH07CiAgICB9CiAgICBzdGF0aWMgdmFsaWRhdGlvbiA9IChtZXRhKT0+ewogICAgICAgIGlmIChtZXRhLnR5cGUgIT0gIkJsb2JNZXRhIikgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChpc051bGwobWV0YS5leHRlbnRpb24pKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKGlzTnVsbChtZXRhLm1pbWVUeXBlKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghTm9kZTEudmFsaWRhdGlvbihtZXRhKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfTsKfQpjbGFzcyBQcmlvcml0eVF1ZXVlIHsKICAgIGl0ZW1zID0gewogICAgfTsKICAgIHF1ZXVlID0gW107CiAgICBsZW5ndGggPSAwOwogICAgY29uc3RydWN0b3IoKXsKICAgIH0KICAgIGluc2VydCA9IChpdGVtLCB2YWx1ZSwgbG9va3VwaWQgPSBudWxsKT0+ewogICAgICAgIGlmIChsb29rdXBpZCAhPT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLml0ZW1zW2xvb2t1cGlkXSA9IHsKICAgICAgICAgICAgICAgIGl0ZW06IGl0ZW0sCiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlID09IEluZmluaXR5KSB7CiAgICAgICAgICAgIHRoaXMucXVldWUucHVzaCh7CiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICBpdGVtOiBpdGVtLAogICAgICAgICAgICAgICAgbG9va3VwaWQ6IGxvb2t1cGlkCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh2YWx1ZSA9PSAtSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhpcy5xdWV1ZS51bnNoaWZ0KHsKICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICAgIGl0ZW06IGl0ZW0sCiAgICAgICAgICAgICAgICBsb29rdXBpZDogbG9va3VwaWQKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnF1ZXVlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICB0aGlzLnF1ZXVlLnB1c2goewogICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgICAgaXRlbTogaXRlbSwKICAgICAgICAgICAgICAgIGxvb2t1cGlkOiBsb29rdXBpZAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgaW5kZXggPSB0aGlzLl9iaW5hcnlTZWFyY2godmFsdWUpOwogICAgICAgIHRoaXMucXVldWUuc3BsaWNlKGluZGV4LCAwLCB7CiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgaXRlbTogaXRlbSwKICAgICAgICAgICAgbG9va3VwaWQ6IGxvb2t1cGlkCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5sZW5ndGggKz0gMTsKICAgIH07CiAgICBfYmluYXJ5U2VhcmNoID0gKHJhbmtpbmcpPT57CiAgICAgICAgbGV0IHN0YXJ0ID0gMDsKICAgICAgICBsZXQgZW5kID0gdGhpcy5xdWV1ZS5sZW5ndGg7CiAgICAgICAgd2hpbGUoZW5kIC0gc3RhcnQgPiAxKXsKICAgICAgICAgICAgbGV0IGNoZWNrSW5kZXggPSBNYXRoLmZsb29yKChzdGFydCArIGVuZCkgLyAyKTsKICAgICAgICAgICAgaWYgKHJhbmtpbmcgPT09IHRoaXMucXVldWVbY2hlY2tJbmRleF0udmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmIChjaGVja0luZGV4ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrSW5kZXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aGlsZShjaGVja0luZGV4ID4gMCAmJiB0aGlzLnF1ZXVlW2NoZWNrSW5kZXggLSAxXS52YWx1ZSA9PSByYW5raW5nKXsKICAgICAgICAgICAgICAgICAgICBjaGVja0luZGV4IC09IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY2hlY2tJbmRleDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5xdWV1ZVtjaGVja0luZGV4XS52YWx1ZSA+IHJhbmtpbmcpIHsKICAgICAgICAgICAgICAgIGVuZCA9IGNoZWNrSW5kZXg7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5xdWV1ZVtjaGVja0luZGV4XS52YWx1ZSA8IHJhbmtpbmcpIHsKICAgICAgICAgICAgICAgIHN0YXJ0ID0gY2hlY2tJbmRleDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocmFua2luZyA+IHRoaXMucXVldWVbc3RhcnRdLnZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBlbmQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHN0YXJ0OwogICAgICAgIH0KICAgIH07CiAgICBoYXNJdGVtID0gKGxvb2t1cGlkKT0+ewogICAgICAgIGlmICh0aGlzLml0ZW1zW2xvb2t1cGlkXSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICBnZXRJdGVtQnlLZXkgPSAobG9va3VwaWQpPT57CiAgICAgICAgcmV0dXJuIHRoaXMuaXRlbXNbbG9va3VwaWRdOwogICAgfTsKICAgIGdldEl0ZW1CeUluZGV4ID0gKGluZGV4KT0+ewogICAgICAgIHJldHVybiB0aGlzLnF1ZXVlW2luZGV4XTsKICAgIH07CiAgICBnZXRJbmRleCA9IChsb29rdXBpZCk9PnsKICAgICAgICBsZXQgcmFua2luZyA9IHRoaXMuaXRlbXNbbG9va3VwaWRdLnZhbHVlOwogICAgICAgIGxldCBpbmRleCA9IHRoaXMuX2JpbmFyeVNlYXJjaChyYW5raW5nKTsKICAgICAgICB3aGlsZSh0aGlzLnF1ZXVlW2luZGV4XS52YWx1ZSA9PSByYW5raW5nICYmIGluZGV4ICsgMSA8IHRoaXMucXVldWUubGVuZ3RoKXsKICAgICAgICAgICAgaWYgKHRoaXMucXVldWVbaW5kZXhdLmxvb2t1cGlkID09PSBsb29rdXBpZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGluZGV4ICs9IDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiAtMTsKICAgIH07CiAgICByZXBsYWNlID0gKG5ld0l0ZW0sIG5ld1ZhbHVlLCBsb29rdXBpZCk9PnsKICAgICAgICB0aGlzLmRlbGV0ZShsb29rdXBpZCk7CiAgICAgICAgdGhpcy5pbnNlcnQobmV3SXRlbSwgbmV3VmFsdWUsIGxvb2t1cGlkKTsKICAgIH07CiAgICBkZWxldGUgPSAobG9va3VwaWQpPT57CiAgICAgICAgaWYgKHRoaXMuaGFzSXRlbShsb29rdXBpZCkpIHsKICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5nZXRJbmRleChsb29rdXBpZCk7CiAgICAgICAgICAgIHRoaXMucXVldWUuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuaXRlbXNbbG9va3VwaWRdOwogICAgICAgICAgICB0aGlzLmxlbmd0aCAtPSAxOwogICAgICAgIH0KICAgIH07CiAgICBkZXF1ZXVlID0gKCk9PnsKICAgICAgICBsZXQgb3V0cHV0ID0gdGhpcy5xdWV1ZS5zaGlmdCgpOwogICAgICAgIGlmICh0aGlzLml0ZW1zW291dHB1dC5sb29rdXBpZF0pIHsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuaXRlbXNbb3V0cHV0Lmxvb2t1cGlkXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgIH07Cn0KY2xhc3MgR3JhcGggewogICAgc3RhdGljIGNvbnRleHRzID0gewogICAgfTsKICAgIHN0YXRpYyBnZXRDb250ZXh0KGlkKSB7CiAgICAgICAgcmV0dXJuIEdyYXBoLmNvbnRleHRzW2lkXTsKICAgIH0KICAgIHN0YXRpYyBDbGVhcihjb250ZXh0aWQpIHsKICAgICAgICBsZXQgbyA9IE9iamVjdC52YWx1ZXMoR3JhcGguZ2V0Q29udGV4dChjb250ZXh0aWQpLm9ianMpOwogICAgICAgIG8ubWFwKChvYmopPT57CiAgICAgICAgICAgIG9iai5kZWxldGUoKTsKICAgICAgICB9KTsKICAgIH0KICAgIHN0YXRpYyBsb2FkKGpzb25TdHJpbmcsIGNhbnZhc2lkKSB7CiAgICAgICAgZnVuY3Rpb24gZnVuY3Rpb25meShrZXkxLCB2YWx1ZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlLmluZGV4T2YoJ2Z1bmN0aW9uJykgPT09IDAgfHwgdmFsdWUuaW5kZXhPZigiKT0+IikgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGZ1bmN0aW9uVGVtcGxhdGUgPSBgKCR7dmFsdWV9KWA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2YWwoZnVuY3Rpb25UZW1wbGF0ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0KICAgICAgICBsZXQgY29udGV4dCA9IEpTT04ucGFyc2UoanNvblN0cmluZywgZnVuY3Rpb25meSk7CiAgICAgICAgY29udGV4dC5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXNpZCk7CiAgICAgICAgY29udGV4dC5jdHggPSBjb250ZXh0LmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGxldCBpZF90aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkudG9TdHJpbmcoKTsKICAgICAgICBsZXQgaWRfcmFuZG9tID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogOTk5OTk5OSkudG9TdHJpbmcoKTsKICAgICAgICBjb250ZXh0LmlkID0gTnVtYmVyKGlkX3RpbWUgKyBpZF9yYW5kb20pOwogICAgICAgIGxldCBlZGdlS2V5cyA9IE9iamVjdC5rZXlzKGNvbnRleHQuZWRnZXMpOwogICAgICAgIGZvcihsZXQgaTEgPSAwOyBpMSA8IGVkZ2VLZXlzLmxlbmd0aDsgaTErKyl7CiAgICAgICAgICAgIGNvbnRleHQuZWRnZXNbZWRnZUtleXNbaTFdXS5jb250ZXh0aWQgPSBjb250ZXh0LmlkOwogICAgICAgIH0KICAgICAgICBsZXQgb2JqS2V5cyA9IE9iamVjdC5rZXlzKGNvbnRleHQub2Jqcyk7CiAgICAgICAgZm9yKGxldCBpMiA9IDA7IGkyIDwgb2JqS2V5cy5sZW5ndGg7IGkyKyspewogICAgICAgICAgICBjb250ZXh0Lm9ianNbb2JqS2V5c1tpMl1dLmNvbnRleHRpZCA9IGNvbnRleHQuaWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgR3JhcGgoY2FudmFzaWQsIGNvbnRleHQuZnBzLCBjb250ZXh0LmVkaXRhYmxlLCBjb250ZXh0LmJ1aWxkYWJsZSwgY29udGV4dCk7CiAgICB9CiAgICBjb25zdHJ1Y3RvcihjYW52YXNpZCwgZnBzMSA9IDYwLCBlZGl0YWJsZSA9IHRydWUsIGJ1aWxkYWJsZSA9IHRydWUsIGxvYWRDb250ZXh0ID0gbnVsbCwgYWN0aXZhdGVOb2RlQ2FsbGJhY2sxID0gKGRlQWN0aXZhdGVOb2RlLCBhY3RpdmF0ZU5vZGUpPT57CiAgICB9LCBkZUFjdGl2YXRlTm9kZUNhbGxiYWNrMSA9IChkZUFjdGl2YXRlTm9kZSk9PnsKICAgIH0sIGRvdWJsZUNsaWNrZWROb2RlQ2FsbGJhY2sxID0gKGRvdWJsZUNsaWNrZWROb2RlKT0+ewogICAgfSl7CiAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXNpZCk7CiAgICAgICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIHRoaXMub2JqcyA9IHsKICAgICAgICB9OwogICAgICAgIHRoaXMuZWRnZXMgPSB7CiAgICAgICAgfTsKICAgICAgICB0aGlzLnZhcnMgPSB7CiAgICAgICAgfTsKICAgICAgICBsZXQgaWRfdGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLnRvU3RyaW5nKCk7CiAgICAgICAgbGV0IGlkX3JhbmRvbSA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDk5OTk5OTkpLnRvU3RyaW5nKCk7CiAgICAgICAgdGhpcy5pZCA9IE51bWJlcihpZF90aW1lICsgaWRfcmFuZG9tKTsKICAgICAgICB0aGlzLm5vZGVDcmVhdGVkQ2FsbGJhY2sgPSAoKT0+ewogICAgICAgIH07CiAgICAgICAgdGhpcy5jb25uZWN0aW9uQ3JlYXRlZENhbGxiYWNrID0gKCk9PnsKICAgICAgICB9OwogICAgICAgIHRoaXMuY29ubmVjdGlvblNldHVwQ2FsbGJhY2sgPSAoKT0+ewogICAgICAgIH07CiAgICAgICAgdGhpcy5ub2RlU2V0dXBDYWxsYmFjayA9ICgpPT57CiAgICAgICAgfTsKICAgICAgICB0aGlzLnRpY2tDYWxsYmFjayA9ICgpPT57CiAgICAgICAgfTsKICAgICAgICB0aGlzLmFjdGl2YXRlTm9kZUNhbGxiYWNrID0gYWN0aXZhdGVOb2RlQ2FsbGJhY2sxOwogICAgICAgIHRoaXMuZGVBY3RpdmF0ZU5vZGVDYWxsYmFjayA9IGRlQWN0aXZhdGVOb2RlQ2FsbGJhY2sxOwogICAgICAgIHRoaXMuZG91YmxlQ2xpY2tlZE5vZGVDYWxsYmFjayA9IGRvdWJsZUNsaWNrZWROb2RlQ2FsbGJhY2sxOwogICAgICAgIHRoaXMuZWRpdGFibGUgPSBlZGl0YWJsZTsKICAgICAgICB0aGlzLmZwcyA9IGZwczE7CiAgICAgICAgdGhpcy5idWlsZGFibGUgPSBidWlsZGFibGU7CiAgICAgICAgaWYgKGxvYWRDb250ZXh0ICE9PSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMuZWRnZXMgPSBsb2FkQ29udGV4dC5lZGdlczsKICAgICAgICAgICAgdGhpcy52YXJzID0gbG9hZENvbnRleHQudmFyczsKICAgICAgICAgICAgdGhpcy5vYmpzID0gbG9hZENvbnRleHQub2JqczsKICAgICAgICAgICAgdGhpcy5pZCA9IGxvYWRDb250ZXh0LmlkOwogICAgICAgICAgICB0aGlzLnRpY2tDYWxsYmFjayA9IGxvYWRDb250ZXh0LnRpY2tDYWxsYmFjazsKICAgICAgICAgICAgdGhpcy5ub2RlU2V0dXBDYWxsYmFjayA9IGxvYWRDb250ZXh0Lm5vZGVTZXR1cENhbGxiYWNrOwogICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25DcmVhdGVkQ2FsbGJhY2sgPSBsb2FkQ29udGV4dC5jb25uZWN0aW9uQ3JlYXRlZENhbGxiYWNrOwogICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TZXR1cENhbGxiYWNrID0gbG9hZENvbnRleHQuY29ubmVjdGlvblNldHVwQ2FsbGJhY2s7CiAgICAgICAgICAgIHRoaXMubm9kZUNyZWF0ZWRDYWxsYmFjayA9IGxvYWRDb250ZXh0Lm5vZGVDcmVhdGVkQ2FsbGJhY2s7CiAgICAgICAgfQogICAgICAgIEdyYXBoLmNvbnRleHRzW3RoaXMuaWRdID0gdGhpczsKICAgICAgICBpZiAodGhpcy5mcHMgPT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmZwcyA9IDYwOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5lZGl0YWJsZSA9PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tfbW91c2UoKTsKICAgICAgICAgICAgdGhpcy5hY3RpdmF0ZV9lZGl0aW5nKHRoaXMuZnBzKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuYnVpbGRhYmxlID09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy5hY3RpdmF0ZV9idWlsZGluZygpOwogICAgICAgIH0KICAgICAgICBpZiAobG9hZENvbnRleHQgIT09IG51bGwpIHsKICAgICAgICAgICAgZm9yKGxldCBlZGdlaWQgaW4gdGhpcy5lZGdlcyl7CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TZXR1cENhbGxiYWNrKHRoaXMuZWRnZXNbZWRnZWlkXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yKGxldCBub2RlaWQgaW4gdGhpcy5vYmpzKXsKICAgICAgICAgICAgICAgIHRoaXMubm9kZVNldHVwQ2FsbGJhY2sodGhpcy5vYmpzW25vZGVpZF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgc2V0Tm9kZUNyZWF0ZWRDYWxsYmFjayhmdW5jKSB7CiAgICAgICAgdGhpcy5ub2RlQ3JlYXRlZENhbGxiYWNrID0gZnVuYzsKICAgIH0KICAgIHNldENvbm5lY3Rpb25DcmVhdGVkQ2FsbGJhY2soZnVuYykgewogICAgICAgIHRoaXMuY29ubmVjdGlvbkNyZWF0ZWRDYWxsYmFjayA9IGZ1bmM7CiAgICB9CiAgICBzZXRUaWNrQ2FsbGJhY2soZnVuYykgewogICAgICAgIHRoaXMudGlja0NhbGxiYWNrID0gZnVuYzsKICAgIH0KICAgIHNldE5vZGVTZXR1cENhbGxiYWNrKGZ1bmMpIHsKICAgICAgICB0aGlzLm5vZGVTZXR1cENhbGxiYWNrID0gZnVuYzsKICAgIH0KICAgIHNldENvbm5lY3Rpb25TZXR1cENhbGxiYWNrKGZ1bmMpIHsKICAgICAgICB0aGlzLmNvbm5lY3Rpb25DcmVhdGVkQ2FsbGJhY2sgPSBmdW5jOwogICAgfQogICAgc2F2ZSgpIHsKICAgICAgICBsZXQgbWV0aG9kQ2F0aGNlciA9IGZ1bmN0aW9uKGtleTEsIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLCBtZXRob2RDYXRoY2VyKTsKICAgIH0KICAgIGdldENoaWxkcmVuQnlUZXh0KHRleHQpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyh0aGlzLm9ianMpLmZpbHRlcigobm9kZSk9Pm5vZGUudGV4dCA9PT0gdGV4dAogICAgICAgICk7CiAgICB9CiAgICBnZXRFZGdlKHBhcmVudGlkLCBjaGlsZGlkKSB7CiAgICAgICAgZm9yIChsZXQgZWRnZSBvZiBPYmplY3QudmFsdWVzKHRoaXMuZWRnZXMpKXsKICAgICAgICAgICAgaWYgKGVkZ2Uuc3RhcnROb2RlaWQgPT09IHBhcmVudGlkICYmIGVkZ2UuZW5kTm9kZWlkID09PSBjaGlsZGlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lZGdlc1tlZGdlLmlkXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZWRnZS5pc0JpRGlyZWN0aW9uYWwoKSkgewogICAgICAgICAgICAgICAgaWYgKGVkZ2UuZW5kTm9kZWlkID09PSBwYXJlbnRpZCAmJiBlZGdlLnN0YXJ0Tm9kZWlkID09PSBjaGlsZGlkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWRnZXNbZWRnZS5pZF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgZHJhd0xvb3AoYmV6aWVyQ29udHJvbFBvaW50c1gsIGJlemllckNvbnRyb2xQb2ludHNZLCB0ZXh0ID0gIiIsIGRpcmVjdGlvbmFsID0gZmFsc2UpIHsKICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsKICAgICAgICB0aGlzLmFkZEJlemllckN1cnZlVG9QYXRoKGJlemllckNvbnRyb2xQb2ludHNYLCBiZXppZXJDb250cm9sUG9pbnRzWSk7CiAgICAgICAgdGhpcy5jdHguY2xvc2VQYXRoKCk7CiAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7CiAgICAgICAgaWYgKHRleHQgIT09IG51bGwgJiYgdGV4dCAhPT0gIiIpIHsKICAgICAgICAgICAgbGV0IG1pZFBvaW50WCA9IEdyYXBoLmNhbGN1bGF0ZU1pZFBvaW50T2ZCZXppZXJDdXJ2ZShiZXppZXJDb250cm9sUG9pbnRzWCk7CiAgICAgICAgICAgIGxldCBtaWRQb2ludFkgPSBHcmFwaC5jYWxjdWxhdGVNaWRQb2ludE9mQmV6aWVyQ3VydmUoYmV6aWVyQ29udHJvbFBvaW50c1kpOwogICAgICAgICAgICB0aGlzLmFkZFRleHRPdmVyQ2xlYXJCb3gobWlkUG9pbnRYLCBtaWRQb2ludFksIHRleHQpOwogICAgICAgIH0KICAgIH0KICAgIGFkZFRleHRPdmVyQ2xlYXJCb3goY2VudGVyWCwgY2VudGVyWSwgdGV4dCkgewogICAgICAgIGxldCB0ZXh0TGVuZ3RoID0gdGhpcy5jdHgubWVhc3VyZVRleHQodGV4dCkud2lkdGg7CiAgICAgICAgbGV0IHRleHRIZWlnaHQgPSB0aGlzLmN0eC5tZWFzdXJlVGV4dCgiTSIpLndpZHRoOwogICAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdChjZW50ZXJYIC0gdGV4dExlbmd0aCAvIDIgLSA0LCBjZW50ZXJZIC0gdGV4dEhlaWdodCAvIDIgLSA4LCB0ZXh0TGVuZ3RoICsgNCwgdGV4dEhlaWdodCArIDgpOwogICAgICAgIHRoaXMuY3R4LmZpbGxUZXh0KHRleHQsIGNlbnRlclggLSAyLCBjZW50ZXJZICsgNCk7CiAgICB9CiAgICBzdGF0aWMgY2FsY3VsYXRlTWlkUG9pbnRPZkJlemllckN1cnZlKGNvbnRyb2xQb2ludHMpIHsKICAgICAgICByZXR1cm4gY29udHJvbFBvaW50c1swXSAqIDEgLyA4ICsgY29udHJvbFBvaW50c1sxXSAqIDMgLyA4ICsgY29udHJvbFBvaW50c1syXSAqIDMgLyA4ICsgY29udHJvbFBvaW50c1szXSAqIDEgLyA4OwogICAgfQogICAgYWRkQmV6aWVyQ3VydmVUb1BhdGgoeHMsIHlzKSB7CiAgICAgICAgdGhpcy5jdHgubW92ZVRvKHhzWzBdLCB5c1swXSk7CiAgICAgICAgdGhpcy5jdHguYmV6aWVyQ3VydmVUbyh4c1sxXSwgeXNbMV0sIHhzWzJdLCB5c1syXSwgeHNbM10sIHlzWzNdKTsKICAgIH0KICAgIGRyYXdBcnJvdyh4MSwgeTEsIHgyLCB5MiwgdGV4dCA9ICIiLCBkaXJlY3Rpb25hbCA9IGZhbHNlKSB7CiAgICAgICAgbGV0IGhlYWRsZW4gPSAwOwogICAgICAgIGlmIChkaXJlY3Rpb25hbCkgewogICAgICAgICAgICBoZWFkbGVuID0gMTA7CiAgICAgICAgfQogICAgICAgIGxldCBhbmdsZSA9IE1hdGguYXRhbjIoeTIgLSB5MSwgeDIgLSB4MSk7CiAgICAgICAgaWYgKHRleHQgPT09IG51bGwgfHwgdGV4dCA9PT0gIiIpIHsKICAgICAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIHRoaXMuY3R4Lm1vdmVUbyh4MSwgeTEpOwogICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oeDIsIHkyKTsKICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKHgyIC0gaGVhZGxlbiAqIE1hdGguY29zKGFuZ2xlIC0gTWF0aC5QSSAvIDYpLCB5MiAtIGhlYWRsZW4gKiBNYXRoLnNpbihhbmdsZSAtIE1hdGguUEkgLyA2KSk7CiAgICAgICAgICAgIHRoaXMuY3R4Lm1vdmVUbyh4MiwgeTIpOwogICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oeDIgLSBoZWFkbGVuICogTWF0aC5jb3MoYW5nbGUgKyBNYXRoLlBJIC8gNiksIHkyIC0gaGVhZGxlbiAqIE1hdGguc2luKGFuZ2xlICsgTWF0aC5QSSAvIDYpKTsKICAgICAgICAgICAgdGhpcy5jdHguY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxldCBtaWRQb2ludFggPSAoeDEgKyB4MikgLyAyOwogICAgICAgICAgICBsZXQgbWlkUG9pbnRZID0gKHkxICsgeTIpIC8gMjsKICAgICAgICAgICAgbGV0IHNsb3BlID0gKHkyIC0geTEpIC8gKHgyIC0geDEpOwogICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgdGhpcy5jdHgubW92ZVRvKHgxLCB5MSk7CiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVUbyhtaWRQb2ludFgsIG1pZFBvaW50WSk7CiAgICAgICAgICAgIHRoaXMuY3R4Lm1vdmVUbyhtaWRQb2ludFgsIG1pZFBvaW50WSk7CiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVUbyh4MiwgeTIpOwogICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oeDIgLSBoZWFkbGVuICogTWF0aC5jb3MoYW5nbGUgLSBNYXRoLlBJIC8gNiksIHkyIC0gaGVhZGxlbiAqIE1hdGguc2luKGFuZ2xlIC0gTWF0aC5QSSAvIDYpKTsKICAgICAgICAgICAgdGhpcy5jdHgubW92ZVRvKHgyLCB5Mik7CiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVUbyh4MiAtIGhlYWRsZW4gKiBNYXRoLmNvcyhhbmdsZSArIE1hdGguUEkgLyA2KSwgeTIgLSBoZWFkbGVuICogTWF0aC5zaW4oYW5nbGUgKyBNYXRoLlBJIC8gNikpOwogICAgICAgICAgICB0aGlzLmN0eC5jbG9zZVBhdGgoKTsKICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7CiAgICAgICAgICAgIHRoaXMuYWRkVGV4dE92ZXJDbGVhckJveChtaWRQb2ludFgsIG1pZFBvaW50WSwgdGV4dCk7CiAgICAgICAgfQogICAgfQogICAgZ2V0Q29ubmVjdGlvbk1vZGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbk1vZGU7CiAgICB9CiAgICBzZXREaXJlY3Rpb25hbCgpIHsKICAgICAgICB0aGlzLmNvbm5lY3Rpb25Nb2RlID0gImRpcmVjdGlvbmFsIjsKICAgIH0KICAgIHNldEJpRGlyZWN0aW9uYWwoKSB7CiAgICAgICAgdGhpcy5jb25uZWN0aW9uTW9kZSA9ICJiaURpcmVjdGlvbmFsIjsKICAgIH0KICAgIGFjdGl2YXRlX2J1aWxkaW5nKCkgewogICAgICAgIHRoaXMuY29ubmVjdGlvbk1vZGUgPSAiYmlEaXJlY3Rpb25hbCI7CiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigiY29udGV4dG1lbnUiLCAoZSk9PmUucHJldmVudERlZmF1bHQoKQogICAgICAgICk7CiAgICAgICAgdGhpcy5idWlsZGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIGNsaWNrX2Rvd24uYmluZCh0aGlzKSk7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGNhcHR1cmUuYmluZCh0aGlzKSk7CiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigibW91c2V1cCIsIHJlbGVhc2VfY2xpY2suYmluZCh0aGlzKSk7CiAgICAgICAgdGhpcy5zdGFydCA9IHsKICAgICAgICAgICAgIngiOiBudWxsLAogICAgICAgICAgICAieSI6IG51bGwKICAgICAgICB9OwogICAgICAgIGxldCBhY3Rpb24gPSBudWxsOwogICAgICAgIGZ1bmN0aW9uIHJlbGVhc2VfY2xpY2soZSkgewogICAgICAgICAgICBpZiAoZS53aGljaCA9PSAyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGUud2hpY2ggPT0gMSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYnVpbGRpbmcpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgeF9kaXN0ID0gTWF0aC5wb3codGhpcy5tb3VzZXggLSB0aGlzLmJ1aWxkaW5nX3N0YXJ0WzBdLCAyKTsKICAgICAgICAgICAgICAgICAgICBsZXQgeV9kaXN0ID0gTWF0aC5wb3codGhpcy5tb3VzZXkgLSB0aGlzLmJ1aWxkaW5nX3N0YXJ0WzFdLCAyKTsKICAgICAgICAgICAgICAgICAgICBsZXQgZGlzdCA9IE1hdGguc3FydCh4X2Rpc3QgKyB5X2Rpc3QpOwogICAgICAgICAgICAgICAgICAgIGxldCBuZXdOb2RlID0gdGhpcy5ub2RlKHRoaXMuYnVpbGRpbmdfc3RhcnRbMF0sIHRoaXMuYnVpbGRpbmdfc3RhcnRbMV0sIGRpc3QsICIiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGVDcmVhdGVkQ2FsbGJhY2sobmV3Tm9kZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5idWlsZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlLndoaWNoID09IDMpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZSAhPSBudWxsICYmIHRoaXMuc3RhcnRbInN0YXJ0X25vZGUiXSkgewogICAgICAgICAgICAgICAgICAgIGxldCBleGlzdGluZ0VkZ2UgPSB0aGlzLmdldEVkZ2UodGhpcy5zdGFydFsic3RhcnRfbm9kZSJdLmlkLCB0aGlzLmFjdGl2ZS5pZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFleGlzdGluZ0VkZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5ld0VkZ2UgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uTW9kZSA9PT0gImJpRGlyZWN0aW9uYWwiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdFZGdlID0gdGhpcy5zdGFydFsic3RhcnRfbm9kZSJdLmNvbm5lY3QodGhpcy5hY3RpdmUpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY29ubmVjdGlvbk1vZGUgPT09ICJkaXJlY3Rpb25hbCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0VkZ2UgPSB0aGlzLnN0YXJ0WyJzdGFydF9ub2RlIl0uY29ubmVjdCh0aGlzLmFjdGl2ZSwgIiIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdFZGdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25DcmVhdGVkQ2FsbGJhY2sobmV3RWRnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3RpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQgPSB7CiAgICAgICAgICAgICAgICAgICAgIngiOiBudWxsLAogICAgICAgICAgICAgICAgICAgICJ5IjogbnVsbAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjbGlja19kb3duKGUpIHsKICAgICAgICAgICAgaWYgKGUud2hpY2ggPT0gMikgewogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlLndoaWNoID09IDEpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5idWlsZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5idWlsZGluZ19zdGFydCA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3VzZXgsCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW91c2V5CiAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZS53aGljaCA9PSAzKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0ID0gewogICAgICAgICAgICAgICAgICAgICJ4IjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAieSI6IG51bGwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0ID0gewogICAgICAgICAgICAgICAgICAgICJ4IjogdGhpcy5tb3VzZXgsCiAgICAgICAgICAgICAgICAgICAgInkiOiB0aGlzLm1vdXNleSwKICAgICAgICAgICAgICAgICAgICAiYWN0aXZlIjogdGhpcy5hY3RpdmUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmUgIT0gbnVsbCAmJiB0aGlzLmFjdGl2ZS50eXBlID09PSAibm9kZSIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3RpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0WyJhY3Rpb24iXSA9ICJjb25uZWN0IjsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0WyJzdGFydF9ub2RlIl0gPSB0aGlzLmFjdGl2ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3RpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3RpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjYXB0dXJlKGUpIHsKICAgICAgICAgICAgbGV0IGxldHRlcnMgPSAiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjEyMzQ1Njc4OTAhQCMkJV4mKigpXyt+XFwvPzw+JyIgKyAnIi4sOzp+YFtde318LT0gJzsKICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChsZXR0ZXJzLmluZGV4T2YoZS5rZXkpID4gLTEpIHsKICAgICAgICAgICAgICAgICAgICBlLm91dHB1dCA9IGUua2V5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGUua2V5ID09ICJEZWxldGUiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUuZGVsZXRlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZS5rZXkgPT09ICIgIikgewogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PSAiQmFja3NwYWNlIikgewogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZS5zZXRUZXh0KHRoaXMuYWN0aXZlLnRleHQuc3Vic3RyaW5nKDAsIHRoaXMuYWN0aXZlLnRleHQubGVuZ3RoIC0gMSkpOwogICAgICAgICAgICAgICAgICAgIGUub3V0cHV0ID0gIiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZS5vdXRwdXQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZS50ZXh0ICs9IGUub3V0cHV0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgY2hlY2tfbW91c2UoKSB7CiAgICAgICAgbGV0IHJlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICB0aGlzLm9mZnNldHggPSByZWN0LmxlZnQ7CiAgICAgICAgdGhpcy5vZmZzZXR5ID0gcmVjdC50b3A7CiAgICAgICAgdGhpcy5hY3RpdmUgPSBudWxsOwogICAgICAgIHRoaXMubW91c2VfYWN0aXZhdGVkID0gdHJ1ZTsKICAgICAgICBmdW5jdGlvbiBjaGVjayhlKSB7CiAgICAgICAgICAgIHRoaXMubW91c2V4ID0gZS54IC0gcmVjdC5sZWZ0OwogICAgICAgICAgICB0aGlzLm1vdXNleSA9IGUueSAtIHJlY3QudG9wICsgdGhpcy5weF9kb3duOwogICAgICAgICAgICBmb3IgKGxldCBub2RlIG9mIE9iamVjdC52YWx1ZXModGhpcy5vYmpzKSl7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5pbnNpZGUodGhpcy5tb3VzZXgsIHRoaXMubW91c2V5KSkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gInBvaW50ZXIiOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlID0gbm9kZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChsZXQgZWRnZSBvZiBPYmplY3QudmFsdWVzKHRoaXMuZWRnZXMpKXsKICAgICAgICAgICAgICAgIGlmIChlZGdlLmluc2lkZSh0aGlzLm1vdXNleCwgdGhpcy5tb3VzZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAicG9pbnRlciI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSBlZGdlOwogICAgICAgICAgICAgICAgICAgIGVkZ2Uuc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVkZ2Uuc2VsZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWRnZS5zZWxlY3RlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICJkZWZhdWx0IjsKICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSBudWxsOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhZGp1c3Rfc2NvbGwoZSkgewogICAgICAgICAgICB0aGlzLnB4X2Rvd24gPSB3aW5kb3cucGFnZVlPZmZzZXQgIT09IHVuZGVmaW5lZCA/IHdpbmRvdy5wYWdlWU9mZnNldCA6IChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgfHwgZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlIHx8IGRvY3VtZW50LmJvZHkpLnNjcm9sbFRvcDsKICAgICAgICB9CiAgICAgICAgdGhpcy5weF9kb3duID0gMDsKICAgICAgICB0aGlzLnBvaW50aW5nX2NoZWNrID0gY2hlY2suYmluZCh0aGlzKTsKICAgIH0KICAgIGRlcHRoRmlyc3RTZWFyY2goc3RhcnRpZCwgZW5kaWQsIGRyYXdfcGF0aCwgZGVsYXkgPSAwKSB7CiAgICAgICAgY29uc29sZS5sb2coImluc2lkZSBmdW5jdGlvbiIpOwogICAgICAgIGxldCBkaXNjb3ZlcmVkX3N0YWNrID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibm9kZWlkIjogc3RhcnRpZCwKICAgICAgICAgICAgICAgICJwYXJlbnRpZCI6IHN0YXJ0aWQKICAgICAgICAgICAgfQogICAgICAgIF07CiAgICAgICAgbGV0IHZpc2l0ZWQgPSB7CiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBnZXRQYXRoKG5vZGVvYmosIGRyYXdfcGF0aCA9IHRydWUpIHsKICAgICAgICAgICAgbGV0IHBhdGggPSBbXTsKICAgICAgICAgICAgd2hpbGUobm9kZW9iai5ub2RlaWQgIT09IG5vZGVvYmoucGFyZW50aWQpewogICAgICAgICAgICAgICAgaWYgKGRyYXdfcGF0aCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0RWRnZShub2Rlb2JqLnBhcmVudGlkLCBub2Rlb2JqLm5vZGVpZCkuc2V0Q29sb3IoInJlZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGF0aC51bnNoaWZ0KG5vZGVvYmoubm9kZWlkKTsKICAgICAgICAgICAgICAgIG5vZGVvYmogPSB2aXNpdGVkW25vZGVvYmoucGFyZW50aWRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwYXRoOwogICAgICAgIH0KICAgICAgICBnZXRQYXRoID0gZ2V0UGF0aC5iaW5kKHRoaXMpOwogICAgICAgIGxldCBldmF1bGF0ZU5vZGUgPSBmdW5jdGlvbihub2Rlb2JqZWN0KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJoZXJlIik7CiAgICAgICAgICAgIGlmICh2aXNpdGVkLmhhc093blByb3BlcnR5KG5vZGVvYmplY3Qubm9kZWlkKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2YXVsYXRlTm9kZShkaXNjb3ZlcmVkX3N0YWNrLnNoaWZ0KCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChub2Rlb2JqZWN0Lm5vZGVpZCA9PT0gZW5kaWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQYXRoKG5vZGVvYmplY3QpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZpc2l0ZWRbbm9kZW9iamVjdC5ub2RlaWRdID0gbm9kZW9iamVjdDsKICAgICAgICAgICAgbGV0IGN1cnJlbnROb2RlID0gdGhpcy5nZXROb2RlQnlJZChub2Rlb2JqZWN0Lm5vZGVpZCk7CiAgICAgICAgICAgIGxldCBjaGlsZHJlbk9ianMgPSBjdXJyZW50Tm9kZS5jaGlsZHJlbi5tYXAoKG5vZGVpZCk9PnsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgbm9kZWlkOiBub2RlaWQsCiAgICAgICAgICAgICAgICAgICAgcGFyZW50aWQ6IGN1cnJlbnROb2RlLmlkCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZGlzY292ZXJlZF9zdGFjay51bnNoaWZ0KC4uLmNoaWxkcmVuT2Jqcyk7CiAgICAgICAgICAgIGV2YXVsYXRlTm9kZShkaXNjb3ZlcmVkX3N0YWNrLnNoaWZ0KCkpOwogICAgICAgIH07CiAgICAgICAgZXZhdWxhdGVOb2RlID0gZXZhdWxhdGVOb2RlLmJpbmQodGhpcyk7CiAgICAgICAgcmV0dXJuIGV2YXVsYXRlTm9kZShkaXNjb3ZlcmVkX3N0YWNrLnNoaWZ0KCkpOwogICAgfQogICAgYnJlYWR0aEZpcnN0U2VhcmNoKHN0YXJ0aWQsIGVuZGlkLCBkcmF3X3BhdGgsIGRlbGF5ID0gMCkgewogICAgICAgIGNvbnNvbGUubG9nKCJpbnNpZGUgZnVuY3Rpb24iKTsKICAgICAgICBsZXQgc3RhcnQgPSB0aGlzLmdldE5vZGVCeUlkKHN0YXJ0aWQpOwogICAgICAgIGxldCBlbmQgPSB0aGlzLmdldE5vZGVCeUlkKGVuZGlkKTsKICAgICAgICBsZXQgZGlzY292ZXJlZCA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbm9kZTogc3RhcnRpZCwKICAgICAgICAgICAgICAgIHBhcmVudDogc3RhcnRpZAogICAgICAgICAgICB9CiAgICAgICAgXTsKICAgICAgICBsZXQgdmlzaXRlZCA9IHsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIGdldFBhdGgobm9kZW9iaiwgZHJhd19wYXRoID0gdHJ1ZSkgewogICAgICAgICAgICBsZXQgcGF0aCA9IFtdOwogICAgICAgICAgICB3aGlsZShub2Rlb2JqLm5vZGUgIT09IG5vZGVvYmoucGFyZW50KXsKICAgICAgICAgICAgICAgIGlmIChkcmF3X3BhdGgpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEVkZ2Uobm9kZW9iai5wYXJlbnQsIG5vZGVvYmoubm9kZSkuc2V0Q29sb3IoInJlZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGF0aC51bnNoaWZ0KG5vZGVvYmoubm9kZSk7CiAgICAgICAgICAgICAgICBub2Rlb2JqID0gdmlzaXRlZFtub2Rlb2JqLnBhcmVudF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHBhdGg7CiAgICAgICAgfQogICAgICAgIGdldFBhdGggPSBnZXRQYXRoLmJpbmQodGhpcyk7CiAgICAgICAgY29uc29sZS5sb2coZGlzY292ZXJlZCk7CiAgICAgICAgZm9yKGxldCBpMSA9IDA7IGkxIDwgZGlzY292ZXJlZC5sZW5ndGg7IGkxKyspewogICAgICAgICAgICBpZiAodmlzaXRlZC5oYXNPd25Qcm9wZXJ0eShkaXNjb3ZlcmVkW2kxXS5ub2RlKSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRpc2NvdmVyZWRbaTFdLm5vZGUgPT09IGVuZGlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UGF0aChkaXNjb3ZlcmVkW2kxXSwgZHJhd19wYXRoID0gZHJhd19wYXRoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxldCBjdXJyZW50Tm9kZSA9IHRoaXMuZ2V0Tm9kZUJ5SWQoZGlzY292ZXJlZFtpMV0ubm9kZSk7CiAgICAgICAgICAgICAgICBsZXQgY2hpbGRyZW5PYmpzID0gY3VycmVudE5vZGUuY2hpbGRyZW4ubWFwKChub2RlaWQpPT57CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogbm9kZWlkLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IGRpc2NvdmVyZWRbaTFdLm5vZGUKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBkaXNjb3ZlcmVkLnB1c2goLi4uY2hpbGRyZW5PYmpzKTsKICAgICAgICAgICAgICAgIHZpc2l0ZWRbZGlzY292ZXJlZFtpMV0ubm9kZV0gPSBkaXNjb3ZlcmVkW2kxXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIEFzdGFyKHN0YXJ0aWQsIGVuZGlkLCBkcmF3X3BhdGggPSB0cnVlLCBkZWxheSA9IDApIHsKICAgICAgICBsZXQgc3RhcnQgPSB0aGlzLmdldE5vZGVCeUlkKHN0YXJ0aWQpOwogICAgICAgIGxldCBlbmQgPSB0aGlzLmdldE5vZGVCeUlkKGVuZGlkKTsKICAgICAgICBsZXQgdmlzaXRlZCA9IHsKICAgICAgICB9OwogICAgICAgIGxldCBkYXRhID0gewogICAgICAgIH07CiAgICAgICAgbGV0IGRpc2NvdmVyZWQgPSBuZXcgUHJpb3JpdHlRdWV1ZSgpOwogICAgICAgIGZ1bmN0aW9uIGRhdGFDYXJkKG5vZGVpZCwgdmlhaWQsIGNvc3QsIGRpc3RhbmNlKSB7CiAgICAgICAgICAgIHRoaXMubm9kZWlkID0gbm9kZWlkOwogICAgICAgICAgICB0aGlzLmNvc3QgPSBjb3N0OwogICAgICAgICAgICB0aGlzLnZpYWlkID0gdmlhaWQ7CiAgICAgICAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZXZhbHVhdGVOb2RlKG5vZGVpZCwgY29zdCkgewogICAgICAgICAgICBpZiAodmlzaXRlZFtub2RlaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgcm9vdCA9IHRoaXMuZ2V0Tm9kZUJ5SWQobm9kZWlkKTsKICAgICAgICAgICAgZm9yKGxldCBpMSA9IDA7IGkxIDwgcm9vdC5jaGlsZHJlbi5sZW5ndGg7IGkxKyspewogICAgICAgICAgICAgICAgbGV0IG5vZGUgPSB0aGlzLmdldE5vZGVCeUlkKHJvb3QuY2hpbGRyZW5baTFdKTsKICAgICAgICAgICAgICAgIGlmICh2aXNpdGVkW25vZGUuaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCBlZGdlID0gdGhpcy5nZXRFZGdlKHJvb3QuaWQsIG5vZGUuaWQpOwogICAgICAgICAgICAgICAgbGV0IHdlaWdodCA9IGVkZ2Uud2VpZ2h0OwogICAgICAgICAgICAgICAgbGV0IGNhcmQgPSBuZXcgZGF0YUNhcmQobm9kZS5pZCwgcm9vdC5pZCwgY29zdCArIHdlaWdodCwgTWF0aC5mbG9vcih0aGlzLmdldERpc3RhbmNlKHJvb3QuaWQsIGVuZC5pZCkpIC0gMSk7CiAgICAgICAgICAgICAgICBsZXQga2V5MSA9IG5vZGUuaWQ7CiAgICAgICAgICAgICAgICBpZiAoZGlzY292ZXJlZC5oYXNJdGVtKGtleTEpKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG9sZEl0ZW0gPSBkaXNjb3ZlcmVkLmdldEl0ZW1CeUtleShrZXkxKTsKICAgICAgICAgICAgICAgICAgICBpZiAob2xkSXRlbS5pdGVtLmNvc3QgPiBjYXJkLmNvc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzY292ZXJlZC5yZXBsYWNlKGNhcmQsIGNhcmQuY29zdCwga2V5MSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkaXNjb3ZlcmVkLmluc2VydChjYXJkLCBjYXJkLmNvc3QgKyBjYXJkLmRpc3RhbmNlLCBrZXkxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBldmFsdWF0ZU5vZGUgPSBldmFsdWF0ZU5vZGUuYmluZCh0aGlzKTsKICAgICAgICBkaXNjb3ZlcmVkLmluc2VydChuZXcgZGF0YUNhcmQoc3RhcnRpZCwgc3RhcnRpZCwgMCksIDApOwogICAgICAgIHdoaWxlKGRpc2NvdmVyZWQucXVldWUubGVuZ3RoID4gMCl7CiAgICAgICAgICAgIGxldCBjdXJyZW50X25vZGUgPSBkaXNjb3ZlcmVkLmRlcXVldWUoKTsKICAgICAgICAgICAgaWYgKGN1cnJlbnRfbm9kZS5pdGVtLm5vZGVpZCA9PT0gZW5kaWQpIHsKICAgICAgICAgICAgICAgIGxldCBvdXRwdXQgPSB7CiAgICAgICAgICAgICAgICAgICAgY29zdDogY3VycmVudF9ub2RlLml0ZW0uY29zdCwKICAgICAgICAgICAgICAgICAgICBwYXRoOiBbXQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIG91dHB1dC5wYXRoLnVuc2hpZnQoY3VycmVudF9ub2RlLml0ZW0ubm9kZWlkKTsKICAgICAgICAgICAgICAgIHdoaWxlKGN1cnJlbnRfbm9kZS5pdGVtLm5vZGVpZCAhPT0gc3RhcnRpZCl7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudF9ub2RlID0gdmlzaXRlZFtjdXJyZW50X25vZGUuaXRlbS52aWFpZF07CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnBhdGgudW5zaGlmdChjdXJyZW50X25vZGUuaXRlbS5ub2RlaWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGRyYXdfcGF0aCkgewogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaTEgPSAwOyBpMSA8IG91dHB1dC5wYXRoLmxlbmd0aCAtIDE7IGkxKyspewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEVkZ2Uob3V0cHV0LnBhdGhbaTFdLCBvdXRwdXQucGF0aFtpMSArIDFdKS5zZXRDb2xvcigicmVkIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgbm9kZWlkID0gY3VycmVudF9ub2RlLml0ZW0ubm9kZWlkOwogICAgICAgICAgICBldmFsdWF0ZU5vZGUoY3VycmVudF9ub2RlLml0ZW0ubm9kZWlkLCBjdXJyZW50X25vZGUuaXRlbS5jb3N0KTsKICAgICAgICAgICAgdmlzaXRlZFtub2RlaWRdID0gY3VycmVudF9ub2RlOwogICAgICAgIH0KICAgIH0KICAgIGRpaWprc3RyYShzdGFydGlkLCBlbmRpZCwgZHJhd19wYXRoID0gdHJ1ZSkgewogICAgICAgIGxldCBzdGFydCA9IHRoaXMuZ2V0Tm9kZUJ5SWQoc3RhcnRpZCk7CiAgICAgICAgbGV0IGVuZCA9IHRoaXMuZ2V0Tm9kZUJ5SWQoZW5kaWQpOwogICAgICAgIGxldCB2aXNpdGVkID0gewogICAgICAgIH07CiAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgfTsKICAgICAgICBsZXQgZGlzY292ZXJlZCA9IG5ldyBHcmFwaC5wcmlvcml0eVF1ZXVlKCk7CiAgICAgICAgZnVuY3Rpb24gZGF0YUNhcmQobm9kZWlkLCB2aWFpZCwgY29zdCkgewogICAgICAgICAgICB0aGlzLm5vZGVpZCA9IG5vZGVpZDsKICAgICAgICAgICAgdGhpcy5jb3N0ID0gY29zdDsKICAgICAgICAgICAgdGhpcy52aWFpZCA9IHZpYWlkOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBldmFsdWF0ZU5vZGUobm9kZWlkLCBjb3N0KSB7CiAgICAgICAgICAgIGlmICh2aXNpdGVkW25vZGVpZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCByb290ID0gdGhpcy5nZXROb2RlQnlJZChub2RlaWQpOwogICAgICAgICAgICBmb3IobGV0IGkxID0gMDsgaTEgPCByb290LmNoaWxkcmVuLmxlbmd0aDsgaTErKyl7CiAgICAgICAgICAgICAgICBsZXQgbm9kZSA9IHRoaXMuZ2V0Tm9kZUJ5SWQocm9vdC5jaGlsZHJlbltpMV0pOwogICAgICAgICAgICAgICAgaWYgKHZpc2l0ZWRbbm9kZS5pZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGV0IGVkZ2UgPSB0aGlzLmdldEVkZ2Uocm9vdC5pZCwgbm9kZS5pZCk7CiAgICAgICAgICAgICAgICBsZXQgd2VpZ2h0ID0gZWRnZS53ZWlnaHQ7CiAgICAgICAgICAgICAgICBsZXQgY2FyZCA9IG5ldyBkYXRhQ2FyZChub2RlLmlkLCByb290LmlkLCBjb3N0ICsgd2VpZ2h0KTsKICAgICAgICAgICAgICAgIGxldCBrZXkxID0gbm9kZS5pZDsKICAgICAgICAgICAgICAgIGlmIChkaXNjb3ZlcmVkLmhhc0l0ZW0oa2V5MSkpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgb2xkSXRlbSA9IGRpc2NvdmVyZWQuZ2V0SXRlbUJ5S2V5KGtleTEpOwogICAgICAgICAgICAgICAgICAgIGlmIChvbGRJdGVtLml0ZW0uY29zdCA+IGNhcmQuY29zdCkgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3ZlcmVkLnJlcGxhY2UoY2FyZCwgY2FyZC5jb3N0LCBrZXkxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRpc2NvdmVyZWQuaW5zZXJ0KGNhcmQsIGNhcmQuY29zdCwga2V5MSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZXZhbHVhdGVOb2RlID0gZXZhbHVhdGVOb2RlLmJpbmQodGhpcyk7CiAgICAgICAgZGlzY292ZXJlZC5pbnNlcnQobmV3IGRhdGFDYXJkKHN0YXJ0aWQsIHN0YXJ0aWQsIDApLCAwKTsKICAgICAgICB3aGlsZShkaXNjb3ZlcmVkLnF1ZXVlLmxlbmd0aCA+IDApewogICAgICAgICAgICBsZXQgY3VycmVudF9ub2RlID0gZGlzY292ZXJlZC5kZXF1ZXVlKCk7CiAgICAgICAgICAgIGlmIChjdXJyZW50X25vZGUuaXRlbS5ub2RlaWQgPT09IGVuZGlkKSB7CiAgICAgICAgICAgICAgICBsZXQgb3V0cHV0ID0gewogICAgICAgICAgICAgICAgICAgIGNvc3Q6IGN1cnJlbnRfbm9kZS5pdGVtLmNvc3QsCiAgICAgICAgICAgICAgICAgICAgcGF0aDogW10KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBvdXRwdXQucGF0aC51bnNoaWZ0KGN1cnJlbnRfbm9kZS5pdGVtLm5vZGVpZCk7CiAgICAgICAgICAgICAgICB3aGlsZShjdXJyZW50X25vZGUuaXRlbS5ub2RlaWQgIT09IHN0YXJ0aWQpewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbm9kZSA9IHZpc2l0ZWRbY3VycmVudF9ub2RlLml0ZW0udmlhaWRdOwogICAgICAgICAgICAgICAgICAgIG91dHB1dC5wYXRoLnVuc2hpZnQoY3VycmVudF9ub2RlLml0ZW0ubm9kZWlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkcmF3X3BhdGgpIHsKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkxID0gMDsgaTEgPCBvdXRwdXQucGF0aC5sZW5ndGggLSAxOyBpMSsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRFZGdlKG91dHB1dC5wYXRoW2kxXSwgb3V0cHV0LnBhdGhbaTEgKyAxXSkuc2V0Q29sb3IoInJlZCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IG5vZGVpZCA9IGN1cnJlbnRfbm9kZS5pdGVtLm5vZGVpZDsKICAgICAgICAgICAgZXZhbHVhdGVOb2RlKGN1cnJlbnRfbm9kZS5pdGVtLm5vZGVpZCwgY3VycmVudF9ub2RlLml0ZW0uY29zdCk7CiAgICAgICAgICAgIHZpc2l0ZWRbbm9kZWlkXSA9IGN1cnJlbnRfbm9kZTsKICAgICAgICB9CiAgICB9CiAgICB1cGRhdGUoKSB7CiAgICAgICAgbGV0IG5vZGVzID0gT2JqZWN0LnZhbHVlcyh0aGlzLm9ianMpOwogICAgICAgIG5vZGVzLm1hcCgobm9kZSk9Pm5vZGUudXBkYXRlKCkKICAgICAgICApOwogICAgICAgIHRoaXMuZHJhd0VkZ2VzKCk7CiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGluZykgewogICAgICAgICAgICBsZXQgeWZsaXBwZXIgPSAxOwogICAgICAgICAgICBsZXQgeGZsaXBwZXIgPSAxOwogICAgICAgICAgICBsZXQgc2xvcGUgPSAodGhpcy5tb3VzZXkgLSB0aGlzLnN0YXJ0LmFjdGl2ZS55KSAvICh0aGlzLm1vdXNleCAtIHRoaXMuc3RhcnQuYWN0aXZlLngpOwogICAgICAgICAgICBpZiAodGhpcy5tb3VzZXggPD0gdGhpcy5zdGFydC5hY3RpdmUueCkgewogICAgICAgICAgICAgICAgeGZsaXBwZXIgPSAtMTsKICAgICAgICAgICAgICAgIHlmbGlwcGVyID0gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zdGFydC5zdGFydF9ub2RlLmFycm93KHRoaXMubW91c2V4LCB0aGlzLm1vdXNleSk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLmJ1aWxkaW5nKSB7CiAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZVN0eWxlID0gIiMwMDAiOwogICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgbGV0IHhfZGlzdCA9IE1hdGgucG93KHRoaXMubW91c2V4IC0gdGhpcy5idWlsZGluZ19zdGFydFswXSwgMik7CiAgICAgICAgICAgIGxldCB5X2Rpc3QgPSBNYXRoLnBvdyh0aGlzLm1vdXNleSAtIHRoaXMuYnVpbGRpbmdfc3RhcnRbMV0sIDIpOwogICAgICAgICAgICBsZXQgZGlzdCA9IE1hdGguc3FydCh4X2Rpc3QgKyB5X2Rpc3QpOwogICAgICAgICAgICB0aGlzLmN0eC5hcmModGhpcy5idWlsZGluZ19zdGFydFswXSwgdGhpcy5idWlsZGluZ19zdGFydFsxXSwgZGlzdCwgMCwgMiAqIE1hdGguUEkpOwogICAgICAgICAgICB0aGlzLmN0eC5jbG9zZVBhdGgoKTsKICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMudGlja0NhbGxiYWNrKHRoaXMpOwogICAgfQogICAgZ2V0Tm9kZUJ5SWQoaWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmpzW2lkXTsKICAgIH0KICAgIGdldEVkZ2VCeUlkKGlkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZWRnZXNbaWRdOwogICAgfQogICAgZHJhd0VkZ2VzKCkgewogICAgICAgIGZvciAobGV0IGVkZ2Ugb2YgT2JqZWN0LnZhbHVlcyh0aGlzLmVkZ2VzKSl7CiAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5jb2xvcjsKICAgICAgICAgICAgZWRnZS5kcmF3KCk7CiAgICAgICAgfQogICAgfQogICAgZ2V0RGlzdGFuY2Uoc3RhcnROb2RlSWQsIGVuZE5vZGVJZCkgewogICAgICAgIGxldCBzdGFydCA9IHRoaXMuZ2V0Tm9kZUJ5SWQoc3RhcnROb2RlSWQpOwogICAgICAgIGxldCBlbmQgPSB0aGlzLmdldE5vZGVCeUlkKGVuZE5vZGVJZCk7CiAgICAgICAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdyhlbmQueSAtIHN0YXJ0LnksIDIpICsgTWF0aC5wb3coZW5kLnggLSBzdGFydC54LCAyKSk7CiAgICB9CiAgICBhY3RpdmF0ZV9lZGl0aW5nKGZwcykgewogICAgICAgIGxldCBkcmFnZ2luZyA9IGZhbHNlOwogICAgICAgIGxldCB4ZGlzdCA9IG51bGw7CiAgICAgICAgbGV0IHlkaXN0ID0gbnVsbDsKICAgICAgICBsZXQgbWFpbl9ub2RlID0gbnVsbDsKICAgICAgICBpZiAodGhpcy5tb3VzZV9hY3RpdmF0ZWQgIT09IHRydWUpIHsKICAgICAgICAgICAgdGhyb3cgIm1vdXNlIG11c3QgYmUgZmlyc3QgaW5pdGlsaXplZCI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHN0YXJ0X2RyYWdnaW5nKGUpIHsKICAgICAgICAgICAgaWYgKGUud2hpY2ggPT0gMiB8fCBlLndoaWNoID09IDMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmUpIHsKICAgICAgICAgICAgICAgIHhkaXN0ID0gdGhpcy5hY3RpdmUueCAtIHRoaXMubW91c2V4OwogICAgICAgICAgICAgICAgeWRpc3QgPSB0aGlzLmFjdGl2ZS55IC0gdGhpcy5tb3VzZXk7CiAgICAgICAgICAgICAgICBjb25zdCBkZWFjdGl2YXRlTm9kZSA9IG1haW5fbm9kZTsKICAgICAgICAgICAgICAgIG1haW5fbm9kZSA9IHRoaXMuYWN0aXZlOwogICAgICAgICAgICAgICAgbWFpbl9ub2RlLmNvbG9yID0gdGhpcy5hY3RpdmVDb2xvcjsKICAgICAgICAgICAgICAgIHRoaXMuZGVBY3RpdmF0ZU5vZGVDYWxsYmFjayhkZWFjdGl2YXRlTm9kZSk7CiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2YXRlTm9kZUNhbGxiYWNrKGRlYWN0aXZhdGVOb2RlLCBtYWluX25vZGUpOwogICAgICAgICAgICAgICAgZHJhZ2dpbmcgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGVuZF9kcmFnZ2luZyhlKSB7CiAgICAgICAgICAgIGlmIChlLndoaWNoID09IDIgfHwgZS53aGljaCA9PSAzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbWFpbmxvb3AoKSB7CiAgICAgICAgICAgIGlmIChkcmFnZ2luZykgewogICAgICAgICAgICAgICAgbWFpbl9ub2RlLnggPSB0aGlzLm1vdXNleCArIHhkaXN0OwogICAgICAgICAgICAgICAgbWFpbl9ub2RlLnkgPSB0aGlzLm1vdXNleSArIHlkaXN0OwogICAgICAgICAgICAgICAgbGV0IHByZXZ4ID0gdGhpcy5tb3VzZXg7CiAgICAgICAgICAgICAgICBsZXQgcHJldnkgPSB0aGlzLm1vdXNleTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnVwZGF0ZSgpOwogICAgICAgIH0KICAgICAgICB0aGlzLmRyYWdfc3RhcnQgPSBzdGFydF9kcmFnZ2luZy5iaW5kKHRoaXMpOwogICAgICAgIHRoaXMuZHJhZ19lbmQgPSBlbmRfZHJhZ2dpbmcuYmluZCh0aGlzKTsKICAgICAgICB0aGlzLmRyYXcgPSBtYWlubG9vcC5iaW5kKHRoaXMpOwogICAgfQogICAgZG91YmxlQ2xpY2sgPSAoZSk9PnsKICAgICAgICBpZiAoZS53aGljaCA9PSAyIHx8IGUud2hpY2ggPT0gMykgewogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLmFjdGl2ZSkgewogICAgICAgICAgICB0aGlzLmRvdWJsZUNsaWNrZWROb2RlQ2FsbGJhY2sodGhpcy5hY3RpdmUpOwogICAgICAgIH0KICAgIH07CiAgICBkcmF3ID0gKCk9PnsKICAgIH07CiAgICBkcmFnX3N0YXJ0ID0gKGUpPT57CiAgICB9OwogICAgZHJhZ19lbmQgPSAoZSk9PnsKICAgIH07CiAgICBwb2ludGluZ19jaGVjayA9IChlKT0+ewogICAgfTsKICAgIGVkZ2Uoc3RhcnROb2RlaWQsIGVuZE5vZGVpZCwgY29sb3IgPSAiI2FhYSIsIHRleHQgPSAiIiwgZGlyZWN0aW9uYWwgPSBmYWxzZSkgewogICAgICAgIHJldHVybiBHcmFwaC5fZWRnZSh0aGlzLmlkLCBzdGFydE5vZGVpZCwgZW5kTm9kZWlkLCBjb2xvciwgdGV4dCwgZGlyZWN0aW9uYWwpOwogICAgfQogICAgbm9kZSh4LCB5LCByLCB0ZXh0ID0gIiIsIGhhc2ggPSAiIikgewogICAgICAgIGNvbnN0IG5vZGUgPSBHcmFwaC5fbm9kZSh0aGlzLmlkLCB4LCB5LCByLCB0ZXh0LCBoYXNoKTsKICAgICAgICB0aGlzLm5vZGVTZXR1cENhbGxiYWNrKG5vZGUpOwogICAgICAgIHJldHVybiBub2RlOwogICAgfQp9CmNsYXNzIEVkZ2UgewogICAgdHlwZSA9ICJlZGdlIjsKICAgIHNsb3BlOwogICAgY29sb3IgPSAicmdiKDAsMCwwKSI7CiAgICBhbHRDb2xvciA9ICJyZ2IoMjU1LDAsMCkiOwogICAgc2VsZWN0ZWQgPSBmYWxzZTsKICAgIGNvbnN0cnVjdG9yKGNvbnRleHRpZCwgc3RhcnROb2RlaWQsIGVuZE5vZGVpZCwgY29sb3IsIHRleHQsIGRpcmVjdGlvbmFsMSl7CiAgICAgICAgdGhpcy5jb250ZXh0aWQgPSBjb250ZXh0aWQ7CiAgICAgICAgdGhpcy5zdGFydE5vZGVpZCA9IHN0YXJ0Tm9kZWlkOwogICAgICAgIHRoaXMuZW5kTm9kZWlkID0gZW5kTm9kZWlkOwogICAgICAgIGxldCBpZF90aW1lMSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIHRoaXMuaWQgPSBOdW1iZXIoaWRfdGltZTEudG9TdHJpbmcoKSArIE9iamVjdC52YWx1ZXMoR3JhcGguZ2V0Q29udGV4dCh0aGlzLmNvbnRleHRpZCkuZWRnZXMpLmxlbmd0aC50b1N0cmluZygpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygpKTsKICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwogICAgICAgIHRoaXMud2VpZ2h0ID0gcGFyc2VGbG9hdCh0ZXh0KTsKICAgICAgICBpZiAoaXNOYU4odGhpcy53ZWlnaHQpKSB7CiAgICAgICAgICAgIHRoaXMud2VpZ2h0ID0gMDsKICAgICAgICB9CiAgICAgICAgdGhpcy5kaXJlY3Rpb25hbCA9IGRpcmVjdGlvbmFsMTsKICAgICAgICBsZXQgc3RhcnQgPSBHcmFwaC5nZXRDb250ZXh0KHRoaXMuY29udGV4dGlkKS5nZXROb2RlQnlJZChzdGFydE5vZGVpZCk7CiAgICAgICAgc3RhcnQuZWRnZXNbdGhpcy5pZF0gPSB0aGlzLmVuZE5vZGVpZDsKICAgICAgICBpZiAoIXRoaXMuZGlyZWN0aW9uYWwpIHsKICAgICAgICAgICAgbGV0IGVuZCA9IEdyYXBoLmdldENvbnRleHQodGhpcy5jb250ZXh0aWQpLmdldE5vZGVCeUlkKGVuZE5vZGVpZCk7CiAgICAgICAgICAgIGVuZC5lZGdlc1t0aGlzLmlkXSA9IHRoaXMuc3RhcnROb2RlaWQ7CiAgICAgICAgfQogICAgfQogICAgaXNEaXJlY3Rpb25hbCA9ICgpPT57CiAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uYWwgPT09IHRydWU7CiAgICB9OwogICAgc2V0VGV4dCA9ICh0ZXh0MSk9PnsKICAgICAgICB0aGlzLnRleHQgPSB0ZXh0MTsKICAgICAgICB0aGlzLndlaWdodCA9IHBhcnNlRmxvYXQodGV4dDEpIHx8IDA7CiAgICB9OwogICAgdG9nZ2xlU2VsZWN0ZWQgPSAoKT0+ewogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkKSB7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICB9OwogICAgaXNCaURpcmVjdGlvbmFsID0gKCk9PnsKICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb25hbCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICBzZXREaXJlY3Rpb25hbCA9ICgpPT57CiAgICAgICAgdGhpcy5kaXJlY3Rpb25hbCA9IHRydWU7CiAgICB9OwogICAgc2V0VW5kaXJlY3Rpb25hbCA9ICgpPT57CiAgICAgICAgdGhpcy5kaXJlY3Rpb25hbCA9IGZhbHNlOwogICAgfTsKICAgIHNldFdlaWdodCA9ICh3ZWlnaHQpPT57CiAgICAgICAgdGhpcy53ZWlnaHQgPSB3ZWlnaHQ7CiAgICB9OwogICAgZGVsZXRlID0gKCk9PnsKICAgICAgICBsZXQgY29udGV4dCA9IEdyYXBoLmdldENvbnRleHQodGhpcy5jb250ZXh0aWQpOwogICAgICAgIGxldCBzdGFydDEgPSBjb250ZXh0LmdldE5vZGVCeUlkKHRoaXMuc3RhcnROb2RlaWQpOwogICAgICAgIGxldCBlbmQgPSBjb250ZXh0LmdldE5vZGVCeUlkKHRoaXMuZW5kTm9kZWlkKTsKICAgICAgICBkZWxldGUgc3RhcnQxLmVkZ2VzW3RoaXMuaWRdOwogICAgICAgIGRlbGV0ZSBlbmQuZWRnZXNbdGhpcy5pZF07CiAgICAgICAgZm9yKGxldCBpMSA9IDA7IGkxIDwgc3RhcnQxLmNoaWxkcmVuLmxlbmd0aDsgaTErKyl7CiAgICAgICAgICAgIGlmIChzdGFydDEuY2hpbGRyZW5baTFdID09PSB0aGlzLmVuZE5vZGVpZCkgewogICAgICAgICAgICAgICAgc3RhcnQxLmNoaWxkcmVuLnNwbGljZShpMSwgMSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5pc0JpRGlyZWN0aW9uYWwoKSkgewogICAgICAgICAgICBmb3IobGV0IGkyID0gMDsgaTIgPCBlbmQuY2hpbGRyZW4ubGVuZ3RoOyBpMisrKXsKICAgICAgICAgICAgICAgIGlmIChlbmQuY2hpbGRyZW5baTJdID09PSB0aGlzLnN0YXJ0Tm9kZWlkKSB7CiAgICAgICAgICAgICAgICAgICAgZW5kLmNoaWxkcmVuLnNwbGljZShpMiwgMSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZGVsZXRlIGNvbnRleHQuZWRnZXNbdGhpcy5pZF07CiAgICAgICAgZGVsZXRlIHRoaXM7CiAgICB9OwogICAgc2V0Q29sb3IgPSAoY29sb3IxKT0+ewogICAgICAgIHRoaXMuY29sb3IgPSBjb2xvcjE7CiAgICB9OwogICAgZ2V0U3RhcnRpZCA9ICgpPT57CiAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnROb2RlaWQ7CiAgICB9OwogICAgZ2V0RW5kaWQgPSAoKT0+ewogICAgICAgIHJldHVybiB0aGlzLmVuZE5vZGVpZDsKICAgIH07CiAgICBfdXBkYXRlVmFsdWVzID0gKHNsb3BlID0gbnVsbCk9PnsKICAgICAgICBsZXQgY29udGV4dCA9IEdyYXBoLmdldENvbnRleHQodGhpcy5jb250ZXh0aWQpOwogICAgICAgIGxldCBzdGFydDEgPSBjb250ZXh0LmdldE5vZGVCeUlkKHRoaXMuc3RhcnROb2RlaWQpOwogICAgICAgIGxldCBlbmQgPSBjb250ZXh0LmdldE5vZGVCeUlkKHRoaXMuZW5kTm9kZWlkKTsKICAgICAgICBpZiAoc2xvcGUgPT09IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5zbG9wZSA9IChlbmQueSAtIHN0YXJ0MS55KSAvIChlbmQueCAtIHN0YXJ0MS54KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnNsb3BlID0gc2xvcGU7CiAgICAgICAgfQogICAgICAgIGxldCB4ZmxpcCA9IDE7CiAgICAgICAgbGV0IHlmbGlwID0gMTsKICAgICAgICBpZiAoc3RhcnQxLnggPj0gZW5kLngpIHsKICAgICAgICAgICAgeWZsaXAgPSAtMTsKICAgICAgICAgICAgeGZsaXAgPSAtMTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc2xvcGUgPT09IEluZmluaXR5KSB7CiAgICAgICAgICAgIHlmbGlwICo9IC0xOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5zbG9wZSA9PT0gLUluZmluaXR5KSB7CiAgICAgICAgICAgIHlmbGlwICo9IC0xOwogICAgICAgIH0KICAgICAgICBsZXQgYW5nbGVPZmZzZXQgPSAwOwogICAgICAgIGxldCBvcHBvc2l0ZUVkZ2UgPSBjb250ZXh0LmdldEVkZ2UodGhpcy5lbmROb2RlaWQsIHRoaXMuc3RhcnROb2RlaWQpOwogICAgICAgIGlmICh0aGlzLmlzRGlyZWN0aW9uYWwoKSAmJiBvcHBvc2l0ZUVkZ2UpIHsKICAgICAgICAgICAgYW5nbGVPZmZzZXQgPSAyICogTWF0aC5QSSAvIDE2OwogICAgICAgIH0KICAgICAgICB0aGlzLnhzdGFydCA9IHN0YXJ0MS54ICsgeGZsaXAgKiAoTWF0aC5jb3MoYW5nbGVPZmZzZXQgKyBNYXRoLmF0YW4odGhpcy5zbG9wZSkpICogc3RhcnQxLnIpOwogICAgICAgIHRoaXMueXN0YXJ0ID0gc3RhcnQxLnkgKyB5ZmxpcCAqIChNYXRoLnNpbihhbmdsZU9mZnNldCArIE1hdGguYXRhbih0aGlzLnNsb3BlKSkgKiBzdGFydDEucik7CiAgICAgICAgdGhpcy54ZW5kID0gZW5kLnggLSB4ZmxpcCAqIChNYXRoLmNvcygtYW5nbGVPZmZzZXQgKyBNYXRoLmF0YW4odGhpcy5zbG9wZSkpICogZW5kLnIpOwogICAgICAgIHRoaXMueWVuZCA9IGVuZC55IC0geWZsaXAgKiAoTWF0aC5zaW4oLWFuZ2xlT2Zmc2V0ICsgTWF0aC5hdGFuKHRoaXMuc2xvcGUpKSAqIGVuZC5yKTsKICAgICAgICBpZiAoaXNOYU4ocGFyc2VGbG9hdCh0aGlzLnRleHQpKSkgewogICAgICAgICAgICB0aGlzLnNldFdlaWdodCgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLndlaWdodCA9IHBhcnNlRmxvYXQodGhpcy50ZXh0KTsKICAgICAgICB9CiAgICB9OwogICAgZ2V0U2VsZkxvb3BCZXppZXJDb250cm9sUG9pbnRzWCA9ICgpPT57CiAgICAgICAgbGV0IGNvbnRleHQgPSBHcmFwaC5nZXRDb250ZXh0KHRoaXMuY29udGV4dGlkKTsKICAgICAgICBsZXQgbm9kZSA9IGNvbnRleHQuZ2V0Tm9kZUJ5SWQodGhpcy5zdGFydE5vZGVpZCk7CiAgICAgICAgbGV0IHggPSBub2RlLnggKyBub2RlLnIgLyBNYXRoLnNxcnQoMik7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgeCwKICAgICAgICAgICAgeCArIG5vZGUuciAqIDIsCiAgICAgICAgICAgIHgsCiAgICAgICAgICAgIHgKICAgICAgICBdOwogICAgfTsKICAgIGdldFNlbGZMb29wQmV6aWVyQ29udHJvbFBvaW50c1kgPSAoKT0+ewogICAgICAgIGxldCBjb250ZXh0ID0gR3JhcGguZ2V0Q29udGV4dCh0aGlzLmNvbnRleHRpZCk7CiAgICAgICAgbGV0IG5vZGUgPSBjb250ZXh0LmdldE5vZGVCeUlkKHRoaXMuc3RhcnROb2RlaWQpOwogICAgICAgIGxldCB5ID0gbm9kZS55IC0gbm9kZS5yIC8gTWF0aC5zcXJ0KDIpOwogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIHksCiAgICAgICAgICAgIHksCiAgICAgICAgICAgIHkgLSBub2RlLnIgKiAyLAogICAgICAgICAgICB5CiAgICAgICAgXTsKICAgIH07CiAgICBkcmF3ID0gKCk9PnsKICAgICAgICB0aGlzLl91cGRhdGVWYWx1ZXMoKTsKICAgICAgICBsZXQgY29udGV4dCA9IEdyYXBoLmdldENvbnRleHQodGhpcy5jb250ZXh0aWQpOwogICAgICAgIGxldCB0ZW1wX2NvbG9yID0gY29udGV4dC5jdHguc3Ryb2tlU3R5bGU7CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWQpIHsKICAgICAgICAgICAgY29udGV4dC5jdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmFsdENvbG9yOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnRleHQuY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5jb2xvcjsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc3RhcnROb2RlaWQgPT0gdGhpcy5lbmROb2RlaWQpIHsKICAgICAgICAgICAgbGV0IHhzID0gdGhpcy5nZXRTZWxmTG9vcEJlemllckNvbnRyb2xQb2ludHNYKCk7CiAgICAgICAgICAgIGxldCB5cyA9IHRoaXMuZ2V0U2VsZkxvb3BCZXppZXJDb250cm9sUG9pbnRzWSgpOwogICAgICAgICAgICBjb250ZXh0LmRyYXdMb29wKHhzLCB5cywgdGhpcy50ZXh0LCB0aGlzLmRpcmVjdGlvbmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb250ZXh0LmRyYXdBcnJvdyh0aGlzLnhzdGFydCwgdGhpcy55c3RhcnQsIHRoaXMueGVuZCwgdGhpcy55ZW5kLCB0aGlzLnRleHQsIHRoaXMuZGlyZWN0aW9uYWwpOwogICAgICAgIH0KICAgICAgICBjb250ZXh0LmN0eC5zdHJva2VTdHlsZSA9IHRlbXBfY29sb3I7CiAgICB9OwogICAgX3BvaW50RGlzdGFuY2UgPSAoeCwgeSk9PnsKICAgICAgICBmdW5jdGlvbiBzcXIoeDEpIHsKICAgICAgICAgICAgcmV0dXJuIHgxICogeDE7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRpc3QyKHYsIHcpIHsKICAgICAgICAgICAgcmV0dXJuIHNxcih2LnggLSB3LngpICsgc3FyKHYueSAtIHcueSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRpc3RUb1NlZ21lbnRTcXVhcmVkKHAsIHYsIHcpIHsKICAgICAgICAgICAgdmFyIGwyID0gZGlzdDIodiwgdyk7CiAgICAgICAgICAgIGlmIChsMiA9PSAwKSByZXR1cm4gZGlzdDIocCwgdik7CiAgICAgICAgICAgIHZhciB0ID0gKChwLnggLSB2LngpICogKHcueCAtIHYueCkgKyAocC55IC0gdi55KSAqICh3LnkgLSB2LnkpKSAvIGwyOwogICAgICAgICAgICB0ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgdCkpOwogICAgICAgICAgICByZXR1cm4gZGlzdDIocCwgewogICAgICAgICAgICAgICAgeDogdi54ICsgdCAqICh3LnggLSB2LngpLAogICAgICAgICAgICAgICAgeTogdi55ICsgdCAqICh3LnkgLSB2LnkpCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBkaXN0VG9TZWdtZW50KHAsIHYsIHcpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguc3FydChkaXN0VG9TZWdtZW50U3F1YXJlZChwLCB2LCB3KSk7CiAgICAgICAgfQogICAgICAgIGxldCBwID0gewogICAgICAgICAgICB4OiB4LAogICAgICAgICAgICB5OiB5CiAgICAgICAgfTsKICAgICAgICBsZXQgdiA9IHsKICAgICAgICAgICAgeDogdGhpcy54c3RhcnQsCiAgICAgICAgICAgIHk6IHRoaXMueXN0YXJ0CiAgICAgICAgfTsKICAgICAgICBsZXQgdyA9IHsKICAgICAgICAgICAgeDogdGhpcy54ZW5kLAogICAgICAgICAgICB5OiB0aGlzLnllbmQKICAgICAgICB9OwogICAgICAgIHJldHVybiBkaXN0VG9TZWdtZW50KHAsIHYsIHcpOwogICAgfTsKICAgIGlzT25TZWxmTG9vcCA9ICh4LCB5KT0+ewogICAgICAgIGZ1bmN0aW9uIGlzQmV0d2Vlbih4MSwgYSwgYikgewogICAgICAgICAgICByZXR1cm4gYSA8PSB4MSAmJiB4MSA8PSBiIHx8IGIgPD0geDEgJiYgeDEgPD0gYTsKICAgICAgICB9CiAgICAgICAgbGV0IHhzID0gdGhpcy5nZXRTZWxmTG9vcEJlemllckNvbnRyb2xQb2ludHNYKCk7CiAgICAgICAgbGV0IHlzID0gdGhpcy5nZXRTZWxmTG9vcEJlemllckNvbnRyb2xQb2ludHNZKCk7CiAgICAgICAgbGV0IG1pZFBvaW50WCA9IEdyYXBoLmNhbGN1bGF0ZU1pZFBvaW50T2ZCZXppZXJDdXJ2ZSh4cyk7CiAgICAgICAgbGV0IG1pZFBvaW50WSA9IEdyYXBoLmNhbGN1bGF0ZU1pZFBvaW50T2ZCZXppZXJDdXJ2ZSh5cyk7CiAgICAgICAgcmV0dXJuIGlzQmV0d2Vlbih4LCB4c1swXSwgbWlkUG9pbnRYKSAmJiBpc0JldHdlZW4oeSwgeXNbMF0sIG1pZFBvaW50WSk7CiAgICB9OwogICAgaW5zaWRlID0gKHgsIHksIHlvZmZzZXQsIHhvZmZzZXQsIHNlbnNpdGl2aXR5ID0gMyk9PnsKICAgICAgICBpZiAoIXlvZmZzZXQpIHsKICAgICAgICAgICAgeW9mZnNldCA9IDA7CiAgICAgICAgfQogICAgICAgIGlmICgheG9mZnNldCkgewogICAgICAgICAgICB4b2Zmc2V0ID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc3RhcnROb2RlaWQgPT0gdGhpcy5lbmROb2RlaWQpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaXNPblNlbGZMb29wKHggKyB4b2Zmc2V0LCB5ICsgeW9mZnNldCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3BvaW50RGlzdGFuY2UoeCArIHhvZmZzZXQsIHkgKyB5b2Zmc2V0KSA8IHNlbnNpdGl2aXR5ICsgMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKfQpHcmFwaC5fZWRnZSA9IGZ1bmN0aW9uKGNvbnRleHRpZDEsIHN0YXJ0Tm9kZWlkMSwgZW5kTm9kZWlkMSwgY29sb3IxID0gIiMwMDAiLCB0ZXh0MSA9ICIiLCBkaXJlY3Rpb25hbDEgPSBmYWxzZSkgewogICAgcmV0dXJuIG5ldyBFZGdlKGNvbnRleHRpZDEsIHN0YXJ0Tm9kZWlkMSwgZW5kTm9kZWlkMSwgY29sb3IxLCB0ZXh0MSwgZGlyZWN0aW9uYWwxKTsKfTsKR3JhcGguX25vZGUgPSAoY29udGV4dGlkMSwgeCwgeSwgciwgdGV4dDEgPSAiIiwgaGFzaDMgPSAiIik9PnsKICAgIHJldHVybiBuZXcgTm9kZTIoY29udGV4dGlkMSwgeCwgeSwgciwgdGV4dDEsIGhhc2gzKTsKfTsKY2xhc3MgTm9kZTIgewogICAgdHlwZSA9ICJub2RlIjsKICAgIGNoaWxkcmVuID0gW107CiAgICBlZGdlcyA9IHsKICAgIH07CiAgICByb290ID0gdHJ1ZTsKICAgIGFjdGl2ZSA9IGZhbHNlOwogICAgdmFsdWUgPSBudWxsOwogICAgZnVuYyA9IG51bGw7CiAgICBhcmdzID0gW107CiAgICB0aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkudG9TdHJpbmcoKTsKICAgIGltYWdlID0gbnVsbDsKICAgIGhhc2ggPSAiIjsKICAgIGNvbnN0cnVjdG9yKGNvbnRleHRpZDEsIHgsIHksIHIsIHRleHQxID0gIiIsIGhhc2gzID0gIiIpewogICAgICAgIHRoaXMuY29udGV4dGlkID0gY29udGV4dGlkMTsKICAgICAgICB0aGlzLnggPSB4OwogICAgICAgIHRoaXMueSA9IHk7CiAgICAgICAgdGhpcy5yID0gcjsKICAgICAgICB0aGlzLmlkID0gTnVtYmVyKHRoaXMudGltZSArIE9iamVjdC5rZXlzKEdyYXBoLmdldENvbnRleHQodGhpcy5jb250ZXh0aWQpLm9ianMpLmxlbmd0aCArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDk5OTkpKTsKICAgICAgICB0aGlzLmNvbG9yID0gInJnYigwLDAsMCkiOwogICAgICAgIHRoaXMudGV4dF9jb2xvciA9ICJyZ2IoMCwwLDApIjsKICAgICAgICB0aGlzLmFjdGl2ZUNvbG9yID0gInJnYigyNTUsMCwwKSI7CiAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDE7CiAgICAgICAgdGhpcy5hY3RpdmUgPSBmYWxzZTsKICAgICAgICBjb25zdCBjb250ZXh0ID0gR3JhcGguZ2V0Q29udGV4dCh0aGlzLmNvbnRleHRpZCk7CiAgICAgICAgdGhpcy5oYXNoID0gaGFzaDM7CiAgICAgICAgY29udGV4dC5vYmpzW3RoaXMuaWRdID0gdGhpczsKICAgICAgICB0aGlzLmJ1aWxkKCk7CiAgICAgICAgaWYgKHRoaXMudGV4dCBpbiBHcmFwaC5mdW5jdGlvbnMpIHsKICAgICAgICAgICAgdGhpcy5mdW5jID0gR3JhcGguZnVuY3Rpb25zW3RoaXMudGV4dF07CiAgICAgICAgfQogICAgfQogICAgZGVsZXRlID0gKCk9PnsKICAgICAgICBsZXQgY29udGV4dDEgPSBHcmFwaC5nZXRDb250ZXh0KHRoaXMuY29udGV4dGlkKTsKICAgICAgICBmb3IgKGxldCBlZGdlIG9mIE9iamVjdC52YWx1ZXMoY29udGV4dDEuZWRnZXMpKXsKICAgICAgICAgICAgaWYgKGVkZ2Uuc3RhcnROb2RlaWQgPT09IHRoaXMuaWQgfHwgZWRnZS5lbmROb2RlaWQgPT09IHRoaXMuaWQpIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBjb250ZXh0MS5lZGdlc1tlZGdlLmlkXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb250ZXh0MS5hY3RpdmUgPSBudWxsOwogICAgICAgIGxldCB0ZW1wX2lkID0gdGhpcy5pZDsKICAgICAgICBkZWxldGUgY29udGV4dDEub2Jqc1t0aGlzLmlkXTsKICAgICAgICBmb3IgKGxldCBuIG9mIE9iamVjdC52YWx1ZXMoY29udGV4dDEub2JqcykpewogICAgICAgICAgICBsZXQgcG9zaXRpb24gPSBuLmNoaWxkcmVuLmluZGV4T2YodGVtcF9pZCk7CiAgICAgICAgICAgIGlmIChwb3NpdGlvbiAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIG4uY2hpbGRyZW4uc3BsaWNlKHBvc2l0aW9uLCAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBnZXRFZGdlcyA9ICgpPT57CiAgICAgICAgcmV0dXJuIHRoaXMuZWRnZXM7CiAgICB9OwogICAgc2V0Q29sb3IgPSAobmV3Q29sb3IpPT57CiAgICAgICAgdGhpcy5jb2xvciA9IG5ld0NvbG9yOwogICAgfTsKICAgIHNldEFjdGl2ZUNvbG9yID0gKG5ld0NvbG9yKT0+ewogICAgICAgIHRoaXMuYWN0aXZlQ29sb3IgPSBuZXdDb2xvcjsKICAgIH07CiAgICBzZXRUZXh0ID0gKHRleHQyKT0+ewogICAgICAgIHRoaXMudGV4dCA9IHRleHQyOwogICAgfTsKICAgIHVwZGF0ZSA9ICgpPT57CiAgICAgICAgdGhpcy5idWlsZCgpOwogICAgfTsKICAgIHNldEltYWdlID0gYXN5bmMgKHVybCk9PnsKICAgICAgICBmdW5jdGlvbiBjcmVhdGVJbWFnZSh1cmwxKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKTsKICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSAoKT0+ewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaW1nKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpbWcub25lcnJvciA9ICgpPT57CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImltYWdlIGxvYWQgZXJyb3IiKTsKICAgICAgICAgICAgICAgICAgICByZWplY3QoKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpbWcuc3JjID0gdXJsMTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuaW1hZ2UgPSBhd2FpdCBjcmVhdGVJbWFnZSh1cmwpOwogICAgfTsKICAgIGJ1aWxkID0gKCk9PnsKICAgICAgICBsZXQgY29udGV4dDEgPSBHcmFwaC5nZXRDb250ZXh0KHRoaXMuY29udGV4dGlkKTsKICAgICAgICBpZiAodGhpcy5hY3RpdmUpIHsKICAgICAgICAgICAgY29udGV4dDEuY3R4LmxpbmVXaWR0aCA9IDEwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnRleHQxLmN0eC5saW5ld2lkdGggPSAxOwogICAgICAgIH0KICAgICAgICBjb250ZXh0MS5jdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yOwogICAgICAgIGlmIChjb250ZXh0MS5hY3RpdmUgPT0gdGhpcykgewogICAgICAgICAgICBjb250ZXh0MS5jdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmFjdGl2ZUNvbG9yOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5mdW5jICE9PSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMudGV4dF9jb2xvciA9ICIjRkYwMDAwIjsKICAgICAgICB9CiAgICAgICAgY29uc3QgZm9yY3VzUiA9IHRoaXMuciAqIDEuNDsKICAgICAgICBjb250ZXh0MS5jdHgudGV4dEFsaWduID0gImNlbnRlciI7CiAgICAgICAgY29udGV4dDEuY3R4LmZvbnQgPSAiMTVweCBBcmlhbCI7CiAgICAgICAgY29udGV4dDEuY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGlmIChjb250ZXh0MS5hY3RpdmUgPT0gdGhpcykgewogICAgICAgICAgICBjb250ZXh0MS5jdHguYXJjKHRoaXMueCwgdGhpcy55LCBmb3JjdXNSLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29udGV4dDEuY3R4LmFyYyh0aGlzLngsIHRoaXMueSwgdGhpcy5yLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgfQogICAgICAgIGNvbnRleHQxLmN0eC5jbG9zZVBhdGgoKTsKICAgICAgICBjb250ZXh0MS5jdHguc3Ryb2tlKCk7CiAgICAgICAgaWYgKHRoaXMuaW1hZ2UpIHsKICAgICAgICAgICAgY29udGV4dDEuY3R4LnNhdmUoKTsKICAgICAgICAgICAgY29udGV4dDEuY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBpZiAoY29udGV4dDEuYWN0aXZlID09IHRoaXMpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQxLmN0eC5hcmModGhpcy54LCB0aGlzLnksIGZvcmN1c1IsIDAsIE1hdGguUEkgKiAyLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnRleHQxLmN0eC5hcmModGhpcy54LCB0aGlzLnksIHRoaXMuciwgMCwgTWF0aC5QSSAqIDIsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRleHQxLmN0eC5jbG9zZVBhdGgoKTsKICAgICAgICAgICAgY29udGV4dDEuY3R4LmNsaXAoKTsKICAgICAgICAgICAgaWYgKGNvbnRleHQxLmFjdGl2ZSA9PSB0aGlzKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0MS5jdHguZHJhd0ltYWdlKHRoaXMuaW1hZ2UsIHRoaXMueCAtIGZvcmN1c1IsIHRoaXMueSAtIGZvcmN1c1IsIGZvcmN1c1IgKiAyLCBmb3JjdXNSICogMik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb250ZXh0MS5jdHguZHJhd0ltYWdlKHRoaXMuaW1hZ2UsIHRoaXMueCAtIHRoaXMuciwgdGhpcy55IC0gdGhpcy5yLCB0aGlzLnIgKiAyLCB0aGlzLnIgKiAyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb250ZXh0MS5jdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGlmIChjb250ZXh0MS5hY3RpdmUgPT0gdGhpcykgewogICAgICAgICAgICAgICAgY29udGV4dDEuY3R4LmFyYyh0aGlzLngsIHRoaXMueSwgZm9yY3VzUiwgMCwgTWF0aC5QSSAqIDIsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29udGV4dDEuY3R4LmFyYyh0aGlzLngsIHRoaXMueSwgdGhpcy5yLCAwLCBNYXRoLlBJICogMiwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29udGV4dDEuY3R4LmNsaXAoKTsKICAgICAgICAgICAgY29udGV4dDEuY3R4LmNsb3NlUGF0aCgpOwogICAgICAgICAgICBjb250ZXh0MS5jdHgucmVzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBsZXQgdGVtcCA9IGNvbnRleHQxLmN0eC5maWxsU3R5bGU7CiAgICAgICAgY29udGV4dDEuY3R4LmZpbGxTdHlsZSA9IHRoaXMudGV4dF9jb2xvcjsKICAgICAgICBjb250ZXh0MS5jdHguZmlsbFRleHQodGhpcy50ZXh0LCB0aGlzLngsIHRoaXMueSk7CiAgICAgICAgY29udGV4dDEuY3R4LmZpbGxTdHlsZSA9IHRlbXA7CiAgICB9OwogICAgY29ubmVjdCA9IChuLCB0ZXh0MiA9ICIiLCBkaXJlY3Rpb25hbDEgPSBmYWxzZSk9PnsKICAgICAgICBsZXQgY29udGV4dDEgPSBHcmFwaC5nZXRDb250ZXh0KHRoaXMuY29udGV4dGlkKTsKICAgICAgICBpZiAobi50eXBlICE9PSAibm9kZSIpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2gobi5pZCk7CiAgICAgICAgaWYgKGRpcmVjdGlvbmFsMSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgbi5jaGlsZHJlbi5wdXNoKHRoaXMuaWQpOwogICAgICAgIH0KICAgICAgICBsZXQgZWRnZSA9IGNvbnRleHQxLmVkZ2UodGhpcy5pZCwgbi5pZCwgIiMwMDAiLCB0ZXh0MiwgZGlyZWN0aW9uYWwxKTsKICAgICAgICB0aGlzLmVkZ2VzW2VkZ2UuaWRdOwogICAgICAgIGNvbnRleHQxLmVkZ2VzW2VkZ2UuaWRdID0gZWRnZTsKICAgICAgICBuLmtpbGxfcm9vdCgpOwogICAgICAgIGNvbnRleHQxLmRyYXdFZGdlcygpOwogICAgICAgIHJldHVybiBlZGdlOwogICAgfTsKICAgIGJpRGlyZWN0aW9uYWwgPSAobiwgdGV4dDIgPSAiIik9PnsKICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0KG4sIHRleHQyKTsKICAgIH07CiAgICBkaXJlY3Rpb25hbCA9IChuLCB0ZXh0MiA9ICIiKT0+ewogICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3QobiwgdGV4dDIsIHRydWUpOwogICAgfTsKICAgIGtpbGxfcm9vdCA9ICgpPT57CiAgICAgICAgdGhpcy5yb290ID0gZmFsc2U7CiAgICB9OwogICAgYXJyb3cgPSAoeDIsIHkyLCB0ZXh0Mik9PnsKICAgICAgICBsZXQgY29udGV4dDEgPSBHcmFwaC5nZXRDb250ZXh0KHRoaXMuY29udGV4dGlkKTsKICAgICAgICBsZXQgeGZsaXAgPSAxOwogICAgICAgIGxldCB5ZmxpcCA9IDE7CiAgICAgICAgaWYgKHRoaXMueCA+PSB4MikgewogICAgICAgICAgICB5ZmxpcCA9IC0xOwogICAgICAgICAgICB4ZmxpcCA9IC0xOwogICAgICAgIH0KICAgICAgICBsZXQgc2xvcGUgPSAoeTIgLSB0aGlzLnkpIC8gKHgyIC0gdGhpcy54KTsKICAgICAgICBpZiAoc2xvcGUgPT09IEluZmluaXR5KSB7CiAgICAgICAgICAgIHlmbGlwICo9IC0xOwogICAgICAgIH0KICAgICAgICBpZiAoc2xvcGUgPT09IC1JbmZpbml0eSkgewogICAgICAgICAgICB5ZmxpcCAqPSAtMTsKICAgICAgICB9CiAgICAgICAgbGV0IHhzdGFydCA9IHRoaXMueCArIHhmbGlwICogTWF0aC5jb3MoTWF0aC5hdGFuKHNsb3BlKSkgKiB0aGlzLnI7CiAgICAgICAgbGV0IHlzdGFydCA9IHRoaXMueSArIHlmbGlwICogTWF0aC5zaW4oTWF0aC5hdGFuKHNsb3BlKSkgKiB0aGlzLnI7CiAgICAgICAgY29udGV4dDEuZHJhd0Fycm93KHhzdGFydCwgeXN0YXJ0LCB4MiwgeTIsIHRleHQyID0gdGV4dDIpOwogICAgfTsKICAgIGluc2lkZSA9ICh4MSwgeTEsIHlvZmZzZXQsIHhvZmZzZXQpPT57CiAgICAgICAgZnVuY3Rpb24gZGlzdGFuY2UoeDExLCB4MiwgeTExLCB5MikgewogICAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KHgyIC0geDExLCAyKSArIE1hdGgucG93KHkyIC0geTExLCAyKSk7CiAgICAgICAgfQogICAgICAgIGlmICh5b2Zmc2V0ID09IG51bGwpIHsKICAgICAgICAgICAgeW9mZnNldCA9IDA7CiAgICAgICAgfQogICAgICAgIGlmICh4b2Zmc2V0ID09IG51bGwpIHsKICAgICAgICAgICAgeG9mZnNldCA9IDA7CiAgICAgICAgfQogICAgICAgIGlmIChkaXN0YW5jZSh0aGlzLnggKyB4b2Zmc2V0LCB4MSwgdGhpcy55LCB5MSArIHlvZmZzZXQpIDwgdGhpcy5yKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9Owp9CkdyYXBoLmZ1bmN0aW9ucyA9IHsKfTsKY29uc3QgSEVYX0NIQVJTMSA9ICIwMTIzNDU2Nzg5YWJjZGVmIi5zcGxpdCgiIik7CmNvbnN0IEVYVFJBMSA9IFsKICAgIC0yMTQ3NDgzNjQ4LAogICAgODM4ODYwOCwKICAgIDMyNzY4LAogICAgMTI4Cl07CmNvbnN0IFNISUZUMSA9IFsKICAgIDI0LAogICAgMTYsCiAgICA4LAogICAgMApdOwpjb25zdCBibG9ja3MxID0gW107CmNsYXNzIFNoYTEgewogICAgI2Jsb2NrczsKICAgICNibG9jazsKICAgICNzdGFydDsKICAgICNieXRlczsKICAgICNoQnl0ZXM7CiAgICAjZmluYWxpemVkOwogICAgI2hhc2hlZDsKICAgICNoMCA9IDE3MzI1ODQxOTM7CiAgICAjaDEgPSA0MDIzMjMzNDE3OwogICAgI2gyID0gMjU2MjM4MzEwMjsKICAgICNoMyA9IDI3MTczMzg3ODsKICAgICNoNCA9IDMyODUzNzc1MjA7CiAgICAjbGFzdEJ5dGVJbmRleCA9IDA7CiAgICBjb25zdHJ1Y3RvcihzaGFyZWRNZW1vcnkzID0gZmFsc2UpewogICAgICAgIHRoaXMuaW5pdChzaGFyZWRNZW1vcnkzKTsKICAgIH0KICAgIGluaXQoc2hhcmVkTWVtb3J5KSB7CiAgICAgICAgaWYgKHNoYXJlZE1lbW9yeSkgewogICAgICAgICAgICBibG9ja3MxWzBdID0gYmxvY2tzMVsxNl0gPSBibG9ja3MxWzFdID0gYmxvY2tzMVsyXSA9IGJsb2NrczFbM10gPSBibG9ja3MxWzRdID0gYmxvY2tzMVs1XSA9IGJsb2NrczFbNl0gPSBibG9ja3MxWzddID0gYmxvY2tzMVs4XSA9IGJsb2NrczFbOV0gPSBibG9ja3MxWzEwXSA9IGJsb2NrczFbMTFdID0gYmxvY2tzMVsxMl0gPSBibG9ja3MxWzEzXSA9IGJsb2NrczFbMTRdID0gYmxvY2tzMVsxNV0gPSAwOwogICAgICAgICAgICB0aGlzLiNibG9ja3MgPSBibG9ja3MxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuI2Jsb2NrcyA9IFsKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwCiAgICAgICAgICAgIF07CiAgICAgICAgfQogICAgICAgIHRoaXMuI2gwID0gMTczMjU4NDE5MzsKICAgICAgICB0aGlzLiNoMSA9IDQwMjMyMzM0MTc7CiAgICAgICAgdGhpcy4jaDIgPSAyNTYyMzgzMTAyOwogICAgICAgIHRoaXMuI2gzID0gMjcxNzMzODc4OwogICAgICAgIHRoaXMuI2g0ID0gMzI4NTM3NzUyMDsKICAgICAgICB0aGlzLiNibG9jayA9IHRoaXMuI3N0YXJ0ID0gdGhpcy4jYnl0ZXMgPSB0aGlzLiNoQnl0ZXMgPSAwOwogICAgICAgIHRoaXMuI2ZpbmFsaXplZCA9IHRoaXMuI2hhc2hlZCA9IGZhbHNlOwogICAgfQogICAgdXBkYXRlKG1lc3NhZ2UpIHsKICAgICAgICBpZiAodGhpcy4jZmluYWxpemVkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBsZXQgbXNnOwogICAgICAgIGlmIChtZXNzYWdlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsKICAgICAgICAgICAgbXNnID0gbmV3IFVpbnQ4QXJyYXkobWVzc2FnZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbXNnID0gbWVzc2FnZTsKICAgICAgICB9CiAgICAgICAgbGV0IGluZGV4ID0gMDsKICAgICAgICBjb25zdCBsZW5ndGggPSBtc2cubGVuZ3RoOwogICAgICAgIGNvbnN0IGJsb2NrczIgPSB0aGlzLiNibG9ja3M7CiAgICAgICAgd2hpbGUoaW5kZXggPCBsZW5ndGgpewogICAgICAgICAgICBsZXQgaTE7CiAgICAgICAgICAgIGlmICh0aGlzLiNoYXNoZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuI2hhc2hlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYmxvY2tzMlswXSA9IHRoaXMuI2Jsb2NrOwogICAgICAgICAgICAgICAgYmxvY2tzMlsxNl0gPSBibG9ja3MyWzFdID0gYmxvY2tzMlsyXSA9IGJsb2NrczJbM10gPSBibG9ja3MyWzRdID0gYmxvY2tzMls1XSA9IGJsb2NrczJbNl0gPSBibG9ja3MyWzddID0gYmxvY2tzMls4XSA9IGJsb2NrczJbOV0gPSBibG9ja3MyWzEwXSA9IGJsb2NrczJbMTFdID0gYmxvY2tzMlsxMl0gPSBibG9ja3MyWzEzXSA9IGJsb2NrczJbMTRdID0gYmxvY2tzMlsxNV0gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlb2YgbXNnICE9PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgZm9yKGkxID0gdGhpcy4jc3RhcnQ7IGluZGV4IDwgbGVuZ3RoICYmIGkxIDwgNjQ7ICsraW5kZXgpewogICAgICAgICAgICAgICAgICAgIGJsb2NrczJbaTEgPj4gMl0gfD0gbXNnW2luZGV4XSA8PCBTSElGVDFbKGkxKyspICYgM107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IoaTEgPSB0aGlzLiNzdGFydDsgaW5kZXggPCBsZW5ndGggJiYgaTEgPCA2NDsgKytpbmRleCl7CiAgICAgICAgICAgICAgICAgICAgbGV0IGNvZGUgPSBtc2cuY2hhckNvZGVBdChpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGUgPCAxMjgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzMltpMSA+PiAyXSB8PSBjb2RlIDw8IFNISUZUMVsoaTErKykgJiAzXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPCAyMDQ4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrczJbaTEgPj4gMl0gfD0gKDE5MiB8IGNvZGUgPj4gNikgPDwgU0hJRlQxWyhpMSsrKSAmIDNdOwogICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MyW2kxID4+IDJdIHw9ICgxMjggfCBjb2RlICYgNjMpIDw8IFNISUZUMVsoaTErKykgJiAzXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPCA1NTI5NiB8fCBjb2RlID49IDU3MzQ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrczJbaTEgPj4gMl0gfD0gKDIyNCB8IGNvZGUgPj4gMTIpIDw8IFNISUZUMVsoaTErKykgJiAzXTsKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzMltpMSA+PiAyXSB8PSAoMTI4IHwgY29kZSA+PiA2ICYgNjMpIDw8IFNISUZUMVsoaTErKykgJiAzXTsKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzMltpMSA+PiAyXSB8PSAoMTI4IHwgY29kZSAmIDYzKSA8PCBTSElGVDFbKGkxKyspICYgM107CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IDY1NTM2ICsgKChjb2RlICYgMTAyMykgPDwgMTAgfCBtc2cuY2hhckNvZGVBdCgrK2luZGV4KSAmIDEwMjMpOwogICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MyW2kxID4+IDJdIHw9ICgyNDAgfCBjb2RlID4+IDE4KSA8PCBTSElGVDFbKGkxKyspICYgM107CiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrczJbaTEgPj4gMl0gfD0gKDEyOCB8IGNvZGUgPj4gMTIgJiA2MykgPDwgU0hJRlQxWyhpMSsrKSAmIDNdOwogICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MyW2kxID4+IDJdIHw9ICgxMjggfCBjb2RlID4+IDYgJiA2MykgPDwgU0hJRlQxWyhpMSsrKSAmIDNdOwogICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MyW2kxID4+IDJdIHw9ICgxMjggfCBjb2RlICYgNjMpIDw8IFNISUZUMVsoaTErKykgJiAzXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy4jbGFzdEJ5dGVJbmRleCA9IGkxOwogICAgICAgICAgICB0aGlzLiNieXRlcyArPSBpMSAtIHRoaXMuI3N0YXJ0OwogICAgICAgICAgICBpZiAoaTEgPj0gNjQpIHsKICAgICAgICAgICAgICAgIHRoaXMuI2Jsb2NrID0gYmxvY2tzMlsxNl07CiAgICAgICAgICAgICAgICB0aGlzLiNzdGFydCA9IGkxIC0gNjQ7CiAgICAgICAgICAgICAgICB0aGlzLmhhc2goKTsKICAgICAgICAgICAgICAgIHRoaXMuI2hhc2hlZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLiNzdGFydCA9IGkxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLiNieXRlcyA+IDQyOTQ5NjcyOTUpIHsKICAgICAgICAgICAgdGhpcy4jaEJ5dGVzICs9IHRoaXMuI2J5dGVzIC8gNDI5NDk2NzI5NiA+Pj4gMDsKICAgICAgICAgICAgdGhpcy4jYnl0ZXMgPSB0aGlzLiNieXRlcyA+Pj4gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBmaW5hbGl6ZSgpIHsKICAgICAgICBpZiAodGhpcy4jZmluYWxpemVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy4jZmluYWxpemVkID0gdHJ1ZTsKICAgICAgICBjb25zdCBibG9ja3MyID0gdGhpcy4jYmxvY2tzOwogICAgICAgIGNvbnN0IGkxID0gdGhpcy4jbGFzdEJ5dGVJbmRleDsKICAgICAgICBibG9ja3MyWzE2XSA9IHRoaXMuI2Jsb2NrOwogICAgICAgIGJsb2NrczJbaTEgPj4gMl0gfD0gRVhUUkExW2kxICYgM107CiAgICAgICAgdGhpcy4jYmxvY2sgPSBibG9ja3MyWzE2XTsKICAgICAgICBpZiAoaTEgPj0gNTYpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLiNoYXNoZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuaGFzaCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJsb2NrczJbMF0gPSB0aGlzLiNibG9jazsKICAgICAgICAgICAgYmxvY2tzMlsxNl0gPSBibG9ja3MyWzFdID0gYmxvY2tzMlsyXSA9IGJsb2NrczJbM10gPSBibG9ja3MyWzRdID0gYmxvY2tzMls1XSA9IGJsb2NrczJbNl0gPSBibG9ja3MyWzddID0gYmxvY2tzMls4XSA9IGJsb2NrczJbOV0gPSBibG9ja3MyWzEwXSA9IGJsb2NrczJbMTFdID0gYmxvY2tzMlsxMl0gPSBibG9ja3MyWzEzXSA9IGJsb2NrczJbMTRdID0gYmxvY2tzMlsxNV0gPSAwOwogICAgICAgIH0KICAgICAgICBibG9ja3MyWzE0XSA9IHRoaXMuI2hCeXRlcyA8PCAzIHwgdGhpcy4jYnl0ZXMgPj4+IDI5OwogICAgICAgIGJsb2NrczJbMTVdID0gdGhpcy4jYnl0ZXMgPDwgMzsKICAgICAgICB0aGlzLmhhc2goKTsKICAgIH0KICAgIGhhc2goKSB7CiAgICAgICAgbGV0IGEgPSB0aGlzLiNoMDsKICAgICAgICBsZXQgYiA9IHRoaXMuI2gxOwogICAgICAgIGxldCBjID0gdGhpcy4jaDI7CiAgICAgICAgbGV0IGQgPSB0aGlzLiNoMzsKICAgICAgICBsZXQgZSA9IHRoaXMuI2g0OwogICAgICAgIGxldCBmOwogICAgICAgIGxldCBqOwogICAgICAgIGxldCB0OwogICAgICAgIGNvbnN0IGJsb2NrczIgPSB0aGlzLiNibG9ja3M7CiAgICAgICAgZm9yKGogPSAxNjsgaiA8IDgwOyArK2opewogICAgICAgICAgICB0ID0gYmxvY2tzMltqIC0gM10gXiBibG9ja3MyW2ogLSA4XSBeIGJsb2NrczJbaiAtIDE0XSBeIGJsb2NrczJbaiAtIDE2XTsKICAgICAgICAgICAgYmxvY2tzMltqXSA9IHQgPDwgMSB8IHQgPj4+IDMxOwogICAgICAgIH0KICAgICAgICBmb3IoaiA9IDA7IGogPCAyMDsgaiArPSA1KXsKICAgICAgICAgICAgZiA9IGIgJiBjIHwgfmIgJiBkOwogICAgICAgICAgICB0ID0gYSA8PCA1IHwgYSA+Pj4gMjc7CiAgICAgICAgICAgIGUgPSB0ICsgZiArIGUgKyAxNTE4NTAwMjQ5ICsgYmxvY2tzMltqXSA+Pj4gMDsKICAgICAgICAgICAgYiA9IGIgPDwgMzAgfCBiID4+PiAyOwogICAgICAgICAgICBmID0gYSAmIGIgfCB+YSAmIGM7CiAgICAgICAgICAgIHQgPSBlIDw8IDUgfCBlID4+PiAyNzsKICAgICAgICAgICAgZCA9IHQgKyBmICsgZCArIDE1MTg1MDAyNDkgKyBibG9ja3MyW2ogKyAxXSA+Pj4gMDsKICAgICAgICAgICAgYSA9IGEgPDwgMzAgfCBhID4+PiAyOwogICAgICAgICAgICBmID0gZSAmIGEgfCB+ZSAmIGI7CiAgICAgICAgICAgIHQgPSBkIDw8IDUgfCBkID4+PiAyNzsKICAgICAgICAgICAgYyA9IHQgKyBmICsgYyArIDE1MTg1MDAyNDkgKyBibG9ja3MyW2ogKyAyXSA+Pj4gMDsKICAgICAgICAgICAgZSA9IGUgPDwgMzAgfCBlID4+PiAyOwogICAgICAgICAgICBmID0gZCAmIGUgfCB+ZCAmIGE7CiAgICAgICAgICAgIHQgPSBjIDw8IDUgfCBjID4+PiAyNzsKICAgICAgICAgICAgYiA9IHQgKyBmICsgYiArIDE1MTg1MDAyNDkgKyBibG9ja3MyW2ogKyAzXSA+Pj4gMDsKICAgICAgICAgICAgZCA9IGQgPDwgMzAgfCBkID4+PiAyOwogICAgICAgICAgICBmID0gYyAmIGQgfCB+YyAmIGU7CiAgICAgICAgICAgIHQgPSBiIDw8IDUgfCBiID4+PiAyNzsKICAgICAgICAgICAgYSA9IHQgKyBmICsgYSArIDE1MTg1MDAyNDkgKyBibG9ja3MyW2ogKyA0XSA+Pj4gMDsKICAgICAgICAgICAgYyA9IGMgPDwgMzAgfCBjID4+PiAyOwogICAgICAgIH0KICAgICAgICBmb3IoOyBqIDwgNDA7IGogKz0gNSl7CiAgICAgICAgICAgIGYgPSBiIF4gYyBeIGQ7CiAgICAgICAgICAgIHQgPSBhIDw8IDUgfCBhID4+PiAyNzsKICAgICAgICAgICAgZSA9IHQgKyBmICsgZSArIDE4NTk3NzUzOTMgKyBibG9ja3MyW2pdID4+PiAwOwogICAgICAgICAgICBiID0gYiA8PCAzMCB8IGIgPj4+IDI7CiAgICAgICAgICAgIGYgPSBhIF4gYiBeIGM7CiAgICAgICAgICAgIHQgPSBlIDw8IDUgfCBlID4+PiAyNzsKICAgICAgICAgICAgZCA9IHQgKyBmICsgZCArIDE4NTk3NzUzOTMgKyBibG9ja3MyW2ogKyAxXSA+Pj4gMDsKICAgICAgICAgICAgYSA9IGEgPDwgMzAgfCBhID4+PiAyOwogICAgICAgICAgICBmID0gZSBeIGEgXiBiOwogICAgICAgICAgICB0ID0gZCA8PCA1IHwgZCA+Pj4gMjc7CiAgICAgICAgICAgIGMgPSB0ICsgZiArIGMgKyAxODU5Nzc1MzkzICsgYmxvY2tzMltqICsgMl0gPj4+IDA7CiAgICAgICAgICAgIGUgPSBlIDw8IDMwIHwgZSA+Pj4gMjsKICAgICAgICAgICAgZiA9IGQgXiBlIF4gYTsKICAgICAgICAgICAgdCA9IGMgPDwgNSB8IGMgPj4+IDI3OwogICAgICAgICAgICBiID0gdCArIGYgKyBiICsgMTg1OTc3NTM5MyArIGJsb2NrczJbaiArIDNdID4+PiAwOwogICAgICAgICAgICBkID0gZCA8PCAzMCB8IGQgPj4+IDI7CiAgICAgICAgICAgIGYgPSBjIF4gZCBeIGU7CiAgICAgICAgICAgIHQgPSBiIDw8IDUgfCBiID4+PiAyNzsKICAgICAgICAgICAgYSA9IHQgKyBmICsgYSArIDE4NTk3NzUzOTMgKyBibG9ja3MyW2ogKyA0XSA+Pj4gMDsKICAgICAgICAgICAgYyA9IGMgPDwgMzAgfCBjID4+PiAyOwogICAgICAgIH0KICAgICAgICBmb3IoOyBqIDwgNjA7IGogKz0gNSl7CiAgICAgICAgICAgIGYgPSBiICYgYyB8IGIgJiBkIHwgYyAmIGQ7CiAgICAgICAgICAgIHQgPSBhIDw8IDUgfCBhID4+PiAyNzsKICAgICAgICAgICAgZSA9IHQgKyBmICsgZSAtIDE4OTQwMDc1ODggKyBibG9ja3MyW2pdID4+PiAwOwogICAgICAgICAgICBiID0gYiA8PCAzMCB8IGIgPj4+IDI7CiAgICAgICAgICAgIGYgPSBhICYgYiB8IGEgJiBjIHwgYiAmIGM7CiAgICAgICAgICAgIHQgPSBlIDw8IDUgfCBlID4+PiAyNzsKICAgICAgICAgICAgZCA9IHQgKyBmICsgZCAtIDE4OTQwMDc1ODggKyBibG9ja3MyW2ogKyAxXSA+Pj4gMDsKICAgICAgICAgICAgYSA9IGEgPDwgMzAgfCBhID4+PiAyOwogICAgICAgICAgICBmID0gZSAmIGEgfCBlICYgYiB8IGEgJiBiOwogICAgICAgICAgICB0ID0gZCA8PCA1IHwgZCA+Pj4gMjc7CiAgICAgICAgICAgIGMgPSB0ICsgZiArIGMgLSAxODk0MDA3NTg4ICsgYmxvY2tzMltqICsgMl0gPj4+IDA7CiAgICAgICAgICAgIGUgPSBlIDw8IDMwIHwgZSA+Pj4gMjsKICAgICAgICAgICAgZiA9IGQgJiBlIHwgZCAmIGEgfCBlICYgYTsKICAgICAgICAgICAgdCA9IGMgPDwgNSB8IGMgPj4+IDI3OwogICAgICAgICAgICBiID0gdCArIGYgKyBiIC0gMTg5NDAwNzU4OCArIGJsb2NrczJbaiArIDNdID4+PiAwOwogICAgICAgICAgICBkID0gZCA8PCAzMCB8IGQgPj4+IDI7CiAgICAgICAgICAgIGYgPSBjICYgZCB8IGMgJiBlIHwgZCAmIGU7CiAgICAgICAgICAgIHQgPSBiIDw8IDUgfCBiID4+PiAyNzsKICAgICAgICAgICAgYSA9IHQgKyBmICsgYSAtIDE4OTQwMDc1ODggKyBibG9ja3MyW2ogKyA0XSA+Pj4gMDsKICAgICAgICAgICAgYyA9IGMgPDwgMzAgfCBjID4+PiAyOwogICAgICAgIH0KICAgICAgICBmb3IoOyBqIDwgODA7IGogKz0gNSl7CiAgICAgICAgICAgIGYgPSBiIF4gYyBeIGQ7CiAgICAgICAgICAgIHQgPSBhIDw8IDUgfCBhID4+PiAyNzsKICAgICAgICAgICAgZSA9IHQgKyBmICsgZSAtIDg5OTQ5NzUxNCArIGJsb2NrczJbal0gPj4+IDA7CiAgICAgICAgICAgIGIgPSBiIDw8IDMwIHwgYiA+Pj4gMjsKICAgICAgICAgICAgZiA9IGEgXiBiIF4gYzsKICAgICAgICAgICAgdCA9IGUgPDwgNSB8IGUgPj4+IDI3OwogICAgICAgICAgICBkID0gdCArIGYgKyBkIC0gODk5NDk3NTE0ICsgYmxvY2tzMltqICsgMV0gPj4+IDA7CiAgICAgICAgICAgIGEgPSBhIDw8IDMwIHwgYSA+Pj4gMjsKICAgICAgICAgICAgZiA9IGUgXiBhIF4gYjsKICAgICAgICAgICAgdCA9IGQgPDwgNSB8IGQgPj4+IDI3OwogICAgICAgICAgICBjID0gdCArIGYgKyBjIC0gODk5NDk3NTE0ICsgYmxvY2tzMltqICsgMl0gPj4+IDA7CiAgICAgICAgICAgIGUgPSBlIDw8IDMwIHwgZSA+Pj4gMjsKICAgICAgICAgICAgZiA9IGQgXiBlIF4gYTsKICAgICAgICAgICAgdCA9IGMgPDwgNSB8IGMgPj4+IDI3OwogICAgICAgICAgICBiID0gdCArIGYgKyBiIC0gODk5NDk3NTE0ICsgYmxvY2tzMltqICsgM10gPj4+IDA7CiAgICAgICAgICAgIGQgPSBkIDw8IDMwIHwgZCA+Pj4gMjsKICAgICAgICAgICAgZiA9IGMgXiBkIF4gZTsKICAgICAgICAgICAgdCA9IGIgPDwgNSB8IGIgPj4+IDI3OwogICAgICAgICAgICBhID0gdCArIGYgKyBhIC0gODk5NDk3NTE0ICsgYmxvY2tzMltqICsgNF0gPj4+IDA7CiAgICAgICAgICAgIGMgPSBjIDw8IDMwIHwgYyA+Pj4gMjsKICAgICAgICB9CiAgICAgICAgdGhpcy4jaDAgPSB0aGlzLiNoMCArIGEgPj4+IDA7CiAgICAgICAgdGhpcy4jaDEgPSB0aGlzLiNoMSArIGIgPj4+IDA7CiAgICAgICAgdGhpcy4jaDIgPSB0aGlzLiNoMiArIGMgPj4+IDA7CiAgICAgICAgdGhpcy4jaDMgPSB0aGlzLiNoMyArIGQgPj4+IDA7CiAgICAgICAgdGhpcy4jaDQgPSB0aGlzLiNoNCArIGUgPj4+IDA7CiAgICB9CiAgICBoZXgoKSB7CiAgICAgICAgdGhpcy5maW5hbGl6ZSgpOwogICAgICAgIGNvbnN0IGgwID0gdGhpcy4jaDA7CiAgICAgICAgY29uc3QgaDEgPSB0aGlzLiNoMTsKICAgICAgICBjb25zdCBoMiA9IHRoaXMuI2gyOwogICAgICAgIGNvbnN0IGgzID0gdGhpcy4jaDM7CiAgICAgICAgY29uc3QgaDQgPSB0aGlzLiNoNDsKICAgICAgICByZXR1cm4gSEVYX0NIQVJTMVtoMCA+PiAyOCAmIDE1XSArIEhFWF9DSEFSUzFbaDAgPj4gMjQgJiAxNV0gKyBIRVhfQ0hBUlMxW2gwID4+IDIwICYgMTVdICsgSEVYX0NIQVJTMVtoMCA+PiAxNiAmIDE1XSArIEhFWF9DSEFSUzFbaDAgPj4gMTIgJiAxNV0gKyBIRVhfQ0hBUlMxW2gwID4+IDggJiAxNV0gKyBIRVhfQ0hBUlMxW2gwID4+IDQgJiAxNV0gKyBIRVhfQ0hBUlMxW2gwICYgMTVdICsgSEVYX0NIQVJTMVtoMSA+PiAyOCAmIDE1XSArIEhFWF9DSEFSUzFbaDEgPj4gMjQgJiAxNV0gKyBIRVhfQ0hBUlMxW2gxID4+IDIwICYgMTVdICsgSEVYX0NIQVJTMVtoMSA+PiAxNiAmIDE1XSArIEhFWF9DSEFSUzFbaDEgPj4gMTIgJiAxNV0gKyBIRVhfQ0hBUlMxW2gxID4+IDggJiAxNV0gKyBIRVhfQ0hBUlMxW2gxID4+IDQgJiAxNV0gKyBIRVhfQ0hBUlMxW2gxICYgMTVdICsgSEVYX0NIQVJTMVtoMiA+PiAyOCAmIDE1XSArIEhFWF9DSEFSUzFbaDIgPj4gMjQgJiAxNV0gKyBIRVhfQ0hBUlMxW2gyID4+IDIwICYgMTVdICsgSEVYX0NIQVJTMVtoMiA+PiAxNiAmIDE1XSArIEhFWF9DSEFSUzFbaDIgPj4gMTIgJiAxNV0gKyBIRVhfQ0hBUlMxW2gyID4+IDggJiAxNV0gKyBIRVhfQ0hBUlMxW2gyID4+IDQgJiAxNV0gKyBIRVhfQ0hBUlMxW2gyICYgMTVdICsgSEVYX0NIQVJTMVtoMyA+PiAyOCAmIDE1XSArIEhFWF9DSEFSUzFbaDMgPj4gMjQgJiAxNV0gKyBIRVhfQ0hBUlMxW2gzID4+IDIwICYgMTVdICsgSEVYX0NIQVJTMVtoMyA+PiAxNiAmIDE1XSArIEhFWF9DSEFSUzFbaDMgPj4gMTIgJiAxNV0gKyBIRVhfQ0hBUlMxW2gzID4+IDggJiAxNV0gKyBIRVhfQ0hBUlMxW2gzID4+IDQgJiAxNV0gKyBIRVhfQ0hBUlMxW2gzICYgMTVdICsgSEVYX0NIQVJTMVtoNCA+PiAyOCAmIDE1XSArIEhFWF9DSEFSUzFbaDQgPj4gMjQgJiAxNV0gKyBIRVhfQ0hBUlMxW2g0ID4+IDIwICYgMTVdICsgSEVYX0NIQVJTMVtoNCA+PiAxNiAmIDE1XSArIEhFWF9DSEFSUzFbaDQgPj4gMTIgJiAxNV0gKyBIRVhfQ0hBUlMxW2g0ID4+IDggJiAxNV0gKyBIRVhfQ0hBUlMxW2g0ID4+IDQgJiAxNV0gKyBIRVhfQ0hBUlMxW2g0ICYgMTVdOwogICAgfQogICAgdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaGV4KCk7CiAgICB9CiAgICBkaWdlc3QoKSB7CiAgICAgICAgdGhpcy5maW5hbGl6ZSgpOwogICAgICAgIGNvbnN0IGgwID0gdGhpcy4jaDA7CiAgICAgICAgY29uc3QgaDEgPSB0aGlzLiNoMTsKICAgICAgICBjb25zdCBoMiA9IHRoaXMuI2gyOwogICAgICAgIGNvbnN0IGgzID0gdGhpcy4jaDM7CiAgICAgICAgY29uc3QgaDQgPSB0aGlzLiNoNDsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICBoMCA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDAgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGgwID4+IDggJiAyNTUsCiAgICAgICAgICAgIGgwICYgMjU1LAogICAgICAgICAgICBoMSA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDEgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGgxID4+IDggJiAyNTUsCiAgICAgICAgICAgIGgxICYgMjU1LAogICAgICAgICAgICBoMiA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDIgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGgyID4+IDggJiAyNTUsCiAgICAgICAgICAgIGgyICYgMjU1LAogICAgICAgICAgICBoMyA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDMgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGgzID4+IDggJiAyNTUsCiAgICAgICAgICAgIGgzICYgMjU1LAogICAgICAgICAgICBoNCA+PiAyNCAmIDI1NSwKICAgICAgICAgICAgaDQgPj4gMTYgJiAyNTUsCiAgICAgICAgICAgIGg0ID4+IDggJiAyNTUsCiAgICAgICAgICAgIGg0ICYgMjU1LCAKICAgICAgICBdOwogICAgfQogICAgYXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGlnZXN0KCk7CiAgICB9CiAgICBhcnJheUJ1ZmZlcigpIHsKICAgICAgICB0aGlzLmZpbmFsaXplKCk7CiAgICAgICAgY29uc3QgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDIwKTsKICAgICAgICBjb25zdCBkYXRhVmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpOwogICAgICAgIGRhdGFWaWV3LnNldFVpbnQzMigwLCB0aGlzLiNoMCk7CiAgICAgICAgZGF0YVZpZXcuc2V0VWludDMyKDQsIHRoaXMuI2gxKTsKICAgICAgICBkYXRhVmlldy5zZXRVaW50MzIoOCwgdGhpcy4jaDIpOwogICAgICAgIGRhdGFWaWV3LnNldFVpbnQzMigxMiwgdGhpcy4jaDMpOwogICAgICAgIGRhdGFWaWV3LnNldFVpbnQzMigxNiwgdGhpcy4jaDQpOwogICAgICAgIHJldHVybiBidWZmZXI7CiAgICB9Cn0KY2xhc3MgSG1hY1NoYTEgZXh0ZW5kcyBTaGExIHsKICAgICNzaGFyZWRNZW1vcnk7CiAgICAjaW5uZXI7CiAgICAjb0tleVBhZDsKICAgIGNvbnN0cnVjdG9yKHNlY3JldEtleTEsIHNoYXJlZE1lbW9yeTQgPSBmYWxzZSl7CiAgICAgICAgc3VwZXIoc2hhcmVkTWVtb3J5NCk7CiAgICAgICAgbGV0IGtleTE7CiAgICAgICAgaWYgKHR5cGVvZiBzZWNyZXRLZXkxID09PSAic3RyaW5nIikgewogICAgICAgICAgICBjb25zdCBieXRlcyA9IFtdOwogICAgICAgICAgICBjb25zdCBsZW5ndGggPSBzZWNyZXRLZXkxLmxlbmd0aDsKICAgICAgICAgICAgbGV0IGluZGV4ID0gMDsKICAgICAgICAgICAgZm9yKGxldCBpMSA9IDA7IGkxIDwgbGVuZ3RoOyBpMSsrKXsKICAgICAgICAgICAgICAgIGxldCBjb2RlID0gc2VjcmV0S2V5MS5jaGFyQ29kZUF0KGkxKTsKICAgICAgICAgICAgICAgIGlmIChjb2RlIDwgMTI4KSB7CiAgICAgICAgICAgICAgICAgICAgYnl0ZXNbaW5kZXgrK10gPSBjb2RlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlIDwgMjA0OCkgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzW2luZGV4KytdID0gMTkyIHwgY29kZSA+PiA2OwogICAgICAgICAgICAgICAgICAgIGJ5dGVzW2luZGV4KytdID0gMTI4IHwgY29kZSAmIDYzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlIDwgNTUyOTYgfHwgY29kZSA+PSA1NzM0NCkgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzW2luZGV4KytdID0gMjI0IHwgY29kZSA+PiAxMjsKICAgICAgICAgICAgICAgICAgICBieXRlc1tpbmRleCsrXSA9IDEyOCB8IGNvZGUgPj4gNiAmIDYzOwogICAgICAgICAgICAgICAgICAgIGJ5dGVzW2luZGV4KytdID0gMTI4IHwgY29kZSAmIDYzOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb2RlID0gNjU1MzYgKyAoKGNvZGUgJiAxMDIzKSA8PCAxMCB8IHNlY3JldEtleTEuY2hhckNvZGVBdCgrK2kxKSAmIDEwMjMpOwogICAgICAgICAgICAgICAgICAgIGJ5dGVzW2luZGV4KytdID0gMjQwIHwgY29kZSA+PiAxODsKICAgICAgICAgICAgICAgICAgICBieXRlc1tpbmRleCsrXSA9IDEyOCB8IGNvZGUgPj4gMTIgJiA2MzsKICAgICAgICAgICAgICAgICAgICBieXRlc1tpbmRleCsrXSA9IDEyOCB8IGNvZGUgPj4gNiAmIDYzOwogICAgICAgICAgICAgICAgICAgIGJ5dGVzW2luZGV4KytdID0gMTI4IHwgY29kZSAmIDYzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGtleTEgPSBieXRlczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoc2VjcmV0S2V5MSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7CiAgICAgICAgICAgICAgICBrZXkxID0gbmV3IFVpbnQ4QXJyYXkoc2VjcmV0S2V5MSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBrZXkxID0gc2VjcmV0S2V5MTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoa2V5MS5sZW5ndGggPiA2NCkgewogICAgICAgICAgICBrZXkxID0gbmV3IFNoYTEodHJ1ZSkudXBkYXRlKGtleTEpLmFycmF5KCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG9LZXlQYWQxID0gW107CiAgICAgICAgY29uc3QgaUtleVBhZDEgPSBbXTsKICAgICAgICBmb3IobGV0IGkxID0gMDsgaTEgPCA2NDsgaTErKyl7CiAgICAgICAgICAgIGNvbnN0IGIgPSBrZXkxW2kxXSB8fCAwOwogICAgICAgICAgICBvS2V5UGFkMVtpMV0gPSA5MiBeIGI7CiAgICAgICAgICAgIGlLZXlQYWQxW2kxXSA9IDU0IF4gYjsKICAgICAgICB9CiAgICAgICAgdGhpcy51cGRhdGUoaUtleVBhZDEpOwogICAgICAgIHRoaXMuI29LZXlQYWQgPSBvS2V5UGFkMTsKICAgICAgICB0aGlzLiNpbm5lciA9IHRydWU7CiAgICAgICAgdGhpcy4jc2hhcmVkTWVtb3J5ID0gc2hhcmVkTWVtb3J5NDsKICAgIH0KICAgIGZpbmFsaXplKCkgewogICAgICAgIHN1cGVyLmZpbmFsaXplKCk7CiAgICAgICAgaWYgKHRoaXMuI2lubmVyKSB7CiAgICAgICAgICAgIHRoaXMuI2lubmVyID0gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IGlubmVySGFzaCA9IHRoaXMuYXJyYXkoKTsKICAgICAgICAgICAgc3VwZXIuaW5pdCh0aGlzLiNzaGFyZWRNZW1vcnkpOwogICAgICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLiNvS2V5UGFkKTsKICAgICAgICAgICAgdGhpcy51cGRhdGUoaW5uZXJIYXNoKTsKICAgICAgICAgICAgc3VwZXIuZmluYWxpemUoKTsKICAgICAgICB9CiAgICB9Cn0KY2xhc3MgRGVub1N0ZEludGVybmFsRXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKXsKICAgICAgICBzdXBlcihtZXNzYWdlKTsKICAgICAgICB0aGlzLm5hbWUgPSAiRGVub1N0ZEludGVybmFsRXJyb3IiOwogICAgfQp9CnZhciBRID0gT2JqZWN0LmNyZWF0ZSwgRSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSwgWCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwgRyA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksIEogPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcywgSzEgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwp2YXIgVyA9IChlKT0+RShlLCAiX19lc01vZHVsZSIsIHsKICAgICAgICB2YWx1ZTogITAKICAgIH0pCjsKdmFyIGcgPSAoZSwgdCk9PigpPT4odCB8fCBlKCh0ID0gewogICAgICAgICAgICBleHBvcnRzOiB7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5leHBvcnRzLCB0KSwgdC5leHBvcnRzKQo7CnZhciBZID0gKGUsIHQsIHIxKT0+ewogICAgaWYgKHQgJiYgdHlwZW9mIHQgPT0gIm9iamVjdCIgfHwgdHlwZW9mIHQgPT0gImZ1bmN0aW9uIikgZm9yIChsZXQgbiBvZiBKKHQpKSFHLmNhbGwoZSwgbikgJiYgbiAhPT0gImRlZmF1bHQiICYmIEUoZSwgbiwgewogICAgICAgIGdldDogKCk9PnRbbl0KICAgICAgICAsCiAgICAgICAgZW51bWVyYWJsZTogIShyMSA9IEsxKHQsIG4pKSB8fCByMS5lbnVtZXJhYmxlCiAgICB9KTsKICAgIHJldHVybiBlOwp9LCBCID0gKGUpPT5ZKFcoRShlICE9IG51bGwgPyBRKFgoZSkpIDogewogICAgfSwgImRlZmF1bHQiLCBlICYmIGUuX19lc01vZHVsZSAmJiAiZGVmYXVsdCIgaW4gZSA/IHsKICAgICAgICBnZXQ6ICgpPT5lLmRlZmF1bHQKICAgICAgICAsCiAgICAgICAgZW51bWVyYWJsZTogITAKICAgIH0gOiB7CiAgICAgICAgdmFsdWU6IGUsCiAgICAgICAgZW51bWVyYWJsZTogITAKICAgIH0pKSwgZSkKOwp2YXIgdyA9IGcoKEwpPT57CiAgICBmdW5jdGlvbiBUKGUpIHsKICAgICAgICB0aGlzLnNlcXVlbmNlcyA9IGUuc3BsaXQoL1xyP1xuLyksIHRoaXMudG90YWxMaW5lcyA9IHRoaXMuc2VxdWVuY2VzLmxlbmd0aCwgdGhpcy5saW5lTnVtYmVyID0gMDsKICAgIH0KICAgIFQucHJvdG90eXBlLnBlZWtOZXh0TGluZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmhhc05leHQoKSA/IHRoaXMuc2VxdWVuY2VzW3RoaXMubGluZU51bWJlcl0gOiBudWxsOwogICAgfTsKICAgIFQucHJvdG90eXBlLmdldE5leHRMaW5lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaGFzTmV4dCgpID8gdGhpcy5zZXF1ZW5jZXNbdGhpcy5saW5lTnVtYmVyKytdIDogbnVsbDsKICAgIH07CiAgICBULnByb3RvdHlwZS5oYXNOZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGluZU51bWJlciA8IHRoaXMudG90YWxMaW5lczsKICAgIH07CiAgICB0eXBlb2YgTCAhPSAidW5kZWZpbmVkIiAmJiAoTC5TdHJlYW0gPSBUKTsKfSk7CnZhciBTID0gZygoUik9PnsKICAgIHZhciB1ID0gewogICAgICAgIHJ1bGVzOiB7CiAgICAgICAgfSwKICAgICAgICBkZWZpbmU6IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgdGhpcy5ydWxlc1tlXSA9IHQ7CiAgICAgICAgICAgIHZhciByMSA9ICJpcyIgKyBlLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZSgpICsgZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgIHRoaXNbcjFdID0gZnVuY3Rpb24obikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucnVsZXNbZV0uZXhlYyhuKTsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9OwogICAgdS5kZWZpbmUoImhlYWRlciIsIC9eKFwqKylccysoLiopJC8pOwogICAgdS5kZWZpbmUoInByZWZvcm1hdHRlZCIsIC9eKFxzKik6KD86ICguKikkfCQpLyk7CiAgICB1LmRlZmluZSgidW5vcmRlcmVkTGlzdEVsZW1lbnQiLCAvXihccyopKD86LXxcK3xccytcKilccysoLiopJC8pOwogICAgdS5kZWZpbmUoIm9yZGVyZWRMaXN0RWxlbWVudCIsIC9eKFxzKikoXGQrKSg/OlwufFwpKVxzKyguKikkLyk7CiAgICB1LmRlZmluZSgidGFibGVTZXBhcmF0b3IiLCAvXihccyopXHwoKD86XCt8LSkqPylcfD8kLyk7CiAgICB1LmRlZmluZSgidGFibGVSb3ciLCAvXihccyopXHwoLio/KVx8PyQvKTsKICAgIHUuZGVmaW5lKCJibGFuayIsIC9eJC8pOwogICAgdS5kZWZpbmUoImhvcml6b250YWxSdWxlIiwgL14oXHMqKS17NSx9JC8pOwogICAgdS5kZWZpbmUoImRpcmVjdGl2ZSIsIC9eKFxzKikjXCsoPzooYmVnaW58ZW5kKV8pPyguKikkL2kpOwogICAgdS5kZWZpbmUoImNvbW1lbnQiLCAvXihccyopIyguKikkLyk7CiAgICB1LmRlZmluZSgibGluZSIsIC9eKFxzKikoLiopJC8pOwogICAgZnVuY3Rpb24gRCgpIHsKICAgIH0KICAgIEQucHJvdG90eXBlID0gewogICAgICAgIGlzTGlzdEVsZW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50eXBlID09PSBmLnRva2Vucy5vcmRlcmVkTGlzdEVsZW1lbnQgfHwgdGhpcy50eXBlID09PSBmLnRva2Vucy51bm9yZGVyZWRMaXN0RWxlbWVudDsKICAgICAgICB9LAogICAgICAgIGlzVGFibGVFbGVtZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gZi50b2tlbnMudGFibGVTZXBhcmF0b3IgfHwgdGhpcy50eXBlID09PSBmLnRva2Vucy50YWJsZVJvdzsKICAgICAgICB9CiAgICB9OwogICAgZnVuY3Rpb24gZihlKSB7CiAgICAgICAgdGhpcy5zdHJlYW0gPSBlLCB0aGlzLnRva2VuU3RhY2sgPSBbXTsKICAgIH0KICAgIGYucHJvdG90eXBlID0gewogICAgICAgIHRva2VuaXplOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciB0ID0gbmV3IEQ7CiAgICAgICAgICAgIGlmICh0LmZyb21MaW5lTnVtYmVyID0gdGhpcy5zdHJlYW0ubGluZU51bWJlciwgdS5pc0hlYWRlcihlKSkgdC50eXBlID0gZi50b2tlbnMuaGVhZGVyLCB0LmluZGVudGF0aW9uID0gMCwgdC5jb250ZW50ID0gUmVnRXhwLiQyLCB0LmxldmVsID0gUmVnRXhwLiQxLmxlbmd0aDsKICAgICAgICAgICAgZWxzZSBpZiAodS5pc1ByZWZvcm1hdHRlZChlKSkgdC50eXBlID0gZi50b2tlbnMucHJlZm9ybWF0dGVkLCB0LmluZGVudGF0aW9uID0gUmVnRXhwLiQxLmxlbmd0aCwgdC5jb250ZW50ID0gUmVnRXhwLiQyOwogICAgICAgICAgICBlbHNlIGlmICh1LmlzVW5vcmRlcmVkTGlzdEVsZW1lbnQoZSkpIHQudHlwZSA9IGYudG9rZW5zLnVub3JkZXJlZExpc3RFbGVtZW50LCB0LmluZGVudGF0aW9uID0gUmVnRXhwLiQxLmxlbmd0aCwgdC5jb250ZW50ID0gUmVnRXhwLiQyOwogICAgICAgICAgICBlbHNlIGlmICh1LmlzT3JkZXJlZExpc3RFbGVtZW50KGUpKSB0LnR5cGUgPSBmLnRva2Vucy5vcmRlcmVkTGlzdEVsZW1lbnQsIHQuaW5kZW50YXRpb24gPSBSZWdFeHAuJDEubGVuZ3RoLCB0LmNvbnRlbnQgPSBSZWdFeHAuJDMsIHQubnVtYmVyID0gUmVnRXhwLiQyOwogICAgICAgICAgICBlbHNlIGlmICh1LmlzVGFibGVTZXBhcmF0b3IoZSkpIHQudHlwZSA9IGYudG9rZW5zLnRhYmxlU2VwYXJhdG9yLCB0LmluZGVudGF0aW9uID0gUmVnRXhwLiQxLmxlbmd0aCwgdC5jb250ZW50ID0gUmVnRXhwLiQyOwogICAgICAgICAgICBlbHNlIGlmICh1LmlzVGFibGVSb3coZSkpIHQudHlwZSA9IGYudG9rZW5zLnRhYmxlUm93LCB0LmluZGVudGF0aW9uID0gUmVnRXhwLiQxLmxlbmd0aCwgdC5jb250ZW50ID0gUmVnRXhwLiQyOwogICAgICAgICAgICBlbHNlIGlmICh1LmlzQmxhbmsoZSkpIHQudHlwZSA9IGYudG9rZW5zLmJsYW5rLCB0LmluZGVudGF0aW9uID0gMCwgdC5jb250ZW50ID0gbnVsbDsKICAgICAgICAgICAgZWxzZSBpZiAodS5pc0hvcml6b250YWxSdWxlKGUpKSB0LnR5cGUgPSBmLnRva2Vucy5ob3Jpem9udGFsUnVsZSwgdC5pbmRlbnRhdGlvbiA9IFJlZ0V4cC4kMS5sZW5ndGgsIHQuY29udGVudCA9IG51bGw7CiAgICAgICAgICAgIGVsc2UgaWYgKHUuaXNEaXJlY3RpdmUoZSkpIHsKICAgICAgICAgICAgICAgIHQudHlwZSA9IGYudG9rZW5zLmRpcmVjdGl2ZSwgdC5pbmRlbnRhdGlvbiA9IFJlZ0V4cC4kMS5sZW5ndGgsIHQuY29udGVudCA9IFJlZ0V4cC4kMzsKICAgICAgICAgICAgICAgIHZhciByMSA9IFJlZ0V4cC4kMjsKICAgICAgICAgICAgICAgIC9eYmVnaW4vaS50ZXN0KHIxKSA/IHQuYmVnaW5EaXJlY3RpdmUgPSAhMCA6IC9eZW5kL2kudGVzdChyMSkgPyB0LmVuZERpcmVjdGl2ZSA9ICEwIDogdC5vbmVzaG90RGlyZWN0aXZlID0gITA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodS5pc0NvbW1lbnQoZSkpIHQudHlwZSA9IGYudG9rZW5zLmNvbW1lbnQsIHQuaW5kZW50YXRpb24gPSBSZWdFeHAuJDEubGVuZ3RoLCB0LmNvbnRlbnQgPSBSZWdFeHAuJDI7CiAgICAgICAgICAgIGVsc2UgaWYgKHUuaXNMaW5lKGUpKSB0LnR5cGUgPSBmLnRva2Vucy5saW5lLCB0LmluZGVudGF0aW9uID0gUmVnRXhwLiQxLmxlbmd0aCwgdC5jb250ZW50ID0gUmVnRXhwLiQyOwogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigiU3ludGF4RXJyb3I6IFVua25vd24gbGluZTogIiArIGUpOwogICAgICAgICAgICByZXR1cm4gdDsKICAgICAgICB9LAogICAgICAgIHB1c2hUb2tlbjogZnVuY3Rpb24oZSkgewogICAgICAgICAgICB0aGlzLnRva2VuU3RhY2sucHVzaChlKTsKICAgICAgICB9LAogICAgICAgIHB1c2hEdW1teVRva2VuQnlUeXBlOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciB0ID0gbmV3IEQ7CiAgICAgICAgICAgIHQudHlwZSA9IGUsIHRoaXMudG9rZW5TdGFjay5wdXNoKHQpOwogICAgICAgIH0sCiAgICAgICAgcGVla1N0YWNrZWRUb2tlbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRva2VuU3RhY2subGVuZ3RoID4gMCA/IHRoaXMudG9rZW5TdGFja1t0aGlzLnRva2VuU3RhY2subGVuZ3RoIC0gMV0gOiBudWxsOwogICAgICAgIH0sCiAgICAgICAgZ2V0U3RhY2tlZFRva2VuOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9rZW5TdGFjay5sZW5ndGggPiAwID8gdGhpcy50b2tlblN0YWNrLnBvcCgpIDogbnVsbDsKICAgICAgICB9LAogICAgICAgIHBlZWtOZXh0VG9rZW46IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wZWVrU3RhY2tlZFRva2VuKCkgfHwgdGhpcy50b2tlbml6ZSh0aGlzLnN0cmVhbS5wZWVrTmV4dExpbmUoKSk7CiAgICAgICAgfSwKICAgICAgICBnZXROZXh0VG9rZW46IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTdGFja2VkVG9rZW4oKSB8fCB0aGlzLnRva2VuaXplKHRoaXMuc3RyZWFtLmdldE5leHRMaW5lKCkpOwogICAgICAgIH0sCiAgICAgICAgaGFzTmV4dDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmVhbS5oYXNOZXh0KCk7CiAgICAgICAgfSwKICAgICAgICBnZXRMaW5lTnVtYmVyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLmxpbmVOdW1iZXI7CiAgICAgICAgfQogICAgfTsKICAgIGYudG9rZW5zID0gewogICAgfTsKICAgIFsKICAgICAgICAiaGVhZGVyIiwKICAgICAgICAib3JkZXJlZExpc3RFbGVtZW50IiwKICAgICAgICAidW5vcmRlcmVkTGlzdEVsZW1lbnQiLAogICAgICAgICJ0YWJsZVJvdyIsCiAgICAgICAgInRhYmxlU2VwYXJhdG9yIiwKICAgICAgICAicHJlZm9ybWF0dGVkIiwKICAgICAgICAibGluZSIsCiAgICAgICAgImhvcml6b250YWxSdWxlIiwKICAgICAgICAiYmxhbmsiLAogICAgICAgICJkaXJlY3RpdmUiLAogICAgICAgICJjb21tZW50IgogICAgXS5mb3JFYWNoKGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICBmLnRva2Vuc1tlXSA9IHQ7CiAgICB9KTsKICAgIHR5cGVvZiBSICE9ICJ1bmRlZmluZWQiICYmIChSLkxleGVyID0gZik7Cn0pOwp2YXIgYiA9IGcoKEMpPT57CiAgICBmdW5jdGlvbiBqKGUsIHQpIHsKICAgICAgICBpZiAodGhpcy50eXBlID0gZSwgdGhpcy5jaGlsZHJlbiA9IFtdLCB0KSBmb3IodmFyIHIyID0gMCwgbiA9IHQubGVuZ3RoOyByMiA8IG47ICsrcjIpdGhpcy5hcHBlbmRDaGlsZCh0W3IyXSk7CiAgICB9CiAgICBqLnByb3RvdHlwZSA9IHsKICAgICAgICBwcmV2aW91c1NpYmxpbmc6IG51bGwsCiAgICAgICAgcGFyZW50OiBudWxsLAogICAgICAgIGdldCBmaXJzdENoaWxkICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW4ubGVuZ3RoIDwgMSA/IG51bGwgOiB0aGlzLmNoaWxkcmVuWzBdOwogICAgICAgIH0sCiAgICAgICAgZ2V0IGxhc3RDaGlsZCAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuLmxlbmd0aCA8IDEgPyBudWxsIDogdGhpcy5jaGlsZHJlblt0aGlzLmNoaWxkcmVuLmxlbmd0aCAtIDFdOwogICAgICAgIH0sCiAgICAgICAgYXBwZW5kQ2hpbGQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmNoaWxkcmVuLmxlbmd0aCA8IDEgPyBudWxsIDogdGhpcy5sYXN0Q2hpbGQ7CiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChlKSwgZS5wcmV2aW91c1NpYmxpbmcgPSB0LCBlLnBhcmVudCA9IHRoaXM7CiAgICAgICAgfSwKICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBlID0gIjwiICsgdGhpcy50eXBlICsgIj4iOwogICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRoaXMudmFsdWUgIT0gInVuZGVmaW5lZCIgPyBlICs9ICIgIiArIHRoaXMudmFsdWUgOiB0aGlzLmNoaWxkcmVuICYmIChlICs9IGBcbmAgKyB0aGlzLmNoaWxkcmVuLm1hcChmdW5jdGlvbih0LCByMikgewogICAgICAgICAgICAgICAgcmV0dXJuICIjIiArIHIyICsgIiAiICsgdC50b1N0cmluZygpOwogICAgICAgICAgICB9KS5qb2luKGBcbmApLnNwbGl0KGBcbmApLm1hcChmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIiAgIiArIHQ7CiAgICAgICAgICAgIH0pLmpvaW4oYFxuYCkpLCBlOwogICAgICAgIH0KICAgIH07CiAgICB2YXIgcCA9IHsKICAgICAgICB0eXBlczogewogICAgICAgIH0sCiAgICAgICAgZGVmaW5lOiBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgIHRoaXMudHlwZXNbZV0gPSBlOwogICAgICAgICAgICB2YXIgcjIgPSAiY3JlYXRlIiArIGUuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBlLnN1YnN0cmluZygxKSwgbiA9IHR5cGVvZiB0ID09ICJmdW5jdGlvbiI7CiAgICAgICAgICAgIHRoaXNbcjJdID0gZnVuY3Rpb24oaTIsIHMpIHsKICAgICAgICAgICAgICAgIHZhciBhID0gbmV3IGooZSwgaTIpOwogICAgICAgICAgICAgICAgcmV0dXJuIG4gJiYgdChhLCBzIHx8IHsKICAgICAgICAgICAgICAgIH0pLCBhOwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH07CiAgICBwLmRlZmluZSgidGV4dCIsIGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICBlLnZhbHVlID0gdC52YWx1ZTsKICAgIH0pOwogICAgcC5kZWZpbmUoImhlYWRlciIsIGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICBlLmxldmVsID0gdC5sZXZlbDsKICAgIH0pOwogICAgcC5kZWZpbmUoIm9yZGVyZWRMaXN0Iik7CiAgICBwLmRlZmluZSgidW5vcmRlcmVkTGlzdCIpOwogICAgcC5kZWZpbmUoImRlZmluaXRpb25MaXN0Iik7CiAgICBwLmRlZmluZSgibGlzdEVsZW1lbnQiKTsKICAgIHAuZGVmaW5lKCJwYXJhZ3JhcGgiKTsKICAgIHAuZGVmaW5lKCJwcmVmb3JtYXR0ZWQiKTsKICAgIHAuZGVmaW5lKCJ0YWJsZSIpOwogICAgcC5kZWZpbmUoInRhYmxlUm93Iik7CiAgICBwLmRlZmluZSgidGFibGVDZWxsIik7CiAgICBwLmRlZmluZSgiaG9yaXpvbnRhbFJ1bGUiKTsKICAgIHAuZGVmaW5lKCJkaXJlY3RpdmUiKTsKICAgIHAuZGVmaW5lKCJpbmxpbmVDb250YWluZXIiKTsKICAgIHAuZGVmaW5lKCJib2xkIik7CiAgICBwLmRlZmluZSgiaXRhbGljIik7CiAgICBwLmRlZmluZSgidW5kZXJsaW5lIik7CiAgICBwLmRlZmluZSgiY29kZSIpOwogICAgcC5kZWZpbmUoInZlcmJhdGltIik7CiAgICBwLmRlZmluZSgiZGFzaGVkIik7CiAgICBwLmRlZmluZSgibGluayIsIGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICBlLnNyYyA9IHQuc3JjOwogICAgfSk7CiAgICB0eXBlb2YgQyAhPSAidW5kZWZpbmVkIiAmJiAoQy5Ob2RlID0gcCk7Cn0pOwp2YXIgUCA9IGcoKE4pPT57CiAgICB2YXIgWiA9IHcoKS5TdHJlYW0sIG8gPSBTKCkuTGV4ZXIsIGMgPSBiKCkuTm9kZTsKICAgIGZ1bmN0aW9uIHgxKCkgewogICAgICAgIHRoaXMuaW5saW5lUGFyc2VyID0gbmV3IE87CiAgICB9CiAgICB4MS5wYXJzZVN0cmVhbSA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICB2YXIgcjIgPSBuZXcgeDE7CiAgICAgICAgcmV0dXJuIHIyLmluaXRTdGF0dXMoZSwgdCksIHIyLnBhcnNlTm9kZXMoKSwgcjIubm9kZXM7CiAgICB9OwogICAgeDEucHJvdG90eXBlID0gewogICAgICAgIGluaXRTdGF0dXM6IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBlID09ICJzdHJpbmciICYmIChlID0gbmV3IFooZSkpLCB0aGlzLmxleGVyID0gbmV3IG8oZSksIHRoaXMubm9kZXMgPSBbXSwgdGhpcy5vcHRpb25zID0gewogICAgICAgICAgICAgICAgdG9jOiAhMCwKICAgICAgICAgICAgICAgIG51bTogITAsCiAgICAgICAgICAgICAgICAiXiI6ICJ7fSIsCiAgICAgICAgICAgICAgICBtdWx0aWxpbmVDZWxsOiAhMQogICAgICAgICAgICB9LCB0ICYmIHR5cGVvZiB0ID09ICJvYmplY3QiKSBmb3IodmFyIHIyIGluIHQpdGhpcy5vcHRpb25zW3IyXSA9IHRbcjJdOwogICAgICAgICAgICB0aGlzLmRvY3VtZW50ID0gewogICAgICAgICAgICAgICAgb3B0aW9uczogdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgZGlyZWN0aXZlVmFsdWVzOiB7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udmVydDogZnVuY3Rpb24obiwgaTIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IG5ldyBuKHRoaXMsIGkyKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcy5yZXN1bHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBwYXJzZTogZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5pbml0U3RhdHVzKGUsIHQpLCB0aGlzLnBhcnNlRG9jdW1lbnQoKSwgdGhpcy5kb2N1bWVudC5ub2RlcyA9IHRoaXMubm9kZXMsIHRoaXMuZG9jdW1lbnQ7CiAgICAgICAgfSwKICAgICAgICBjcmVhdGVFcnJvclJlcG9ydDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICByZXR1cm4gbmV3IEVycm9yKGUgKyAiIGF0IGxpbmUgIiArIHRoaXMubGV4ZXIuZ2V0TGluZU51bWJlcigpKTsKICAgICAgICB9LAogICAgICAgIHNraXBCbGFuazogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZvcih2YXIgZSA9IG51bGw7IHRoaXMubGV4ZXIucGVla05leHRUb2tlbigpLnR5cGUgPT09IG8udG9rZW5zLmJsYW5rOyllID0gdGhpcy5sZXhlci5nZXROZXh0VG9rZW4oKTsKICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgfSwKICAgICAgICBzZXROb2RlT3JpZ2luRnJvbVRva2VuOiBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgIHJldHVybiBlLmZyb21MaW5lTnVtYmVyID0gdC5mcm9tTGluZU51bWJlciwgZTsKICAgICAgICB9LAogICAgICAgIGFwcGVuZE5vZGU6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLm5vZGVzLmxlbmd0aCA+IDAgPyB0aGlzLm5vZGVzW3RoaXMubm9kZXMubGVuZ3RoIC0gMV0gOiBudWxsOwogICAgICAgICAgICB0aGlzLm5vZGVzLnB1c2goZSksIGUucHJldmlvdXNTaWJsaW5nID0gdDsKICAgICAgICB9LAogICAgICAgIHBhcnNlRG9jdW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0aGlzLnBhcnNlVGl0bGUoKSwgdGhpcy5wYXJzZU5vZGVzKCk7CiAgICAgICAgfSwKICAgICAgICBwYXJzZU5vZGVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yKDsgdGhpcy5sZXhlci5oYXNOZXh0KCk7KXsKICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5wYXJzZUVsZW1lbnQoKTsKICAgICAgICAgICAgICAgIGUgJiYgdGhpcy5hcHBlbmROb2RlKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBwYXJzZVRpdGxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5za2lwQmxhbmsoKSwgdGhpcy5sZXhlci5oYXNOZXh0KCkgJiYgdGhpcy5sZXhlci5wZWVrTmV4dFRva2VuKCkudHlwZSA9PT0gby50b2tlbnMubGluZSA/IHRoaXMuZG9jdW1lbnQudGl0bGUgPSB0aGlzLmNyZWF0ZVRleHROb2RlKHRoaXMubGV4ZXIuZ2V0TmV4dFRva2VuKCkuY29udGVudCkgOiB0aGlzLmRvY3VtZW50LnRpdGxlID0gbnVsbCwgdGhpcy5sZXhlci5wdXNoRHVtbXlUb2tlbkJ5VHlwZShvLnRva2Vucy5ibGFuayk7CiAgICAgICAgfSwKICAgICAgICBwYXJzZUVsZW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgZSA9IG51bGw7CiAgICAgICAgICAgIHN3aXRjaCh0aGlzLmxleGVyLnBlZWtOZXh0VG9rZW4oKS50eXBlKXsKICAgICAgICAgICAgICAgIGNhc2Ugby50b2tlbnMuaGVhZGVyOgogICAgICAgICAgICAgICAgICAgIGUgPSB0aGlzLnBhcnNlSGVhZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIG8udG9rZW5zLnByZWZvcm1hdHRlZDoKICAgICAgICAgICAgICAgICAgICBlID0gdGhpcy5wYXJzZVByZWZvcm1hdHRlZCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBvLnRva2Vucy5vcmRlcmVkTGlzdEVsZW1lbnQ6CiAgICAgICAgICAgICAgICBjYXNlIG8udG9rZW5zLnVub3JkZXJlZExpc3RFbGVtZW50OgogICAgICAgICAgICAgICAgICAgIGUgPSB0aGlzLnBhcnNlTGlzdCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBvLnRva2Vucy5saW5lOgogICAgICAgICAgICAgICAgICAgIGUgPSB0aGlzLnBhcnNlVGV4dCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBvLnRva2Vucy50YWJsZVJvdzoKICAgICAgICAgICAgICAgIGNhc2Ugby50b2tlbnMudGFibGVTZXBhcmF0b3I6CiAgICAgICAgICAgICAgICAgICAgZSA9IHRoaXMucGFyc2VUYWJsZSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBvLnRva2Vucy5ibGFuazoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNraXBCbGFuaygpLCB0aGlzLmxleGVyLmhhc05leHQoKSAmJiAodGhpcy5sZXhlci5wZWVrTmV4dFRva2VuKCkudHlwZSA9PT0gby50b2tlbnMubGluZSA/IGUgPSB0aGlzLnBhcnNlUGFyYWdyYXBoKCkgOiBlID0gdGhpcy5wYXJzZUVsZW1lbnQoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIG8udG9rZW5zLmhvcml6b250YWxSdWxlOgogICAgICAgICAgICAgICAgICAgIHRoaXMubGV4ZXIuZ2V0TmV4dFRva2VuKCksIGUgPSBjLmNyZWF0ZUhvcml6b250YWxSdWxlKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIG8udG9rZW5zLmRpcmVjdGl2ZToKICAgICAgICAgICAgICAgICAgICBlID0gdGhpcy5wYXJzZURpcmVjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBvLnRva2Vucy5jb21tZW50OgogICAgICAgICAgICAgICAgICAgIHRoaXMubGV4ZXIuZ2V0TmV4dFRva2VuKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMuY3JlYXRlRXJyb3JSZXBvcnQoIlVuaGFuZGxlZCB0b2tlbjogIiArIHRoaXMubGV4ZXIucGVla05leHRUb2tlbigpLnR5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlOwogICAgICAgIH0sCiAgICAgICAgcGFyc2VFbGVtZW50QmVzaWRlc0RpcmVjdGl2ZUVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUVsZW1lbnQgPSB0aGlzLnBhcnNlRWxlbWVudEJlc2lkZXNEaXJlY3RpdmVFbmRCb2R5LCB0aGlzLnBhcnNlRWxlbWVudCgpOwogICAgICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgICAgICB0aGlzLnBhcnNlRWxlbWVudCA9IHRoaXMub3JpZ2luYWxQYXJzZUVsZW1lbnQ7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHBhcnNlRWxlbWVudEJlc2lkZXNEaXJlY3RpdmVFbmRCb2R5OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGV4ZXIucGVla05leHRUb2tlbigpLnR5cGUgPT09IG8udG9rZW5zLmRpcmVjdGl2ZSAmJiB0aGlzLmxleGVyLnBlZWtOZXh0VG9rZW4oKS5lbmREaXJlY3RpdmUgPyBudWxsIDogdGhpcy5vcmlnaW5hbFBhcnNlRWxlbWVudCgpOwogICAgICAgIH0sCiAgICAgICAgcGFyc2VIZWFkZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXMubGV4ZXIuZ2V0TmV4dFRva2VuKCksIHQgPSBjLmNyZWF0ZUhlYWRlcihbCiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVRleHROb2RlKGUuY29udGVudCkKICAgICAgICAgICAgXSwgewogICAgICAgICAgICAgICAgbGV2ZWw6IGUubGV2ZWwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNldE5vZGVPcmlnaW5Gcm9tVG9rZW4odCwgZSksIHQ7CiAgICAgICAgfSwKICAgICAgICBwYXJzZVByZWZvcm1hdHRlZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5sZXhlci5wZWVrTmV4dFRva2VuKCksIHQgPSBjLmNyZWF0ZVByZWZvcm1hdHRlZChbXSk7CiAgICAgICAgICAgIHRoaXMuc2V0Tm9kZU9yaWdpbkZyb21Ub2tlbih0LCBlKTsKICAgICAgICAgICAgZm9yKHZhciByMiA9IFtdOyB0aGlzLmxleGVyLmhhc05leHQoKTspewogICAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLmxleGVyLnBlZWtOZXh0VG9rZW4oKTsKICAgICAgICAgICAgICAgIGlmIChuLnR5cGUgIT09IG8udG9rZW5zLnByZWZvcm1hdHRlZCB8fCBuLmluZGVudGF0aW9uIDwgZS5pbmRlbnRhdGlvbikgYnJlYWs7CiAgICAgICAgICAgICAgICB0aGlzLmxleGVyLmdldE5leHRUb2tlbigpLCByMi5wdXNoKG4uY29udGVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHQuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVUZXh0Tm9kZShyMi5qb2luKGBcbmApLCAhMCkpLCB0OwogICAgICAgIH0sCiAgICAgICAgZGVmaW5pdGlvblBhdHRlcm46IC9eKC4qPykgOjogKiguKikkLywKICAgICAgICBwYXJzZUxpc3Q6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXMubGV4ZXIucGVla05leHRUb2tlbigpLCB0LCByMiA9ICExOwogICAgICAgICAgICBmb3IodGhpcy5kZWZpbml0aW9uUGF0dGVybi50ZXN0KGUuY29udGVudCkgPyAodCA9IGMuY3JlYXRlRGVmaW5pdGlvbkxpc3QoW10pLCByMiA9ICEwKSA6IHQgPSBlLnR5cGUgPT09IG8udG9rZW5zLnVub3JkZXJlZExpc3RFbGVtZW50ID8gYy5jcmVhdGVVbm9yZGVyZWRMaXN0KFtdKSA6IGMuY3JlYXRlT3JkZXJlZExpc3QoW10pLCB0aGlzLnNldE5vZGVPcmlnaW5Gcm9tVG9rZW4odCwgZSk7IHRoaXMubGV4ZXIuaGFzTmV4dCgpOyl7CiAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMubGV4ZXIucGVla05leHRUb2tlbigpOwogICAgICAgICAgICAgICAgaWYgKCFuLmlzTGlzdEVsZW1lbnQoKSB8fCBuLmluZGVudGF0aW9uICE9PSBlLmluZGVudGF0aW9uKSBicmVhazsKICAgICAgICAgICAgICAgIHQuYXBwZW5kQ2hpbGQodGhpcy5wYXJzZUxpc3RFbGVtZW50KGUuaW5kZW50YXRpb24sIHIyKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgfSwKICAgICAgICB1bmtub3duRGVmaW5pdGlvblRlcm06ICI/Pz8iLAogICAgICAgIHBhcnNlTGlzdEVsZW1lbnQ6IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIyID0gdGhpcy5sZXhlci5nZXROZXh0VG9rZW4oKSwgbiA9IGMuY3JlYXRlTGlzdEVsZW1lbnQoW10pOwogICAgICAgICAgICBpZiAodGhpcy5zZXROb2RlT3JpZ2luRnJvbVRva2VuKG4sIHIyKSwgbi5pc0RlZmluaXRpb25MaXN0ID0gdCwgdCkgewogICAgICAgICAgICAgICAgdmFyIGkyID0gdGhpcy5kZWZpbml0aW9uUGF0dGVybi5leGVjKHIyLmNvbnRlbnQpOwogICAgICAgICAgICAgICAgbi50ZXJtID0gWwogICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlVGV4dE5vZGUoaTIgJiYgaTJbMV0gPyBpMlsxXSA6IHRoaXMudW5rbm93bkRlZmluaXRpb25UZXJtKQogICAgICAgICAgICAgICAgXSwgbi5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZVRleHROb2RlKGkyID8gaTJbMl0gOiByMi5jb250ZW50KSk7CiAgICAgICAgICAgIH0gZWxzZSBuLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlVGV4dE5vZGUocjIuY29udGVudCkpOwogICAgICAgICAgICBmb3IoOyB0aGlzLmxleGVyLmhhc05leHQoKTspewogICAgICAgICAgICAgICAgdmFyIHMgPSB0aGlzLnNraXBCbGFuaygpOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxleGVyLmhhc05leHQoKSkgYnJlYWs7CiAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMubGV4ZXIucGVla05leHRUb2tlbigpOwogICAgICAgICAgICAgICAgaWYgKHMgJiYgIWEuaXNMaXN0RWxlbWVudCgpICYmIHRoaXMubGV4ZXIucHVzaFRva2VuKHMpLCBhLmluZGVudGF0aW9uIDw9IGUpIGJyZWFrOwogICAgICAgICAgICAgICAgdmFyIGggPSB0aGlzLnBhcnNlRWxlbWVudCgpOwogICAgICAgICAgICAgICAgaCAmJiBuLmFwcGVuZENoaWxkKGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuOwogICAgICAgIH0sCiAgICAgICAgcGFyc2VUYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5sZXhlci5wZWVrTmV4dFRva2VuKCksIHQgPSBjLmNyZWF0ZVRhYmxlKFtdKTsKICAgICAgICAgICAgdGhpcy5zZXROb2RlT3JpZ2luRnJvbVRva2VuKHQsIGUpOwogICAgICAgICAgICBmb3IodmFyIHIyID0gITEsIG4gPSBlLnR5cGUgPT09IG8udG9rZW5zLnRhYmxlU2VwYXJhdG9yICYmIHRoaXMub3B0aW9ucy5tdWx0aWxpbmVDZWxsOyB0aGlzLmxleGVyLmhhc05leHQoKSAmJiAoZSA9IHRoaXMubGV4ZXIucGVla05leHRUb2tlbigpKS5pc1RhYmxlRWxlbWVudCgpOylpZiAoZS50eXBlID09PSBvLnRva2Vucy50YWJsZVJvdykgewogICAgICAgICAgICAgICAgdmFyIGkzID0gdGhpcy5wYXJzZVRhYmxlUm93KG4pOwogICAgICAgICAgICAgICAgdC5hcHBlbmRDaGlsZChpMyk7CiAgICAgICAgICAgIH0gZWxzZSByMiA9ICEwLCB0aGlzLmxleGVyLmdldE5leHRUb2tlbigpOwogICAgICAgICAgICByZXR1cm4gcjIgJiYgdC5jaGlsZHJlbi5sZW5ndGggJiYgdC5jaGlsZHJlblswXS5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKHMpIHsKICAgICAgICAgICAgICAgIHMuaXNIZWFkZXIgPSAhMDsKICAgICAgICAgICAgfSksIHQ7CiAgICAgICAgfSwKICAgICAgICBwYXJzZVRhYmxlUm93OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGZvcih2YXIgdCA9IFtdOyB0aGlzLmxleGVyLnBlZWtOZXh0VG9rZW4oKS50eXBlID09PSBvLnRva2Vucy50YWJsZVJvdyAmJiAodC5wdXNoKHRoaXMubGV4ZXIuZ2V0TmV4dFRva2VuKCkpLCAhIWUpOyk7CiAgICAgICAgICAgIGlmICghdC5sZW5ndGgpIHRocm93IHRoaXMuY3JlYXRlRXJyb3JSZXBvcnQoIkV4cGVjdGVkIHRhYmxlIHJvdyIpOwogICAgICAgICAgICB2YXIgcjIgPSB0LnNoaWZ0KCksIG4gPSByMi5jb250ZW50LnNwbGl0KCJ8Iik7CiAgICAgICAgICAgIHQuZm9yRWFjaChmdW5jdGlvbihzKSB7CiAgICAgICAgICAgICAgICBzLmNvbnRlbnQuc3BsaXQoInwiKS5mb3JFYWNoKGZ1bmN0aW9uKGEsIGgpIHsKICAgICAgICAgICAgICAgICAgICBuW2hdID0gKG5baF0gfHwgIiIpICsgYFxuYCArIGE7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBpNCA9IG4ubWFwKGZ1bmN0aW9uKHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjLmNyZWF0ZVRhYmxlQ2VsbCh4MS5wYXJzZVN0cmVhbShzKSk7CiAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zZXROb2RlT3JpZ2luRnJvbVRva2VuKGMuY3JlYXRlVGFibGVSb3coaTQpLCByMik7CiAgICAgICAgfSwKICAgICAgICBwYXJzZURpcmVjdGl2ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5sZXhlci5nZXROZXh0VG9rZW4oKSwgdCA9IHRoaXMuY3JlYXRlRGlyZWN0aXZlTm9kZUZyb21Ub2tlbihlKTsKICAgICAgICAgICAgaWYgKGUuZW5kRGlyZWN0aXZlKSB0aHJvdyB0aGlzLmNyZWF0ZUVycm9yUmVwb3J0KCJVbm1hdGNoZWQgJ2VuZCcgZGlyZWN0aXZlIGZvciAiICsgdC5kaXJlY3RpdmVOYW1lKTsKICAgICAgICAgICAgaWYgKGUub25lc2hvdERpcmVjdGl2ZSkgcmV0dXJuIHRoaXMuaW50ZXJwcmV0RGlyZWN0aXZlKHQpLCB0OwogICAgICAgICAgICBpZiAoIWUuYmVnaW5EaXJlY3RpdmUpIHRocm93IHRoaXMuY3JlYXRlRXJyb3JSZXBvcnQoIkludmFsaWQgZGlyZWN0aXZlICIgKyB0LmRpcmVjdGl2ZU5hbWUpOwogICAgICAgICAgICByZXR1cm4gdC5jaGlsZHJlbiA9IFtdLCB0aGlzLmlzVmVyYmF0aW1EaXJlY3RpdmUodCkgPyB0aGlzLnBhcnNlRGlyZWN0aXZlQmxvY2tWZXJiYXRpbSh0KSA6IHRoaXMucGFyc2VEaXJlY3RpdmVCbG9jayh0KTsKICAgICAgICB9LAogICAgICAgIGNyZWF0ZURpcmVjdGl2ZU5vZGVGcm9tVG9rZW46IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSAvXlsgXSooW14gXSopWyBdKiguKilbIF0qJC8uZXhlYyhlLmNvbnRlbnQpLCByMiA9IGMuY3JlYXRlRGlyZWN0aXZlKG51bGwpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zZXROb2RlT3JpZ2luRnJvbVRva2VuKHIyLCBlKSwgcjIuZGlyZWN0aXZlTmFtZSA9IHRbMV0udG9Mb3dlckNhc2UoKSwgcjIuZGlyZWN0aXZlQXJndW1lbnRzID0gdGhpcy5wYXJzZURpcmVjdGl2ZUFyZ3VtZW50cyh0WzJdKSwgcjIuZGlyZWN0aXZlT3B0aW9ucyA9IHRoaXMucGFyc2VEaXJlY3RpdmVPcHRpb25zKHRbMl0pLCByMi5kaXJlY3RpdmVSYXdWYWx1ZSA9IHRbMl0sIHIyOwogICAgICAgIH0sCiAgICAgICAgaXNWZXJiYXRpbURpcmVjdGl2ZTogZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgdCA9IGUuZGlyZWN0aXZlTmFtZTsKICAgICAgICAgICAgcmV0dXJuIHQgPT09ICJzcmMiIHx8IHQgPT09ICJleGFtcGxlIiB8fCB0ID09PSAiaHRtbCI7CiAgICAgICAgfSwKICAgICAgICBwYXJzZURpcmVjdGl2ZUJsb2NrOiBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgIGZvcih0aGlzLmxleGVyLnB1c2hEdW1teVRva2VuQnlUeXBlKG8udG9rZW5zLmJsYW5rKTsgdGhpcy5sZXhlci5oYXNOZXh0KCk7KXsKICAgICAgICAgICAgICAgIHZhciByMiA9IHRoaXMubGV4ZXIucGVla05leHRUb2tlbigpOwogICAgICAgICAgICAgICAgaWYgKHIyLnR5cGUgPT09IG8udG9rZW5zLmRpcmVjdGl2ZSAmJiByMi5lbmREaXJlY3RpdmUgJiYgdGhpcy5jcmVhdGVEaXJlY3RpdmVOb2RlRnJvbVRva2VuKHIyKS5kaXJlY3RpdmVOYW1lID09PSBlLmRpcmVjdGl2ZU5hbWUpIHJldHVybiB0aGlzLmxleGVyLmdldE5leHRUb2tlbigpLCBlOwogICAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLnBhcnNlRWxlbWVudEJlc2lkZXNEaXJlY3RpdmVFbmQoKTsKICAgICAgICAgICAgICAgIG4gJiYgZS5hcHBlbmRDaGlsZChuKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyB0aGlzLmNyZWF0ZUVycm9yUmVwb3J0KCJVbmNsb3NlZCBkaXJlY3RpdmUgIiArIGUuZGlyZWN0aXZlTmFtZSk7CiAgICAgICAgfSwKICAgICAgICBwYXJzZURpcmVjdGl2ZUJsb2NrVmVyYmF0aW06IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgZm9yKHZhciB0ID0gW107IHRoaXMubGV4ZXIuaGFzTmV4dCgpOyl7CiAgICAgICAgICAgICAgICB2YXIgcjMgPSB0aGlzLmxleGVyLnBlZWtOZXh0VG9rZW4oKTsKICAgICAgICAgICAgICAgIGlmIChyMy50eXBlID09PSBvLnRva2Vucy5kaXJlY3RpdmUgJiYgcjMuZW5kRGlyZWN0aXZlICYmIHRoaXMuY3JlYXRlRGlyZWN0aXZlTm9kZUZyb21Ub2tlbihyMykuZGlyZWN0aXZlTmFtZSA9PT0gZS5kaXJlY3RpdmVOYW1lKSByZXR1cm4gdGhpcy5sZXhlci5nZXROZXh0VG9rZW4oKSwgZS5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZVRleHROb2RlKHQuam9pbihgXG5gKSwgITApKSwgZTsKICAgICAgICAgICAgICAgIHQucHVzaCh0aGlzLmxleGVyLnN0cmVhbS5nZXROZXh0TGluZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyB0aGlzLmNyZWF0ZUVycm9yUmVwb3J0KCJVbmNsb3NlZCBkaXJlY3RpdmUgIiArIGUuZGlyZWN0aXZlTmFtZSk7CiAgICAgICAgfSwKICAgICAgICBwYXJzZURpcmVjdGl2ZUFyZ3VtZW50czogZnVuY3Rpb24oZSkgewogICAgICAgICAgICByZXR1cm4gZS5zcGxpdCgvWyBdKy8pLmZpbHRlcihmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdC5sZW5ndGggJiYgdFswXSAhPT0gIi0iOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHBhcnNlRGlyZWN0aXZlT3B0aW9uczogZnVuY3Rpb24oZSkgewogICAgICAgICAgICByZXR1cm4gZS5zcGxpdCgvWyBdKy8pLmZpbHRlcihmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdC5sZW5ndGggJiYgdFswXSA9PT0gIi0iOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGludGVycHJldERpcmVjdGl2ZTogZnVuY3Rpb24oZSkgewogICAgICAgICAgICBzd2l0Y2goZS5kaXJlY3RpdmVOYW1lKXsKICAgICAgICAgICAgICAgIGNhc2UgIm9wdGlvbnM6IjoKICAgICAgICAgICAgICAgICAgICB0aGlzLmludGVycHJldE9wdGlvbkRpcmVjdGl2ZShlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInRpdGxlOiI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb2N1bWVudC50aXRsZSA9IGUuZGlyZWN0aXZlUmF3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJhdXRob3I6IjoKICAgICAgICAgICAgICAgICAgICB0aGlzLmRvY3VtZW50LmF1dGhvciA9IGUuZGlyZWN0aXZlUmF3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJlbWFpbDoiOgogICAgICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQuZW1haWwgPSBlLmRpcmVjdGl2ZVJhd1ZhbHVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aGlzLmRvY3VtZW50LmRpcmVjdGl2ZVZhbHVlc1tlLmRpcmVjdGl2ZU5hbWVdID0gZS5kaXJlY3RpdmVSYXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaW50ZXJwcmV0T3B0aW9uRGlyZWN0aXZlOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGUuZGlyZWN0aXZlQXJndW1lbnRzLmZvckVhY2goZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgdmFyIHI0ID0gdC5zcGxpdCgiOiIpOwogICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zW3I0WzBdXSA9IHRoaXMuY29udmVydExpc3B5VmFsdWUocjRbMV0pOwogICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnRMaXNweVZhbHVlOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHN3aXRjaChlKXsKICAgICAgICAgICAgICAgIGNhc2UgInQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAhMDsKICAgICAgICAgICAgICAgIGNhc2UgIm5pbCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gL15bMC05XSskLy50ZXN0KGUpID8gcGFyc2VJbnQoZSkgOiBlOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBwYXJzZVBhcmFncmFwaDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5sZXhlci5wZWVrTmV4dFRva2VuKCksIHQgPSBjLmNyZWF0ZVBhcmFncmFwaChbXSk7CiAgICAgICAgICAgIHRoaXMuc2V0Tm9kZU9yaWdpbkZyb21Ub2tlbih0LCBlKTsKICAgICAgICAgICAgZm9yKHZhciByNCA9IFtdOyB0aGlzLmxleGVyLmhhc05leHQoKTspewogICAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLmxleGVyLnBlZWtOZXh0VG9rZW4oKTsKICAgICAgICAgICAgICAgIGlmIChuLnR5cGUgIT09IG8udG9rZW5zLmxpbmUgfHwgbi5pbmRlbnRhdGlvbiA8IGUuaW5kZW50YXRpb24pIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5sZXhlci5nZXROZXh0VG9rZW4oKSwgcjQucHVzaChuLmNvbnRlbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0LmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlVGV4dE5vZGUocjQuam9pbihgXG5gKSkpLCB0OwogICAgICAgIH0sCiAgICAgICAgcGFyc2VUZXh0OiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcy5sZXhlci5nZXROZXh0VG9rZW4oKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVGV4dE5vZGUodC5jb250ZW50LCBlKTsKICAgICAgICB9LAogICAgICAgIGNyZWF0ZVRleHROb2RlOiBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgIHJldHVybiB0ID8gYy5jcmVhdGVUZXh0KG51bGwsIHsKICAgICAgICAgICAgICAgIHZhbHVlOiBlCiAgICAgICAgICAgIH0pIDogdGhpcy5pbmxpbmVQYXJzZXIucGFyc2VFbXBoYXNpcyhlKTsKICAgICAgICB9CiAgICB9OwogICAgeDEucHJvdG90eXBlLm9yaWdpbmFsUGFyc2VFbGVtZW50ID0geDEucHJvdG90eXBlLnBhcnNlRWxlbWVudDsKICAgIGZ1bmN0aW9uIE8oKSB7CiAgICAgICAgdGhpcy5wcmVFbXBoYXNpcyA9IGAgCVxcKCciYCwgdGhpcy5wb3N0RW1waGFzaXMgPSBgLSAJLiw6IT87JyJcXClgLCB0aGlzLmJvcmRlckZvcmJpZGRlbiA9IGAgCVxyXG4sIidgLCB0aGlzLmJvZHlSZWdleHAgPSAiW1xcc1xcU10qPyIsIHRoaXMubWFya2VycyA9ICIqL189fisiLCB0aGlzLmVtcGhhc2lzUGF0dGVybiA9IHRoaXMuYnVpbGRFbXBoYXNpc1BhdHRlcm4oKSwgdGhpcy5saW5rUGF0dGVybiA9IC9cW1xbKFteXF1dKilcXSg/OlxbKFteXF1dKilcXSk/XF0vZzsKICAgIH0KICAgIE8ucHJvdG90eXBlID0gewogICAgICAgIHBhcnNlRW1waGFzaXM6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmVtcGhhc2lzUGF0dGVybjsKICAgICAgICAgICAgdC5sYXN0SW5kZXggPSAwOwogICAgICAgICAgICBmb3IodmFyIHI0ID0gW10sIG4sIGk0ID0gMCwgczsgbiA9IHQuZXhlYyhlKTspewogICAgICAgICAgICAgICAgdmFyIGEgPSBuWzBdLCBoID0gblsxXSwgZCA9IG5bMl0sIHYgPSBuWzNdLCBtID0gbls0XTsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB2YXIgayA9IHQubGFzdEluZGV4IC0gYS5sZW5ndGgsIHkxID0gZS5zdWJzdHJpbmcoaTQsIGsgKyBoLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgcyA9IHQubGFzdEluZGV4LCByNC5wdXNoKHRoaXMucGFyc2VMaW5rKHkxKSksIHQubGFzdEluZGV4ID0gczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBBID0gWwogICAgICAgICAgICAgICAgICAgIGMuY3JlYXRlVGV4dChudWxsLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIF0sIFYgPSB0aGlzLmVtcGhhc2l6ZUVsZW1lbnRCeU1hcmtlcihBLCBkKTsKICAgICAgICAgICAgICAgIHI0LnB1c2goViksIGk0ID0gdC5sYXN0SW5kZXggLSBtLmxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKHQubGFzdEluZGV4ID09PSAwIHx8IHQubGFzdEluZGV4ICE9PSBlLmxlbmd0aCAtIDEpICYmIHI0LnB1c2godGhpcy5wYXJzZUxpbmsoZS5zdWJzdHJpbmcoaTQpKSksIHI0Lmxlbmd0aCA9PT0gMSA/IHI0WzBdIDogYy5jcmVhdGVJbmxpbmVDb250YWluZXIocjQpOwogICAgICAgIH0sCiAgICAgICAgZGVwdGg6IDAsCiAgICAgICAgcGFyc2VMaW5rOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciB0ID0gdGhpcy5saW5rUGF0dGVybjsKICAgICAgICAgICAgdC5sYXN0SW5kZXggPSAwOwogICAgICAgICAgICBmb3IodmFyIHI0LCBuID0gW10sIGk0ID0gMCwgczsgcjQgPSB0LmV4ZWMoZSk7KXsKICAgICAgICAgICAgICAgIHZhciBhID0gcjRbMF0sIGggPSByNFsxXSwgZCA9IHI0WzJdLCB2ID0gdC5sYXN0SW5kZXggLSBhLmxlbmd0aCwgbSA9IGUuc3Vic3RyaW5nKGk0LCB2KTsKICAgICAgICAgICAgICAgIG4ucHVzaChjLmNyZWF0ZVRleHQobnVsbCwgewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBtCiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB2YXIgayA9IGMuY3JlYXRlTGluayhbXSk7CiAgICAgICAgICAgICAgICBrLnNyYyA9IGgsIGQgPyAocyA9IHQubGFzdEluZGV4LCBrLmFwcGVuZENoaWxkKHRoaXMucGFyc2VFbXBoYXNpcyhkKSksIHQubGFzdEluZGV4ID0gcykgOiBrLmFwcGVuZENoaWxkKGMuY3JlYXRlVGV4dChudWxsLCB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGgKICAgICAgICAgICAgICAgIH0pKSwgbi5wdXNoKGspLCBpNCA9IHQubGFzdEluZGV4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAodC5sYXN0SW5kZXggPT09IDAgfHwgdC5sYXN0SW5kZXggIT09IGUubGVuZ3RoIC0gMSkgJiYgbi5wdXNoKGMuY3JlYXRlVGV4dChudWxsLCB7CiAgICAgICAgICAgICAgICB2YWx1ZTogZS5zdWJzdHJpbmcoaTQpCiAgICAgICAgICAgIH0pKSwgYy5jcmVhdGVJbmxpbmVDb250YWluZXIobik7CiAgICAgICAgfSwKICAgICAgICBlbXBoYXNpemVFbGVtZW50QnlNYXJrZXI6IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgc3dpdGNoKHQpewogICAgICAgICAgICAgICAgY2FzZSAiKiI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMuY3JlYXRlQm9sZChlKTsKICAgICAgICAgICAgICAgIGNhc2UgIi8iOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBjLmNyZWF0ZUl0YWxpYyhlKTsKICAgICAgICAgICAgICAgIGNhc2UgIl8iOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBjLmNyZWF0ZVVuZGVybGluZShlKTsKICAgICAgICAgICAgICAgIGNhc2UgIj0iOgogICAgICAgICAgICAgICAgY2FzZSAifiI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMuY3JlYXRlQ29kZShlKTsKICAgICAgICAgICAgICAgIGNhc2UgIisiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBjLmNyZWF0ZURhc2hlZChlKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYnVpbGRFbXBoYXNpc1BhdHRlcm46IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cCgiKFsiICsgdGhpcy5wcmVFbXBoYXNpcyArIGBdfF58XHI/XG4pKFtgICsgdGhpcy5tYXJrZXJzICsgIl0pKFteIiArIHRoaXMuYm9yZGVyRm9yYmlkZGVuICsgIl18W14iICsgdGhpcy5ib3JkZXJGb3JiaWRkZW4gKyAiXSIgKyB0aGlzLmJvZHlSZWdleHAgKyAiW14iICsgdGhpcy5ib3JkZXJGb3JiaWRkZW4gKyAiXSlcXDIoWyIgKyB0aGlzLnBvc3RFbXBoYXNpcyArIGBdfCR8XHI/XG4pYCwgImciKTsKICAgICAgICB9CiAgICB9OwogICAgdHlwZW9mIE4gIT0gInVuZGVmaW5lZCIgJiYgKE4uUGFyc2VyID0geDEsIE4uSW5saW5lUGFyc2VyID0gTyk7Cn0pOwp2YXIgVSA9IGcoKEkpPT57CiAgICB2YXIgbCA9IGIoKS5Ob2RlOwogICAgZnVuY3Rpb24gTSgpIHsKICAgIH0KICAgIE0ucHJvdG90eXBlID0gewogICAgICAgIGV4cG9ydE9wdGlvbnM6IHsKICAgICAgICAgICAgaGVhZGVyT2Zmc2V0OiAxLAogICAgICAgICAgICBleHBvcnRGcm9tTGluZU51bWJlcjogITEsCiAgICAgICAgICAgIHN1cHByZXNzU3ViU2NyaXB0SGFuZGxpbmc6ICExLAogICAgICAgICAgICBzdXBwcmVzc0F1dG9MaW5rOiAhMSwKICAgICAgICAgICAgdHJhbnNsYXRlU3ltYm9sQXJyb3c6ICExLAogICAgICAgICAgICBzdXBwcmVzc0NoZWNrYm94SGFuZGxpbmc6ICExLAogICAgICAgICAgICBjdXN0b21EaXJlY3RpdmVIYW5kbGVyOiBudWxsLAogICAgICAgICAgICBodG1sQ2xhc3NQcmVmaXg6IG51bGwsCiAgICAgICAgICAgIGh0bWxJZFByZWZpeDogbnVsbAogICAgICAgIH0sCiAgICAgICAgdW50aXRsZWQ6ICJVbnRpdGxlZCIsCiAgICAgICAgcmVzdWx0OiBudWxsLAogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgdGhpcy5vcmdEb2N1bWVudCA9IGUsIHRoaXMuZG9jdW1lbnRPcHRpb25zID0gZS5vcHRpb25zIHx8IHsKICAgICAgICAgICAgfSwgdGhpcy5leHBvcnRPcHRpb25zID0gdCB8fCB7CiAgICAgICAgICAgIH0sIHRoaXMuaGVhZGVycyA9IFtdLCB0aGlzLmhlYWRlck9mZnNldCA9IHR5cGVvZiB0aGlzLmV4cG9ydE9wdGlvbnMuaGVhZGVyT2Zmc2V0ID09ICJudW1iZXIiID8gdGhpcy5leHBvcnRPcHRpb25zLmhlYWRlck9mZnNldCA6IDEsIHRoaXMuc2VjdGlvbk51bWJlcnMgPSBbCiAgICAgICAgICAgICAgICAwCiAgICAgICAgICAgIF07CiAgICAgICAgfSwKICAgICAgICBjcmVhdGVUb2NJdGVtOiBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgIHZhciByNCA9IFtdOwogICAgICAgICAgICByNC5wYXJlbnQgPSB0OwogICAgICAgICAgICB2YXIgbiA9IHsKICAgICAgICAgICAgICAgIGhlYWRlck5vZGU6IGUsCiAgICAgICAgICAgICAgICBjaGlsZFRvY3M6IHI0CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBuOwogICAgICAgIH0sCiAgICAgICAgY29tcHV0ZVRvYzogZnVuY3Rpb24oZSkgewogICAgICAgICAgICB0eXBlb2YgZSAhPSAibnVtYmVyIiAmJiAoZSA9IEluZmluaXR5KTsKICAgICAgICAgICAgdmFyIHQgPSBbXTsKICAgICAgICAgICAgdC5wYXJlbnQgPSBudWxsOwogICAgICAgICAgICBmb3IodmFyIHI0ID0gMSwgbiA9IHQsIGk0ID0gMDsgaTQgPCB0aGlzLmhlYWRlcnMubGVuZ3RoOyArK2k0KXsKICAgICAgICAgICAgICAgIHZhciBzID0gdGhpcy5oZWFkZXJzW2k0XTsKICAgICAgICAgICAgICAgIGlmICghKHMubGV2ZWwgPiBlKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBhID0gcy5sZXZlbCAtIHI0OwogICAgICAgICAgICAgICAgICAgIGlmIChhID4gMCkgZm9yKHZhciBoID0gMDsgaCA8IGE7ICsraCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBsLmNyZWF0ZUhlYWRlcihbXSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsOiByNCArIGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5zZWN0aW9uTnVtYmVyVGV4dCA9ICIiLCBuLnB1c2godGhpcy5jcmVhdGVUb2NJdGVtKGQsIG4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBuID0gbltuLmxlbmd0aCAtIDFdLmNoaWxkVG9jczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYSA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYSA9IC1hOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIHYgPSAwOyB2IDwgYTsgKyt2KW4gPSBuLnBhcmVudDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbi5wdXNoKHRoaXMuY3JlYXRlVG9jSXRlbShzLCBuKSksIHI0ID0gcy5sZXZlbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnROb2RlOiBmdW5jdGlvbihlLCB0LCByNCkgewogICAgICAgICAgICByNCB8fCAoZS50eXBlID09PSBsLnR5cGVzLmRpcmVjdGl2ZSA/IChlLmRpcmVjdGl2ZU5hbWUgPT09ICJleGFtcGxlIiB8fCBlLmRpcmVjdGl2ZU5hbWUgPT09ICJzcmMiKSAmJiAocjQgPSAhMCkgOiBlLnR5cGUgPT09IGwudHlwZXMucHJlZm9ybWF0dGVkICYmIChyNCA9ICEwKSksIHR5cGVvZiBlID09ICJzdHJpbmciICYmIChlID0gbC5jcmVhdGVUZXh0KG51bGwsIHsKICAgICAgICAgICAgICAgIHZhbHVlOiBlCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgdmFyIG4gPSBlLmNoaWxkcmVuID8gdGhpcy5jb252ZXJ0Tm9kZXNJbnRlcm5hbChlLmNoaWxkcmVuLCB0LCByNCkgOiAiIiwgaTQsIHMgPSB0aGlzLmNvbXB1dGVBdXhEYXRhRm9yTm9kZShlKTsKICAgICAgICAgICAgc3dpdGNoKGUudHlwZSl7CiAgICAgICAgICAgICAgICBjYXNlIGwudHlwZXMuaGVhZGVyOgogICAgICAgICAgICAgICAgICAgIHZhciBhID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBuLmluZGV4T2YoIlRPRE8gIikgPT09IDAgPyBhID0gInRvZG8iIDogbi5pbmRleE9mKCJET05FICIpID09PSAwICYmIChhID0gImRvbmUiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaWYgKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBlLmxldmVsLCB2ID0gdGhpcy5zZWN0aW9uTnVtYmVycy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID4gdikgZm9yKHZhciBtID0gZCAtIHYsIGsgPSAwOyBrIDwgbTsgKytrKXRoaXMuc2VjdGlvbk51bWJlcnNbZCAtIDEgLSBrXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgZCA8IHYgJiYgKHRoaXMuc2VjdGlvbk51bWJlcnMubGVuZ3RoID0gZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VjdGlvbk51bWJlcnNbZCAtIDFdKyssIGggPSB0aGlzLnNlY3Rpb25OdW1iZXJzLmpvaW4oIi4iKSwgZS5zZWN0aW9uTnVtYmVyVGV4dCA9IGg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGk0ID0gdGhpcy5jb252ZXJ0SGVhZGVyKGUsIG4sIHMsIGEsIGgpLCB0ICYmIHRoaXMuaGVhZGVycy5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBsLnR5cGVzLm9yZGVyZWRMaXN0OgogICAgICAgICAgICAgICAgICAgIGk0ID0gdGhpcy5jb252ZXJ0T3JkZXJlZExpc3QoZSwgbiwgcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGwudHlwZXMudW5vcmRlcmVkTGlzdDoKICAgICAgICAgICAgICAgICAgICBpNCA9IHRoaXMuY29udmVydFVub3JkZXJlZExpc3QoZSwgbiwgcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGwudHlwZXMuZGVmaW5pdGlvbkxpc3Q6CiAgICAgICAgICAgICAgICAgICAgaTQgPSB0aGlzLmNvbnZlcnREZWZpbml0aW9uTGlzdChlLCBuLCBzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgbC50eXBlcy5saXN0RWxlbWVudDoKICAgICAgICAgICAgICAgICAgICBpZiAoZS5pc0RlZmluaXRpb25MaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5MiA9IHRoaXMuY29udmVydE5vZGVzSW50ZXJuYWwoZS50ZXJtLCB0LCByNCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGk0ID0gdGhpcy5jb252ZXJ0RGVmaW5pdGlvbkl0ZW0oZSwgbiwgcywgeTIsIG4pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpNCA9IHRoaXMuY29udmVydExpc3RJdGVtKGUsIG4sIHMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBsLnR5cGVzLnBhcmFncmFwaDoKICAgICAgICAgICAgICAgICAgICBpNCA9IHRoaXMuY29udmVydFBhcmFncmFwaChlLCBuLCBzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgbC50eXBlcy5wcmVmb3JtYXR0ZWQ6CiAgICAgICAgICAgICAgICAgICAgaTQgPSB0aGlzLmNvbnZlcnRQcmVmb3JtYXR0ZWQoZSwgbiwgcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGwudHlwZXMudGFibGU6CiAgICAgICAgICAgICAgICAgICAgaTQgPSB0aGlzLmNvbnZlcnRUYWJsZShlLCBuLCBzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgbC50eXBlcy50YWJsZVJvdzoKICAgICAgICAgICAgICAgICAgICBpNCA9IHRoaXMuY29udmVydFRhYmxlUm93KGUsIG4sIHMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBsLnR5cGVzLnRhYmxlQ2VsbDoKICAgICAgICAgICAgICAgICAgICBlLmlzSGVhZGVyID8gaTQgPSB0aGlzLmNvbnZlcnRUYWJsZUhlYWRlcihlLCBuLCBzKSA6IGk0ID0gdGhpcy5jb252ZXJ0VGFibGVDZWxsKGUsIG4sIHMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBsLnR5cGVzLmhvcml6b250YWxSdWxlOgogICAgICAgICAgICAgICAgICAgIGk0ID0gdGhpcy5jb252ZXJ0SG9yaXpvbnRhbFJ1bGUoZSwgbiwgcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGwudHlwZXMuaW5saW5lQ29udGFpbmVyOgogICAgICAgICAgICAgICAgICAgIGk0ID0gdGhpcy5jb252ZXJ0SW5saW5lQ29udGFpbmVyKGUsIG4sIHMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBsLnR5cGVzLmJvbGQ6CiAgICAgICAgICAgICAgICAgICAgaTQgPSB0aGlzLmNvbnZlcnRCb2xkKGUsIG4sIHMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBsLnR5cGVzLml0YWxpYzoKICAgICAgICAgICAgICAgICAgICBpNCA9IHRoaXMuY29udmVydEl0YWxpYyhlLCBuLCBzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgbC50eXBlcy51bmRlcmxpbmU6CiAgICAgICAgICAgICAgICAgICAgaTQgPSB0aGlzLmNvbnZlcnRVbmRlcmxpbmUoZSwgbiwgcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGwudHlwZXMuY29kZToKICAgICAgICAgICAgICAgICAgICBpNCA9IHRoaXMuY29udmVydENvZGUoZSwgbiwgcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGwudHlwZXMuZGFzaGVkOgogICAgICAgICAgICAgICAgICAgIGk0ID0gdGhpcy5jb252ZXJ0RGFzaGVkKGUsIG4sIHMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBsLnR5cGVzLmxpbms6CiAgICAgICAgICAgICAgICAgICAgaTQgPSB0aGlzLmNvbnZlcnRMaW5rKGUsIG4sIHMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBsLnR5cGVzLmRpcmVjdGl2ZToKICAgICAgICAgICAgICAgICAgICBzd2l0Y2goZS5kaXJlY3RpdmVOYW1lKXsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicXVvdGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaTQgPSB0aGlzLmNvbnZlcnRRdW90ZShlLCBuLCBzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJleGFtcGxlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGk0ID0gdGhpcy5jb252ZXJ0RXhhbXBsZShlLCBuLCBzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzcmMiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaTQgPSB0aGlzLmNvbnZlcnRTcmMoZSwgbiwgcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHRtbCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImh0bWw6IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGk0ID0gdGhpcy5jb252ZXJ0SFRNTChlLCBuLCBzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBvcnRPcHRpb25zLmN1c3RvbURpcmVjdGl2ZUhhbmRsZXIgJiYgdGhpcy5leHBvcnRPcHRpb25zLmN1c3RvbURpcmVjdGl2ZUhhbmRsZXJbZS5kaXJlY3RpdmVOYW1lXSA/IGk0ID0gdGhpcy5leHBvcnRPcHRpb25zLmN1c3RvbURpcmVjdGl2ZUhhbmRsZXJbZS5kaXJlY3RpdmVOYW1lXShlLCBuLCBzKSA6IGk0ID0gbjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGwudHlwZXMudGV4dDoKICAgICAgICAgICAgICAgICAgICBpNCA9IHRoaXMuY29udmVydFRleHQoZS52YWx1ZSwgcjQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcigiVW5rbm93biBub2RlIHR5cGU6ICIgKyBlLnR5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdGhpcy5wb3N0UHJvY2VzcyA9PSAiZnVuY3Rpb24iICYmIChpNCA9IHRoaXMucG9zdFByb2Nlc3MoZSwgaTQsIHI0KSksIGk0OwogICAgICAgIH0sCiAgICAgICAgY29udmVydFRleHQ6IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHI0ID0gdGhpcy5lc2NhcGVTcGVjaWFsQ2hhcnMoZSwgdCk7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5leHBvcnRPcHRpb25zLnN1cHByZXNzU3ViU2NyaXB0SGFuZGxpbmcgJiYgIXQgJiYgKHI0ID0gdGhpcy5tYWtlU3Vic2NyaXB0cyhyNCwgdCkpLCB0aGlzLmV4cG9ydE9wdGlvbnMuc3VwcHJlc3NBdXRvTGluayB8fCAocjQgPSB0aGlzLmxpbmtVUkwocjQpKSwgcjQ7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0SFRNTDogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0Tm9kZXNJbnRlcm5hbDogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgZm9yKHZhciBuID0gW10sIGk0ID0gMDsgaTQgPCBlLmxlbmd0aDsgKytpNCl7CiAgICAgICAgICAgICAgICB2YXIgcyA9IGVbaTRdLCBhID0gdGhpcy5jb252ZXJ0Tm9kZShzLCB0LCByNCk7CiAgICAgICAgICAgICAgICBuLnB1c2goYSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tYmluZU5vZGVzVGV4dHMobik7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0SGVhZGVyQmxvY2s6IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoImNvbnZlcnRIZWFkZXJCbG9jayBpcyBub3QgaW1wbGVtZW50ZWQiKTsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnRIZWFkZXJUcmVlOiBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRIZWFkZXJCbG9jayhlLCB0KTsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnROb2Rlc1RvSGVhZGVyVHJlZTogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgdmFyIG4gPSBbXSwgaTQgPSBbXTsKICAgICAgICAgICAgdHlwZW9mIHQgPT0gInVuZGVmaW5lZCIgJiYgKHQgPSAwKSwgdHlwZW9mIHI0ID09ICJ1bmRlZmluZWQiICYmIChyNCA9IG51bGwpOwogICAgICAgICAgICBmb3IodmFyIHMgPSB0OyBzIDwgZS5sZW5ndGg7KXsKICAgICAgICAgICAgICAgIHZhciBhID0gZVtzXSwgaCA9IGEudHlwZSA9PT0gbC50eXBlcy5oZWFkZXI7CiAgICAgICAgICAgICAgICBpZiAoIWgpIHsKICAgICAgICAgICAgICAgICAgICBpNC5wdXNoKGEpLCBzID0gcyArIDE7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocjQgJiYgYS5sZXZlbCA8PSByNC5sZXZlbCkgYnJlYWs7CiAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuY29udmVydE5vZGVzVG9IZWFkZXJUcmVlKGUsIHMgKyAxLCBhKTsKICAgICAgICAgICAgICAgIG4ucHVzaChkKSwgcyA9IGQubmV4dEluZGV4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBoZWFkZXI6IHI0LAogICAgICAgICAgICAgICAgY2hpbGROb2RlczogaTQsCiAgICAgICAgICAgICAgICBuZXh0SW5kZXg6IHMsCiAgICAgICAgICAgICAgICBjaGlsZEJsb2NrczogbgogICAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgY29udmVydE5vZGVzOiBmdW5jdGlvbihlLCB0LCByNCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0Tm9kZXNJbnRlcm5hbChlLCB0LCByNCk7CiAgICAgICAgfSwKICAgICAgICBjb21iaW5lTm9kZXNUZXh0czogZnVuY3Rpb24oZSkgewogICAgICAgICAgICByZXR1cm4gZS5qb2luKCIiKTsKICAgICAgICB9LAogICAgICAgIGdldE5vZGVUZXh0Q29udGVudDogZnVuY3Rpb24oZSkgewogICAgICAgICAgICByZXR1cm4gZS50eXBlID09PSBsLnR5cGVzLnRleHQgPyB0aGlzLmVzY2FwZVNwZWNpYWxDaGFycyhlLnZhbHVlKSA6IGUuY2hpbGRyZW4gPyBlLmNoaWxkcmVuLm1hcCh0aGlzLmdldE5vZGVUZXh0Q29udGVudCwgdGhpcykuam9pbigiIikgOiAiIjsKICAgICAgICB9LAogICAgICAgIGVzY2FwZVNwZWNpYWxDaGFyczogZnVuY3Rpb24oZSkgewogICAgICAgICAgICB0aHJvdyBFcnJvcigiSW1wbGVtZW50IGVzY2FwZVNwZWNpYWxDaGFycyIpOwogICAgICAgIH0sCiAgICAgICAgdXJsUGF0dGVybjogL1xiKD86aHR0cHM/OlwvXC98d3d3XGR7MCwzfVsuXXxbYS16MC05LlwtXStbLl1bYS16XXsyLDR9XC8pKD86W15ccygpPD5dK3xcKChbXlxzKCk8Pl0rfChcKFteXHMoKTw+XStcKSkpKlwpKSsoPzpcKChbXlxzKCk8Pl0rfChcKFteXHMoKTw+XStcKSkpKlwpfFteXHNgISgpXFtcXXt9OzonIi4sPD4/wqvCu+KAnOKAneKAmOKAmV0pL2lnLAogICAgICAgIGxpbmtVUkw6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gZS5yZXBsYWNlKHRoaXMudXJsUGF0dGVybiwgZnVuY3Rpb24ocjQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAocjQuaW5kZXhPZigiOi8vIikgPCAwICYmIChyNCA9ICJodHRwOi8vIiArIHI0KSwgdC5tYWtlTGluayhyNCkpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG1ha2VMaW5rOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHRocm93IEVycm9yKCJJbXBsZW1lbnQgbWFrZUxpbmsiKTsKICAgICAgICB9LAogICAgICAgIG1ha2VTdWJzY3JpcHRzOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50T3B0aW9uc1siXiJdID09PSAie30iID8gZS5yZXBsYWNlKC9cYihbXl8gXHRdKilfeyhbXn1dKil9L2csIHRoaXMubWFrZVN1YnNjcmlwdCkgOiB0aGlzLmRvY3VtZW50T3B0aW9uc1siXiJdID8gZS5yZXBsYWNlKC9cYihbXl8gXHRdKilfKFteX10qKVxiL2csIHRoaXMubWFrZVN1YnNjcmlwdCkgOiBlOwogICAgICAgIH0sCiAgICAgICAgbWFrZVN1YnNjcmlwdDogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoIkltcGxlbWVudCBtYWtlU3Vic2NyaXB0Iik7CiAgICAgICAgfSwKICAgICAgICBzdHJpcFBhcmFtZXRlcnNGcm9tVVJMOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHJldHVybiBlLnJlcGxhY2UoL1w/LiokLywgIiIpOwogICAgICAgIH0sCiAgICAgICAgaW1hZ2VFeHRlbnNpb25QYXR0ZXJuOiBuZXcgUmVnRXhwKCIoIiArIFsKICAgICAgICAgICAgImJtcCIsCiAgICAgICAgICAgICJwbmciLAogICAgICAgICAgICAianBlZyIsCiAgICAgICAgICAgICJqcGciLAogICAgICAgICAgICAiZ2lmIiwKICAgICAgICAgICAgInRpZmYiLAogICAgICAgICAgICAidGlmIiwKICAgICAgICAgICAgInhibSIsCiAgICAgICAgICAgICJ4cG0iLAogICAgICAgICAgICAicGJtIiwKICAgICAgICAgICAgInBnbSIsCiAgICAgICAgICAgICJwcG0iLAogICAgICAgICAgICAic3ZnIgogICAgICAgIF0uam9pbigifCIpICsgIikkIiwgImkiKQogICAgfTsKICAgIHR5cGVvZiBJICE9ICJ1bmRlZmluZWQiICYmIChJLkNvbnZlcnRlciA9IE0pOwp9KTsKdmFyIF8gPSBnKCgkKT0+ewogICAgdmFyIGVlID0gVSgpLkNvbnZlcnRlciwgeiA9IGIoKS5Ob2RlOwogICAgZnVuY3Rpb24gcShlLCB0KSB7CiAgICAgICAgdGhpcy5pbml0aWFsaXplKGUsIHQpLCB0aGlzLnJlc3VsdCA9IHRoaXMuY29udmVydCgpOwogICAgfQogICAgcS5wcm90b3R5cGUgPSB7CiAgICAgICAgX19wcm90b19fOiBlZS5wcm90b3R5cGUsCiAgICAgICAgY29udmVydDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5vcmdEb2N1bWVudC50aXRsZSA/IHRoaXMuY29udmVydE5vZGUodGhpcy5vcmdEb2N1bWVudC50aXRsZSkgOiB0aGlzLnVudGl0bGVkLCB0ID0gdGhpcy50YWcoImgiICsgTWF0aC5tYXgoTnVtYmVyKHRoaXMuaGVhZGVyT2Zmc2V0KSwgMSksIGUpLCByNCA9IHRoaXMuY29udmVydE5vZGVzKHRoaXMub3JnRG9jdW1lbnQubm9kZXMsICEwKSwgbiA9IHRoaXMuY29tcHV0ZVRvYyh0aGlzLmRvY3VtZW50T3B0aW9ucy50b2MpLCBpNCA9IHRoaXMudG9jVG9IVE1MKG4pOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdGl0bGU6IGUsCiAgICAgICAgICAgICAgICB0aXRsZUhUTUw6IHQsCiAgICAgICAgICAgICAgICBjb250ZW50SFRNTDogcjQsCiAgICAgICAgICAgICAgICB0b2NIVE1MOiBpNCwKICAgICAgICAgICAgICAgIHRvYzogbiwKICAgICAgICAgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdCArIGk0ICsgYFxuYCArIHI0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgdG9jVG9IVE1MOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIHQocjQpIHsKICAgICAgICAgICAgICAgIGZvcih2YXIgbiA9ICIiLCBpNCA9IDA7IGk0IDwgcjQubGVuZ3RoOyArK2k0KXsKICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IHI0W2k0XSwgYSA9IHMuaGVhZGVyTm9kZS5zZWN0aW9uTnVtYmVyVGV4dCwgaCA9IHRoaXMuZG9jdW1lbnRPcHRpb25zLm51bSA/IHRoaXMuaW5saW5lVGFnKCJzcGFuIiwgYSwgewogICAgICAgICAgICAgICAgICAgICAgICBjbGFzczogInNlY3Rpb24tbnVtYmVyIgogICAgICAgICAgICAgICAgICAgIH0pIDogIiIsIGQgPSB0aGlzLmdldE5vZGVUZXh0Q29udGVudChzLmhlYWRlck5vZGUpLCB2ID0gdGhpcy5pbmxpbmVUYWcoImEiLCBoICsgZCwgewogICAgICAgICAgICAgICAgICAgICAgICBocmVmOiAiI2hlYWRlci0iICsgYS5yZXBsYWNlKC9cLi9nLCAiLSIpCiAgICAgICAgICAgICAgICAgICAgfSksIG0gPSBzLmNoaWxkVG9jcy5sZW5ndGggPyB0LmNhbGwodGhpcywgcy5jaGlsZFRvY3MpIDogIiI7CiAgICAgICAgICAgICAgICAgICAgbiArPSB0aGlzLnRhZygibGkiLCB2ICsgbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50YWcoInVsIiwgbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHQuY2FsbCh0aGlzLCBlKTsKICAgICAgICB9LAogICAgICAgIGNvbXB1dGVBdXhEYXRhRm9yTm9kZTogZnVuY3Rpb24oZSkgewogICAgICAgICAgICBmb3IoOyBlLnBhcmVudCAmJiBlLnBhcmVudC50eXBlID09PSB6LnR5cGVzLmlubGluZUNvbnRhaW5lcjspZSA9IGUucGFyZW50OwogICAgICAgICAgICBmb3IodmFyIHQgPSBlLnByZXZpb3VzU2libGluZywgcjQgPSAiIjsgdCAmJiB0LnR5cGUgPT09IHoudHlwZXMuZGlyZWN0aXZlICYmIHQuZGlyZWN0aXZlTmFtZSA9PT0gImF0dHJfaHRtbDoiOylyNCArPSB0LmRpcmVjdGl2ZVJhd1ZhbHVlICsgIiAiLCB0ID0gdC5wcmV2aW91c1NpYmxpbmc7CiAgICAgICAgICAgIHJldHVybiByNDsKICAgICAgICB9LAogICAgICAgIG9yZ0NsYXNzTmFtZTogZnVuY3Rpb24oZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5leHBvcnRPcHRpb25zLmh0bWxDbGFzc1ByZWZpeCA/IHRoaXMuZXhwb3J0T3B0aW9ucy5odG1sQ2xhc3NQcmVmaXggKyBlIDogZTsKICAgICAgICB9LAogICAgICAgIG9yZ0lkOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cG9ydE9wdGlvbnMuaHRtbElkUHJlZml4ID8gdGhpcy5leHBvcnRPcHRpb25zLmh0bWxJZFByZWZpeCArIGUgOiBlOwogICAgICAgIH0sCiAgICAgICAgY29udmVydEhlYWRlcjogZnVuY3Rpb24oZSwgdCwgcjQsIG4sIGk0KSB7CiAgICAgICAgICAgIHZhciBzID0gewogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gbiAmJiAodCA9IHRoaXMuaW5saW5lVGFnKCJzcGFuIiwgdC5zdWJzdHJpbmcoMCwgNCksIHsKICAgICAgICAgICAgICAgIGNsYXNzOiAidGFzay1zdGF0dXMgIiArIG4KICAgICAgICAgICAgfSkgKyB0LnN1YnN0cmluZyg1KSksIGk0ICYmICh0ID0gdGhpcy5pbmxpbmVUYWcoInNwYW4iLCBpNCwgewogICAgICAgICAgICAgICAgY2xhc3M6ICJzZWN0aW9uLW51bWJlciIKICAgICAgICAgICAgfSkgKyB0LCBzLmlkID0gImhlYWRlci0iICsgaTQucmVwbGFjZSgvXC4vZywgIi0iKSksIG4gJiYgKHMuY2xhc3MgPSAidGFzay1zdGF0dXMgIiArIG4pLCB0aGlzLnRhZygiaCIgKyAodGhpcy5oZWFkZXJPZmZzZXQgKyBlLmxldmVsKSwgdCwgcywgcjQpOwogICAgICAgIH0sCiAgICAgICAgY29udmVydE9yZGVyZWRMaXN0OiBmdW5jdGlvbihlLCB0LCByNCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50YWcoIm9sIiwgdCwgbnVsbCwgcjQpOwogICAgICAgIH0sCiAgICAgICAgY29udmVydFVub3JkZXJlZExpc3Q6IGZ1bmN0aW9uKGUsIHQsIHI0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhZygidWwiLCB0LCBudWxsLCByNCk7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0RGVmaW5pdGlvbkxpc3Q6IGZ1bmN0aW9uKGUsIHQsIHI0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhZygiZGwiLCB0LCBudWxsLCByNCk7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0RGVmaW5pdGlvbkl0ZW06IGZ1bmN0aW9uKGUsIHQsIHI0LCBuLCBpNCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50YWcoImR0IiwgbikgKyB0aGlzLnRhZygiZGQiLCBpNCk7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0TGlzdEl0ZW06IGZ1bmN0aW9uKGUsIHQsIHI0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmV4cG9ydE9wdGlvbnMuc3VwcHJlc3NDaGVja2JveEhhbmRsaW5nKSByZXR1cm4gdGhpcy50YWcoImxpIiwgdCwgbnVsbCwgcjQpOwogICAgICAgICAgICB2YXIgbiA9IHsKICAgICAgICAgICAgfSwgaTQgPSB0OwogICAgICAgICAgICBpZiAoL15ccypcWyhYfCB8LSlcXShbXHNcU10qKS8uZXhlYyhpNCkpIHsKICAgICAgICAgICAgICAgIGk0ID0gUmVnRXhwLiQyOwogICAgICAgICAgICAgICAgdmFyIHMgPSBSZWdFeHAuJDEsIGEgPSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogImNoZWNrYm94IgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHN3aXRjaChzKXsKICAgICAgICAgICAgICAgICAgICBjYXNlICJYIjoKICAgICAgICAgICAgICAgICAgICAgICAgYS5jaGVja2VkID0gInRydWUiLCBuWyJkYXRhLWNoZWNrYm94LXN0YXR1cyJdID0gImRvbmUiOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICItIjoKICAgICAgICAgICAgICAgICAgICAgICAgblsiZGF0YS1jaGVja2JveC1zdGF0dXMiXSA9ICJpbnRlcm1lZGlhdGUiOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBuWyJkYXRhLWNoZWNrYm94LXN0YXR1cyJdID0gInVuZG9uZSI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaTQgPSB0aGlzLmlubGluZVRhZygiaW5wdXQiLCBudWxsLCBhKSArIGk0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhZygibGkiLCBpNCwgbiwgcjQpOwogICAgICAgIH0sCiAgICAgICAgY29udmVydFBhcmFncmFwaDogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFnKCJwIiwgdCwgbnVsbCwgcjQpOwogICAgICAgIH0sCiAgICAgICAgY29udmVydFByZWZvcm1hdHRlZDogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFnKCJwcmUiLCB0LCBudWxsLCByNCk7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0VGFibGU6IGZ1bmN0aW9uKGUsIHQsIHI0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhZygidGFibGUiLCB0aGlzLnRhZygidGJvZHkiLCB0KSwgbnVsbCwgcjQpOwogICAgICAgIH0sCiAgICAgICAgY29udmVydFRhYmxlUm93OiBmdW5jdGlvbihlLCB0LCByNCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50YWcoInRyIiwgdCk7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0VGFibGVIZWFkZXI6IGZ1bmN0aW9uKGUsIHQsIHI0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhZygidGgiLCB0KTsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnRUYWJsZUNlbGw6IGZ1bmN0aW9uKGUsIHQsIHI0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhZygidGQiLCB0KTsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnRIb3Jpem9udGFsUnVsZTogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFnKCJociIsIG51bGwsIG51bGwsIHI0KTsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnRJbmxpbmVDb250YWluZXI6IGZ1bmN0aW9uKGUsIHQsIHI0KSB7CiAgICAgICAgICAgIHJldHVybiB0OwogICAgICAgIH0sCiAgICAgICAgY29udmVydEJvbGQ6IGZ1bmN0aW9uKGUsIHQsIHI0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlubGluZVRhZygiYiIsIHQpOwogICAgICAgIH0sCiAgICAgICAgY29udmVydEl0YWxpYzogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5saW5lVGFnKCJpIiwgdCk7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0VW5kZXJsaW5lOiBmdW5jdGlvbihlLCB0LCByNCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5pbmxpbmVUYWcoInNwYW4iLCB0LCB7CiAgICAgICAgICAgICAgICBzdHlsZTogInRleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmU7IgogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnRDb2RlOiBmdW5jdGlvbihlLCB0LCByNCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5pbmxpbmVUYWcoImNvZGUiLCB0KTsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnREYXNoZWQ6IGZ1bmN0aW9uKGUsIHQsIHI0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlubGluZVRhZygiZGVsIiwgdCk7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0TGluazogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgdmFyIG4gPSB0aGlzLnN0cmlwUGFyYW1ldGVyc0Zyb21VUkwoZS5zcmMpOwogICAgICAgICAgICBpZiAodGhpcy5pbWFnZUV4dGVuc2lvblBhdHRlcm4uZXhlYyhuKSkgewogICAgICAgICAgICAgICAgdmFyIGk0ID0gdGhpcy5nZXROb2RlVGV4dENvbnRlbnQoZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbmxpbmVUYWcoImltZyIsIG51bGwsIHsKICAgICAgICAgICAgICAgICAgICBzcmM6IGUuc3JjLAogICAgICAgICAgICAgICAgICAgIGFsdDogaTQsCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGk0CiAgICAgICAgICAgICAgICB9LCByNCk7CiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gdGhpcy5pbmxpbmVUYWcoImEiLCB0LCB7CiAgICAgICAgICAgICAgICBocmVmOiBlLnNyYwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnRRdW90ZTogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFnKCJibG9ja3F1b3RlIiwgdCwgbnVsbCwgcjQpOwogICAgICAgIH0sCiAgICAgICAgY29udmVydEV4YW1wbGU6IGZ1bmN0aW9uKGUsIHQsIHI0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhZygicHJlIiwgdCwgbnVsbCwgcjQpOwogICAgICAgIH0sCiAgICAgICAgY29udmVydFNyYzogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgdmFyIG4gPSBlLmRpcmVjdGl2ZUFyZ3VtZW50cy5sZW5ndGggPyBlLmRpcmVjdGl2ZUFyZ3VtZW50c1swXSA6ICJ1bmtub3duIjsKICAgICAgICAgICAgcmV0dXJuIHQgPSB0aGlzLnRhZygiY29kZSIsIHQsIHsKICAgICAgICAgICAgICAgIGNsYXNzOiAibGFuZ3VhZ2UtIiArIG4KICAgICAgICAgICAgfSwgcjQpLCB0aGlzLnRhZygicHJlIiwgdCwgewogICAgICAgICAgICAgICAgY2xhc3M6ICJwcmV0dHlwcmludCIKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0SFRNTDogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgcmV0dXJuIGUuZGlyZWN0aXZlTmFtZSA9PT0gImh0bWw6IiA/IGUuZGlyZWN0aXZlUmF3VmFsdWUgOiBlLmRpcmVjdGl2ZU5hbWUgPT09ICJodG1sIiA/IGUuY2hpbGRyZW4ubWFwKGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiBuLnZhbHVlOwogICAgICAgICAgICB9KS5qb2luKGBcbmApIDogdDsKICAgICAgICB9LAogICAgICAgIGNvbnZlcnRIZWFkZXJCbG9jazogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgdCA9IHQgfHwgMCwgcjQgPSByNCB8fCAwOwogICAgICAgICAgICB2YXIgbiA9IFtdLCBpNSA9IGUuaGVhZGVyOwogICAgICAgICAgICBpNSAmJiBuLnB1c2godGhpcy5jb252ZXJ0Tm9kZShpNSkpOwogICAgICAgICAgICB2YXIgcyA9IHRoaXMuY29udmVydE5vZGVzKGUuY2hpbGROb2Rlcyk7CiAgICAgICAgICAgIG4ucHVzaChzKTsKICAgICAgICAgICAgdmFyIGEgPSBlLmNoaWxkQmxvY2tzLm1hcChmdW5jdGlvbihkLCB2KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0SGVhZGVyQmxvY2soZCwgdCArIDEsIHYpOwogICAgICAgICAgICB9LCB0aGlzKS5qb2luKGBcbmApOwogICAgICAgICAgICBuLnB1c2goYSk7CiAgICAgICAgICAgIHZhciBoID0gbi5qb2luKGBcbmApOwogICAgICAgICAgICByZXR1cm4gaTUgPyB0aGlzLnRhZygic2VjdGlvbiIsIGBcbmAgKyBuLmpvaW4oYFxuYCksIHsKICAgICAgICAgICAgICAgIGNsYXNzOiAiYmxvY2sgYmxvY2stbGV2ZWwtIiArIHQKICAgICAgICAgICAgfSkgOiBoOwogICAgICAgIH0sCiAgICAgICAgcmVwbGFjZU1hcDogewogICAgICAgICAgICAiJiI6IFsKICAgICAgICAgICAgICAgICImIzM4OyIsCiAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICI8IjogWwogICAgICAgICAgICAgICAgIiYjNjA7IiwKICAgICAgICAgICAgICAgIG51bGwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgIj4iOiBbCiAgICAgICAgICAgICAgICAiJiM2MjsiLAogICAgICAgICAgICAgICAgbnVsbAogICAgICAgICAgICBdLAogICAgICAgICAgICAnIic6IFsKICAgICAgICAgICAgICAgICImIzM0OyIsCiAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICInIjogWwogICAgICAgICAgICAgICAgIiYjMzk7IiwKICAgICAgICAgICAgICAgIG51bGwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgIi0+IjogWwogICAgICAgICAgICAgICAgIiYjMTAxMzI7IiwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5leHBvcnRPcHRpb25zLnRyYW5zbGF0ZVN5bWJvbEFycm93ICYmICF0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgfSwKICAgICAgICByZXBsYWNlUmVnZXhwOiBudWxsLAogICAgICAgIGVzY2FwZVNwZWNpYWxDaGFyczogZnVuY3Rpb24oZSwgdCkgewogICAgICAgICAgICB0aGlzLnJlcGxhY2VSZWdleHAgfHwgKHRoaXMucmVwbGFjZVJlZ2V4cCA9IG5ldyBSZWdFeHAoT2JqZWN0LmtleXModGhpcy5yZXBsYWNlTWFwKS5qb2luKCJ8IiksICJnIikpOwogICAgICAgICAgICB2YXIgcjQgPSB0aGlzLnJlcGxhY2VNYXAsIG4gPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gZS5yZXBsYWNlKHRoaXMucmVwbGFjZVJlZ2V4cCwgZnVuY3Rpb24oaTUpIHsKICAgICAgICAgICAgICAgIGlmICghcjRbaTVdKSB0aHJvdyBFcnJvcigiZXNjYXBlU3BlY2lhbENoYXJzOiBJbnZhbGlkIG1hdGNoIik7CiAgICAgICAgICAgICAgICB2YXIgcyA9IHI0W2k1XVsxXTsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgcyA9PSAiZnVuY3Rpb24iICYmICFzLmNhbGwobiwgZSwgdCkgPyBpNSA6IHI0W2k1XVswXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBwb3N0UHJvY2VzczogZnVuY3Rpb24oZSwgdCwgcjQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwb3J0T3B0aW9ucy5leHBvcnRGcm9tTGluZU51bWJlciAmJiB0eXBlb2YgZS5mcm9tTGluZU51bWJlciA9PSAibnVtYmVyIiAmJiAodCA9IHRoaXMuaW5saW5lVGFnKCJkaXYiLCB0LCB7CiAgICAgICAgICAgICAgICAiZGF0YS1saW5lLW51bWJlciI6IGUuZnJvbUxpbmVOdW1iZXIKICAgICAgICAgICAgfSkpLCB0OwogICAgICAgIH0sCiAgICAgICAgbWFrZUxpbms6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInICsgZSArICciPicgKyBkZWNvZGVVUklDb21wb25lbnQoZSkgKyAiPC9hPiI7CiAgICAgICAgfSwKICAgICAgICBtYWtlU3Vic2NyaXB0OiBmdW5jdGlvbihlLCB0LCByNCkgewogICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSJvcmctc3Vic2NyaXB0LXBhcmVudCI+JyArIHQgKyAnPC9zcGFuPjxzcGFuIGNsYXNzPSJvcmctc3Vic2NyaXB0LWNoaWxkIj4nICsgcjQgKyAiPC9zcGFuPiI7CiAgICAgICAgfSwKICAgICAgICBhdHRyaWJ1dGVzT2JqZWN0VG9TdHJpbmc6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSAiIjsKICAgICAgICAgICAgZm9yKHZhciByNCBpbiBlKWlmIChlLmhhc093blByb3BlcnR5KHI0KSkgewogICAgICAgICAgICAgICAgdmFyIG4gPSBlW3I0XTsKICAgICAgICAgICAgICAgIHI0ID09PSAiY2xhc3MiID8gbiA9IHRoaXMub3JnQ2xhc3NOYW1lKG4pIDogcjQgPT09ICJpZCIgJiYgKG4gPSB0aGlzLm9yZ0lkKG4pKSwgdCArPSAiICIgKyByNCArICc9IicgKyBuICsgJyInOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0OwogICAgICAgIH0sCiAgICAgICAgaW5saW5lVGFnOiBmdW5jdGlvbihlLCB0LCByNCwgbikgewogICAgICAgICAgICByNCA9IHI0IHx8IHsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGk1ID0gIjwiICsgZTsKICAgICAgICAgICAgcmV0dXJuIG4gJiYgKGk1ICs9ICIgIiArIG4pLCBpNSArPSB0aGlzLmF0dHJpYnV0ZXNPYmplY3RUb1N0cmluZyhyNCksIHQgPT09IG51bGwgPyBpNSArICIvPiIgOiAoaTUgKz0gIj4iICsgdCArICI8LyIgKyBlICsgIj4iLCBpNSk7CiAgICAgICAgfSwKICAgICAgICB0YWc6IGZ1bmN0aW9uKGUsIHQsIHI0LCBuKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlubGluZVRhZyhlLCB0LCByNCwgbikgKyBgXG5gOwogICAgICAgIH0KICAgIH07CiAgICB0eXBlb2YgJCAhPSAidW5kZWZpbmVkIiAmJiAoJC5Db252ZXJ0ZXJIVE1MID0gcSk7Cn0pOwp2YXIgRiA9IGcoKEgpPT57CiAgICBpZiAodHlwZW9mIEggIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBsZXQgZSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgZm9yKHZhciByNCBpbiB0KXQuaGFzT3duUHJvcGVydHkocjQpICYmIChIW3I0XSA9IHRbcjRdKTsKICAgICAgICB9OwogICAgICAgIGhlID0gZSwgZShQKCkpLCBlKFMoKSksIGUoYigpKSwgZShQKCkpLCBlKHcoKSksIGUoXygpKTsKICAgIH0KICAgIHZhciBoZTsKfSk7CnZhciB0ZSA9IEIoRigpKSwgcmUgPSBCKEYoKSksIHsgUGFyc2VyOiBkZSAsIElubGluZVBhcnNlcjogZmUgLCBMZXhlcjogdmUgLCBOb2RlOiBrZSAsIFN0cmVhbTogbWUgLCBDb252ZXJ0ZXJIVE1MOiBnZSAgfSA9IHRlOwp2YXIgZXhwb3J0X2RlZmF1bHQgPSByZS5kZWZhdWx0Owpjb25zdCBtb2QgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB7CiAgICAgICAgZGVmYXVsdDogZXhwb3J0X2RlZmF1bHQsCiAgICAgICAgQ29udmVydGVySFRNTDogZ2UsCiAgICAgICAgSW5saW5lUGFyc2VyOiBmZSwKICAgICAgICBMZXhlcjogdmUsCiAgICAgICAgTm9kZToga2UsCiAgICAgICAgUGFyc2VyOiBkZSwKICAgICAgICBTdHJlYW06IG1lCiAgICB9Owp9KCk7CmNsYXNzIE5vZGVEZXRhaWwgZXh0ZW5kcyBIVE1MRGl2RWxlbWVudCB7CiAgICBmZXRjaE5vZGU7CiAgICBtb2RhbE9wZW5FbGVtZW50OwogICAgbW9kYWxXaW5kb3dFbGVtZW50OwogICAgY3VycmVudE5vZGU7CiAgICB0aXRsZUVsZW1lbnQ7CiAgICBkZXNjcmlwdGlvbkVsZW1lbnQ7CiAgICB0aHVtYm5haWxFbGVtZW50OwogICAgcHJvcGVydGllczsKICAgIHRhZ3M7CiAgICBjb25zdHJ1Y3RvcihmZXRjaE5vZGUyKXsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuZmV0Y2hOb2RlID0gZmV0Y2hOb2RlMjsKICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoIm5vZGUtZGV0YWlsIik7CiAgICAgICAgdGhpcy50aHVtYm5haWxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7CiAgICAgICAgdGhpcy50aHVtYm5haWxFbGVtZW50LmNsYXNzTGlzdC5hZGQoInRodW1ibmFpbCIpOwogICAgICAgIHRoaXMudGh1bWJuYWlsRWxlbWVudC5oaWRkZW4gPSB0cnVlOwogICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy50aHVtYm5haWxFbGVtZW50KTsKICAgICAgICB0aGlzLnRpdGxlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsKICAgICAgICB0aGlzLnRpdGxlRWxlbWVudC5pbm5lclRleHQgPSAidGl0bGUiOwogICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy50aXRsZUVsZW1lbnQpOwogICAgICAgIHRoaXMuZGVzY3JpcHRpb25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpOwogICAgICAgIHRoaXMuZGVzY3JpcHRpb25FbGVtZW50LmlubmVyVGV4dCA9ICJkZXNjcmlwdGlvbiI7CiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmRlc2NyaXB0aW9uRWxlbWVudCk7CiAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwnKTsKICAgICAgICBjb25zdCBtYXNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hc2snKTsKICAgICAgICB0aGlzLm1vZGFsT3BlbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBpZiAobW9kYWwgIT0gbnVsbCAmJiBtYXNrICE9IG51bGwgJiYgIWlzTnVsbCh0aGlzLm1vZGFsT3BlbkVsZW1lbnQpKSB7CiAgICAgICAgICAgIHRoaXMubW9kYWxPcGVuRWxlbWVudC5pZCA9ICJvcGVuIjsKICAgICAgICAgICAgdGhpcy5tb2RhbE9wZW5FbGVtZW50LmlubmVyVGV4dCA9ICJjbGljayB0byBvcGVuIGNvbnRlbnQiOwogICAgICAgICAgICB0aGlzLm1vZGFsT3BlbkVsZW1lbnQub25jbGljayA9ICgpPT57CiAgICAgICAgICAgICAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIG1hc2suY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG1hc2sub25jbGljayA9ICgpPT57CiAgICAgICAgICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIG1hc2suY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5tb2RhbE9wZW5FbGVtZW50KTsKICAgICAgICAgICAgdGhpcy5tb2RhbFdpbmRvd0VsZW1lbnQgPSBtb2RhbDsKICAgICAgICB9CiAgICB9CiAgICByZWxvYWREZXRhaWwgPSBhc3luYyAoKT0+ewogICAgICAgIGlmICh0aGlzLmN1cnJlbnROb2RlKSB7CiAgICAgICAgICAgIGNvbnN0IHJlbW90ZUxhdGVzdE5vZGUgPSBhd2FpdCB0aGlzLmZldGNoTm9kZSh0aGlzLmN1cnJlbnROb2RlLmhhc2gpOwogICAgICAgICAgICBpZiAoIWlzTnVsbChyZW1vdGVMYXRlc3ROb2RlKSkgewogICAgICAgICAgICAgICAgdGhpcy5zZXREZXRhaWwocmVtb3RlTGF0ZXN0Tm9kZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgYXN5bmMgc2V0RGV0YWlsKG5vZGUpIHsKICAgICAgICBpZiAoaXNOdWxsKHRoaXMudGl0bGVFbGVtZW50KSB8fCBpc051bGwodGhpcy50aHVtYm5haWxFbGVtZW50KSB8fCBpc051bGwodGhpcy5kZXNjcmlwdGlvbkVsZW1lbnQpKSByZXR1cm47CiAgICAgICAgdGhpcy50aXRsZUVsZW1lbnQuaW5uZXJUZXh0ID0gbm9kZS50aXRsZS5zdWJzdHJpbmcoMCwgMjUpOwogICAgICAgIHRoaXMuZGVzY3JpcHRpb25FbGVtZW50LmlubmVyVGV4dCA9IG5vZGUuZGVzY3JpcHRpb247CiAgICAgICAgY29uc3Qgb3JnUGF0aERhdGEgPSBvcmdtb2RlUmVzb3VyY2VQYXRoKG5vZGUuaGFzaCk7CiAgICAgICAgaWYgKEJsb2JNZXRhLnZhbGlkYXRpb24obm9kZSkgJiYgKG5vZGUuZXh0ZW50aW9uID09ICIuanBlZyIgfHwgbm9kZS5leHRlbnRpb24gPT0gIi5wbmciIHx8IG5vZGUuZXh0ZW50aW9uID09ICIuanBnIiB8fCBub2RlLmV4dGVudGlvbiA9PSAiLmdpZiIpKSB7CiAgICAgICAgICAgIGNvbnN0IGJsb2JQYXRoRGF0YSA9IGJsb2JSZXNvdXJjZVBhdGgobm9kZS5oYXNoKTsKICAgICAgICAgICAgdGhpcy50aHVtYm5haWxFbGVtZW50LnNyYyA9IHJlbW90ZVN0b3JhZ2VVUkwgKyBibG9iUGF0aERhdGEucHJlZml4ICsgYmxvYlBhdGhEYXRhLmhhc2hEaXIgKyBibG9iUGF0aERhdGEuaGFzaCArIG5vZGUuZXh0ZW50aW9uOwogICAgICAgICAgICB0aGlzLnRodW1ibmFpbEVsZW1lbnQuaGlkZGVuID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKG5vZGUudGh1bWJuYWlsID09ICIiKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRodW1ibmFpbEVsZW1lbnQuaGlkZGVuID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMudGh1bWJuYWlsRWxlbWVudC5zcmMgPSBub2RlLnRodW1ibmFpbDsKICAgICAgICAgICAgICAgIHRoaXMudGh1bWJuYWlsRWxlbWVudC5oaWRkZW4gPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5tb2RhbFdpbmRvd0VsZW1lbnQpIHsKICAgICAgICAgICAgd2hpbGUodGhpcy5tb2RhbFdpbmRvd0VsZW1lbnQuZmlyc3RDaGlsZCl7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGFsV2luZG93RWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLm1vZGFsV2luZG93RWxlbWVudC5maXJzdENoaWxkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBvcmdUZXh0ID0gYXdhaXQgcmVtb3RlT3JnR2V0KG5vZGUuaGFzaCk7CiAgICAgICAgICAgIGNvbnN0IGh0bWwgPSBvcmcySHRtbChvcmdUZXh0KTsKICAgICAgICAgICAgaWYgKGh0bWwgIT0gIiIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbCiAgICAgICAgICAgICAgICAgICAgaHRtbC5jb250ZW50SFRNTAogICAgICAgICAgICAgICAgXSwgewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0L2h0bWwnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNvbnN0IGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlmcmFtZSIpOwogICAgICAgICAgICAgICAgaWZyYW1lLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGFsV2luZG93RWxlbWVudC5hcHBlbmRDaGlsZChpZnJhbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IHByb3BzID0gb2JqVG9SZWN1cmlzdmVBY2NvcmRpb25NZW51KGRvY3VtZW50LCBub2RlKTsKICAgICAgICBpZiAoaXNOdWxsKHRoaXMucHJvcGVydGllcykpIHsKICAgICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgicHJvcHM6ICIpKTsKICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcHM7CiAgICAgICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5wcm9wZXJ0aWVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnJlcGxhY2VDaGlsZChwcm9wcywgdGhpcy5wcm9wZXJ0aWVzKTsKICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcHM7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHRhZ3NSb290ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTsKICAgICAgICBpZiAoaXNOdWxsKHRoaXMudGFncykpIHsKICAgICAgICAgICAgdGhpcy50YWdzID0gdGFnc1Jvb3Q7CiAgICAgICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy50YWdzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnJlcGxhY2VDaGlsZCh0YWdzUm9vdCwgdGhpcy50YWdzKTsKICAgICAgICAgICAgdGhpcy50YWdzID0gdGFnc1Jvb3Q7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5lbnRyaWVzKG5vZGUudmVjdG9yKS5mb3JFYWNoKGFzeW5jIChbdGFyZ2V0LCBsYWJlbF0pPT57CiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBhd2FpdCB0aGlzLmZldGNoTm9kZSh0YXJnZXQpOwogICAgICAgICAgICBpZiAobm9kZSkgewogICAgICAgICAgICAgICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOwogICAgICAgICAgICAgICAgbGkuaW5uZXJUZXh0ID0gbm9kZS50aXRsZTsKICAgICAgICAgICAgICAgIHRhZ3NSb290LmFwcGVuZENoaWxkKGxpKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuY3VycmVudE5vZGUgPSBub2RlOwogICAgfQp9CmNsYXNzIEVkaXRhYmxlTm9kZURldGFpbCBleHRlbmRzIE5vZGVEZXRhaWwgewogICAgdGFnSGFzaERpY3Q7CiAgICB1cGRhdGVOb2RlOwogICAgcmVsb2FkOwogICAgcmVtb3RlT3Blbk9yZ0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHJlbW90ZU9wZW5CbG9iRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgcmVtb3RlT3Blbk1ldGFFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBqc29uVGV4dEFyZWFFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTsKICAgIHRhZ1NlbGVjdG9yRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgICB0YWdJbnNlcnRlckJ1dHRvbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgIHRhZ0xpc3RFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTsKICAgIGNvbnN0cnVjdG9yKGZldGNoTm9kZTEsIHRhZ0hhc2hEaWN0LCB1cGRhdGVOb2RlMSwgcmVsb2FkMSl7CiAgICAgICAgc3VwZXIoZmV0Y2hOb2RlMSk7CiAgICAgICAgdGhpcy50YWdIYXNoRGljdCA9IHRhZ0hhc2hEaWN0OwogICAgICAgIHRoaXMudXBkYXRlTm9kZSA9IHVwZGF0ZU5vZGUxOwogICAgICAgIHRoaXMucmVsb2FkID0gcmVsb2FkMTsKICAgICAgICB0aGlzLnJlbW90ZU9wZW5PcmdFbGVtZW50LmlubmVyVGV4dCA9ICJ4ZGdPcGVuT3JnIjsKICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMucmVtb3RlT3Blbk9yZ0VsZW1lbnQpOwogICAgICAgIHRoaXMucmVtb3RlT3BlbkJsb2JFbGVtZW50LmlubmVyVGV4dCA9ICJ4ZGdPcGVuQmxvYiI7CiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLnJlbW90ZU9wZW5CbG9iRWxlbWVudCk7CiAgICAgICAgdGhpcy5yZW1vdGVPcGVuTWV0YUVsZW1lbnQuaW5uZXJUZXh0ID0gInhkZ09wZW5NZXRhIjsKICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMucmVtb3RlT3Blbk1ldGFFbGVtZW50KTsKICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMudGFnTGlzdEVsZW1lbnQpOwogICAgICAgIGNvbnN0IHRhZ0RpY3QgPSB0YWdIYXNoRGljdCgpOwogICAgICAgIGNvbnN0IGRhdGFsaXN0ID0gT2JqZWN0LnZhbHVlcyh0YWdEaWN0KS5tYXAoKGUpPT5lLnRpdGxlCiAgICAgICAgKTsKICAgICAgICB0aGlzLnRhZ1NlbGVjdG9yRWxlbWVudCA9IENyZWF0ZUF1dG9jb21wbGV0ZUlucHV0KGRvY3VtZW50LCAibGktdGFnLWRhdGFsaXN0IiwgZGF0YWxpc3QpOwogICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy50YWdTZWxlY3RvckVsZW1lbnQpOwogICAgICAgIHRoaXMudGFnSW5zZXJ0ZXJCdXR0b25FbGVtZW50LnRleHRDb250ZW50ID0gJ3RhZyBpbnNlcnQnOwogICAgICAgIHRoaXMudGFnSW5zZXJ0ZXJCdXR0b25FbGVtZW50Lm9uY2xpY2sgPSB0aGlzLmluc2VydFRhZzsKICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMudGFnSW5zZXJ0ZXJCdXR0b25FbGVtZW50KTsKICAgICAgICB0aGlzLmpzb25UZXh0QXJlYUVsZW1lbnQudmFsdWUgPSAidGV4dCI7CiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmpzb25UZXh0QXJlYUVsZW1lbnQpOwogICAgfQogICAgaW5zZXJ0VGFnID0gYXN5bmMgKCk9PnsKICAgICAgICBjb25zdCBub2RlID0gSlNPTi5wYXJzZSh0aGlzLmpzb25UZXh0QXJlYUVsZW1lbnQudmFsdWUpOwogICAgICAgIGNvbnN0IHRhZyA9IHRoaXMudGFnSGFzaERpY3QoKVt0aGlzLnRhZ1NlbGVjdG9yRWxlbWVudC52YWx1ZV07CiAgICAgICAgaWYgKE5vZGUxLnZhbGlkYXRpb24obm9kZSkpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0YWcuaGFzaDsKICAgICAgICAgICAgbm9kZS52ZWN0b3JbaW5kZXhdID0gbm9kZS52ZWN0b3JbaW5kZXhdID8/IHsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbm9kZS52ZWN0b3JbaW5kZXhdWyJ0YWciXSA9IDE7CiAgICAgICAgICAgIHRoaXMuanNvblRleHRBcmVhRWxlbWVudC52YWx1ZSA9IEpTT04uc3RyaW5naWZ5KG5vZGUpOwogICAgICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZU5vZGUobm9kZSwgbmV3IEZvcm1EYXRhKTsKICAgICAgICAgICAgdGhpcy5yZWxvYWQoKTsKICAgICAgICB9CiAgICB9OwogICAgYXN5bmMgc2V0RGV0YWlsKG5vZGUpIHsKICAgICAgICBhd2FpdCBzdXBlci5zZXREZXRhaWwobm9kZSk7CiAgICAgICAgY29uc3Qgb3JnUGF0aERhdGEgPSBvcmdtb2RlUmVzb3VyY2VQYXRoKG5vZGUuaGFzaCk7CiAgICAgICAgdGhpcy5qc29uVGV4dEFyZWFFbGVtZW50LnZhbHVlID0gSlNPTi5zdHJpbmdpZnkobm9kZSk7CiAgICAgICAgaWYgKHRoaXMucmVtb3RlT3Blbk9yZ0VsZW1lbnQpIHsKICAgICAgICAgICAgcmVtb3ZlQWxsQ2hpbGQodGhpcy5yZW1vdGVPcGVuT3JnRWxlbWVudCk7CiAgICAgICAgICAgIGNvbnN0IHhkZ09wZW5PcmdQYXRoID0gcmVtb3RlU3RvcmFnZVVSTCArICJyZW1vdGUteGRnLWxpa2Utb3Blbi8iICsgb3JnUGF0aERhdGEucHJlZml4ICsgb3JnUGF0aERhdGEuaGFzaERpciArIG9yZ1BhdGhEYXRhLmhhc2ggKyBvcmdQYXRoRGF0YS5leHRlbnRpb247CiAgICAgICAgICAgIGNvbnN0IGVsZW1zID0gUGF0aEVsZW1lbnQoIm9yZyIsICIvIiArIG9yZ1BhdGhEYXRhLnByZWZpeCArIG9yZ1BhdGhEYXRhLmhhc2hEaXIgKyBvcmdQYXRoRGF0YS5oYXNoICsgb3JnUGF0aERhdGEuZXh0ZW50aW9uLCB4ZGdPcGVuT3JnUGF0aCk7CiAgICAgICAgICAgIGVsZW1zLmZvckVhY2goKGUpPT57CiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZW1vdGVPcGVuT3JnRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3RlT3Blbk9yZ0VsZW1lbnQuYXBwZW5kQ2hpbGQoZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5yZW1vdGVPcGVuQmxvYkVsZW1lbnQpIHsKICAgICAgICAgICAgaWYgKEJsb2JNZXRhLnZhbGlkYXRpb24obm9kZSkpIHsKICAgICAgICAgICAgICAgIHJlbW92ZUFsbENoaWxkKHRoaXMucmVtb3RlT3BlbkJsb2JFbGVtZW50KTsKICAgICAgICAgICAgICAgIGNvbnN0IGJsb2JQYXRoRGF0YSA9IGJsb2JSZXNvdXJjZVBhdGgobm9kZS5oYXNoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHhkZ09wZW5CbG9iUGF0aCA9IHJlbW90ZVN0b3JhZ2VVUkwgKyAicmVtb3RlLXhkZy1saWtlLW9wZW4vIiArIGJsb2JQYXRoRGF0YS5wcmVmaXggKyBibG9iUGF0aERhdGEuaGFzaERpciArIGJsb2JQYXRoRGF0YS5oYXNoICsgbm9kZS5leHRlbnRpb247CiAgICAgICAgICAgICAgICBjb25zdCBlbGVtcyA9IFBhdGhFbGVtZW50KCJibG9iIiwgIi8iICsgYmxvYlBhdGhEYXRhLnByZWZpeCArIGJsb2JQYXRoRGF0YS5oYXNoRGlyICsgYmxvYlBhdGhEYXRhLmhhc2ggKyBub2RlLmV4dGVudGlvbiwgeGRnT3BlbkJsb2JQYXRoKTsKICAgICAgICAgICAgICAgIGVsZW1zLmZvckVhY2goKGUpPT57CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVtb3RlT3BlbkJsb2JFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3RlT3BlbkJsb2JFbGVtZW50LmFwcGVuZENoaWxkKGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5yZW1vdGVPcGVuQmxvYkVsZW1lbnQuaGlkZGVuID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW90ZU9wZW5CbG9iRWxlbWVudC5oaWRkZW4gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnJlbW90ZU9wZW5NZXRhRWxlbWVudCkgewogICAgICAgICAgICByZW1vdmVBbGxDaGlsZCh0aGlzLnJlbW90ZU9wZW5NZXRhRWxlbWVudCk7CiAgICAgICAgICAgIGNvbnN0IG1ldGFQYXRoRGF0YSA9IG1ldGFSZXNvdXJjZVBhdGgobm9kZS5oYXNoKTsKICAgICAgICAgICAgY29uc3QgeGRnT3Blbk1ldGFQYXRoID0gcmVtb3RlU3RvcmFnZVVSTCArICJyZW1vdGUteGRnLWxpa2Utb3Blbi8iICsgbWV0YVBhdGhEYXRhLnByZWZpeCArIG1ldGFQYXRoRGF0YS5oYXNoRGlyICsgbWV0YVBhdGhEYXRhLmhhc2ggKyBtZXRhUGF0aERhdGEuZXh0ZW50aW9uOwogICAgICAgICAgICBjb25zdCBlbGVtcyA9IFBhdGhFbGVtZW50KCJqc29uIiwgIi8iICsgbWV0YVBhdGhEYXRhLnByZWZpeCArIG1ldGFQYXRoRGF0YS5oYXNoRGlyICsgbWV0YVBhdGhEYXRhLmhhc2ggKyBtZXRhUGF0aERhdGEuZXh0ZW50aW9uLCB4ZGdPcGVuTWV0YVBhdGgpOwogICAgICAgICAgICBlbGVtcy5mb3JFYWNoKChlKT0+ewogICAgICAgICAgICAgICAgaWYgKHRoaXMucmVtb3RlT3Blbk1ldGFFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdGVPcGVuTWV0YUVsZW1lbnQuYXBwZW5kQ2hpbGQoZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB0aGlzLnJlbG9hZFRhZ1NlbGVjdG9yRGF0YUxpc3QoKTsKICAgIH0KICAgIHJlbG9hZFRhZ1NlbGVjdG9yRGF0YUxpc3QgPSAoKT0+ewogICAgICAgIGNvbnN0IHRhZ0RpY3QxID0gdGhpcy50YWdIYXNoRGljdCgpOwogICAgICAgIGNvbnN0IGRhdGFsaXN0MSA9IE9iamVjdC52YWx1ZXModGFnRGljdDEpLm1hcCgoZSk9PmUudGl0bGUKICAgICAgICApOwogICAgICAgIGNvbnN0IGRsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxpLXRhZy1kYXRhbGlzdCIpOwogICAgICAgIGlmICghaXNOdWxsKGRsKSkgewogICAgICAgICAgICB3aGlsZShkbC5maXJzdENoaWxkKXsKICAgICAgICAgICAgICAgIGRsLnJlbW92ZUNoaWxkKGRsLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRhdGFsaXN0MS5mb3JFYWNoKChlKT0+ewogICAgICAgICAgICAgICAgbGV0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gZTsKICAgICAgICAgICAgICAgIGRsLmFwcGVuZENoaWxkKG9wdGlvbik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07Cn0KY29uc3Qgb2JqVG9SZWN1cmlzdmVBY2NvcmRpb25NZW51ID0gKGRvY3VtZW50Miwgb2JqKT0+ewogICAgY29uc3Qgcm9vdCA9IGRvY3VtZW50Mi5jcmVhdGVFbGVtZW50KCd1bCcpOwogICAgcm9vdC5jbGFzc0xpc3QuYWRkKCdhY2NvcmRpb24tY2hpbGQnKTsKICAgIE9iamVjdC5lbnRyaWVzKG9iaikuZm9yRWFjaCgoW2tleTIsIHZhbHVlXSk9PnsKICAgICAgICBjb25zdCBsaSA9IGRvY3VtZW50Mi5jcmVhdGVFbGVtZW50KCdsaScpOwogICAgICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQyLmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7CiAgICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gYCR7a2V5Mi5zdWJzdHJpbmcoMCwgMTApfTogYDsKICAgICAgICBsaS5hcHBlbmRDaGlsZChsYWJlbCk7CiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JykgewogICAgICAgICAgICBjb25zdCBhY2NvcmRpb24gPSBkb2N1bWVudDIuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgYWNjb3JkaW9uLnR5cGUgPSAnY2hlY2tib3gnOwogICAgICAgICAgICBhY2NvcmRpb24uY2xhc3NMaXN0LmFkZCgndG9nZ2xlJyk7CiAgICAgICAgICAgIGxpLmFwcGVuZENoaWxkKGFjY29yZGlvbik7CiAgICAgICAgICAgIGNvbnN0IHVsID0gb2JqVG9SZWN1cmlzdmVBY2NvcmRpb25NZW51KGRvY3VtZW50MiwgdmFsdWUpOwogICAgICAgICAgICBsaS5hcHBlbmRDaGlsZCh1bCk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHwgdHlwZW9mIHZhbHVlID09ICdudW1iZXInKSB7CiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gZG9jdW1lbnQyLmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgICAgICAgICAgIGNoaWxkLnZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgICAgbGkuYXBwZW5kQ2hpbGQoY2hpbGQpOwogICAgICAgIH0KICAgICAgICByb290LmFwcGVuZENoaWxkKGxpKTsKICAgIH0pOwogICAgcmV0dXJuIHJvb3Q7Cn07CmNvbnN0IHJlbW92ZUFsbENoaWxkID0gKHRhcmdldCk9PnsKICAgIHdoaWxlKHRhcmdldC5maXJzdENoaWxkKXsKICAgICAgICB0YXJnZXQucmVtb3ZlQ2hpbGQodGFyZ2V0LmZpcnN0Q2hpbGQpOwogICAgfQp9Owpjb25zdCB0ZXh0VG9DbGlwQm9hcmQgPSAoZG9jdW1lbnQyLCB0ZXh0Mik9PnsKICAgIGNvbnN0IHRlbXBFbGVtZW50ID0gZG9jdW1lbnQyLmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7CiAgICB0ZW1wRWxlbWVudC50ZXh0Q29udGVudCA9IHRleHQyOwogICAgZG9jdW1lbnQyLmJvZHkuYXBwZW5kQ2hpbGQodGVtcEVsZW1lbnQpOwogICAgZG9jdW1lbnQyLmdldFNlbGVjdGlvbigpPy5zZWxlY3RBbGxDaGlsZHJlbih0ZW1wRWxlbWVudCk7CiAgICB0ZW1wRWxlbWVudC5zZWxlY3QoKTsKICAgIHZhciBzdWNjZXNzID0gZG9jdW1lbnQyLmV4ZWNDb21tYW5kKCdjb3B5Jyk7CiAgICBkb2N1bWVudDIuYm9keS5yZW1vdmVDaGlsZCh0ZW1wRWxlbWVudCk7CiAgICByZXR1cm4gc3VjY2VzczsKfTsKY29uc3QgUGF0aEVsZW1lbnQgPSAobmFtZSwgY29weVN0cmluZywgb25DbGlja1JlcXVlc3RQYXRoKT0+ewogICAgY29uc3QgZWxlbXMgPSBbXTsKICAgIGNvbnN0IGNvcHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgIGNvcHkub25jbGljayA9ICgpPT57CiAgICAgICAgdGV4dFRvQ2xpcEJvYXJkKGRvY3VtZW50LCBjb3B5U3RyaW5nKTsKICAgIH07CiAgICBjb3B5LmlubmVyVGV4dCA9IGAke25hbWV9OiBwYXRoVG9DbGlwYm9hcmRgOwogICAgZWxlbXMucHVzaChjb3B5KTsKICAgIGNvbnN0IHJlcXVlc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgIHJlcXVlc3Qub25jbGljayA9ICgpPT57CiAgICAgICAgR2V0UmVxdWVzdChvbkNsaWNrUmVxdWVzdFBhdGgpOwogICAgfTsKICAgIHJlcXVlc3QuaW5uZXJUZXh0ID0gYCR7bmFtZX06IHJlbW90ZVhkZ09wZW5gOwogICAgZWxlbXMucHVzaChyZXF1ZXN0KTsKICAgIHJldHVybiBlbGVtczsKfTsKY29uc3QgcmVtb3RlT3JnR2V0ID0gYXN5bmMgKGhhc2g0LCBmb3JjZSA9IGZhbHNlKT0+ewogICAgY29uc3QgcGF0aFN0cnVjdCA9IG9yZ21vZGVSZXNvdXJjZVBhdGgoaGFzaDQpOwogICAgY29uc3QgcGF0aCA9IHJlbW90ZVN0b3JhZ2VVUkwgKyBwYXRoU3RydWN0LnByZWZpeCArIHBhdGhTdHJ1Y3QuaGFzaERpciArIHBhdGhTdHJ1Y3QuaGFzaCArIHBhdGhTdHJ1Y3QuZXh0ZW50aW9uOwogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBHZXRSZXF1ZXN0KHBhdGgpOwogICAgaWYgKGlzTnVsbChyZXNwb25zZSkpIHJldHVybiAiIjsKICAgIGNvbnN0IHRleHQyID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpOwogICAgaWYgKGlzTnVsbCh0ZXh0MikpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRleHTjgajjgZfjgabop6Pph4jjgafjgY3jgarjgYTjgoLjga7jgpLlj5blvpfjgZfjgb7jgZfjgZ8iKTsKICAgICAgICByZXR1cm4gIiI7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKGByZW1vdGVPcmdHZXQ6ICR7dGV4dDJ9YCk7CiAgICAgICAgcmV0dXJuIHRleHQyOwogICAgfQp9Owpjb25zdCBvcmcySHRtbCA9IChvcmdUZXh0KT0+ewogICAgY29uc3Qgb3JnRG9jdW1lbnQgPSBuZXcgbW9kLlBhcnNlcigpLnBhcnNlKG9yZ1RleHQpOwogICAgY29uc3QgaHRtbCA9IG9yZ0RvY3VtZW50LmNvbnZlcnQobW9kLkNvbnZlcnRlckhUTUwsIHsKICAgIH0pOwogICAgcmV0dXJuIGh0bWw7Cn07CmNvbnN0IEZvcmNlR3JhcGhVcGRhdGUgPSAobm9kZXMsIGhlaWdodCwgd2lkdGgpPT57CiAgICBjb25zdCBCT1VOQ0UgPSAwLjA1OwogICAgY29uc3QgQ09VTE9NQiA9IDYwMDsKICAgIGNvbnN0IEFUVEVOVUFUSU9OID0gMC43OwogICAgY29uc3QgcmV0ID0gT2JqZWN0LmVudHJpZXMobm9kZXMpLm1hcCgoW2tleTIsIHRhcmdldF0pPT57CiAgICAgICAgbGV0IHZ4ID0gMDsKICAgICAgICBsZXQgdnkgPSAwOwogICAgICAgIGlmICh0YXJnZXQubW92YWJsZSkgewogICAgICAgICAgICBsZXQgZnggPSAwOwogICAgICAgICAgICBsZXQgZnkgPSAwOwogICAgICAgICAgICBPYmplY3QuZW50cmllcyhub2RlcykuZm9yRWFjaCgoW2VkZ2VUYXJnZXRVcmksIG5dKT0+ewogICAgICAgICAgICAgICAgaWYgKGtleTIgIT0gZWRnZVRhcmdldFVyaSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RYID0gdGFyZ2V0LnggLSBuLng7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdFkgPSB0YXJnZXQueSAtIG4ueTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByc3EgPSBkaXN0WCAqIGRpc3RYICsgZGlzdFkgKiBkaXN0WTsKICAgICAgICAgICAgICAgICAgICBmeCArPSBDT1VMT01CICogZGlzdFggLyByc3E7CiAgICAgICAgICAgICAgICAgICAgZnkgKz0gQ09VTE9NQiAqIGRpc3RZIC8gcnNxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgbWVyZ2VkID0gewogICAgICAgICAgICAgICAgLi4udGFyZ2V0LmxpbmtzLAogICAgICAgICAgICAgICAgLi4udGFyZ2V0LnJlZmVyZXJzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKG1lcmdlZCkuZm9yRWFjaCgoW3RhcmdldFVyaSwgZWRnZUluZm9dKT0+ewogICAgICAgICAgICAgICAgaWYgKHRhcmdldC5ub2RlSGFzaCAhPSB0YXJnZXRVcmkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gbm9kZXNbdGFyZ2V0VXJpXTsKICAgICAgICAgICAgICAgICAgICBpZiAobikgewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhlZGdlSW5mbykuZm9yRWFjaCgoW2hhc2g0LCB3ZWlnaHRdKT0+ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdFggPSBuLnggLSB0YXJnZXQueDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RZID0gbi55IC0gdGFyZ2V0Lnk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmeCArPSBCT1VOQ0UgKiBkaXN0WDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ5ICs9IEJPVU5DRSAqIGRpc3RZOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2eCA9ICh0YXJnZXQudnggKyBmeCkgKiBBVFRFTlVBVElPTjsKICAgICAgICAgICAgdnkgPSAodGFyZ2V0LnZ5ICsgZnkpICogQVRURU5VQVRJT047CiAgICAgICAgfQogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIGtleTIsCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG1vdmFibGU6IHRhcmdldC5tb3ZhYmxlLAogICAgICAgICAgICAgICAgbm9kZUhhc2g6IHRhcmdldC5ub2RlSGFzaCwKICAgICAgICAgICAgICAgIHRpdGxlOiB0YXJnZXQudGl0bGUsCiAgICAgICAgICAgICAgICB0aHVtYm5haWw6IHRhcmdldC50aHVtYm5haWwsCiAgICAgICAgICAgICAgICB2eDogdngsCiAgICAgICAgICAgICAgICB2eTogdnksCiAgICAgICAgICAgICAgICB4OiB0YXJnZXQueCArIHZ4LAogICAgICAgICAgICAgICAgeTogdGFyZ2V0LnkgKyB2eSwKICAgICAgICAgICAgICAgIGxpbmtzOiB0YXJnZXQubGlua3MsCiAgICAgICAgICAgICAgICByZWZlcmVyczogdGFyZ2V0LnJlZmVyZXJzCiAgICAgICAgICAgIH0KICAgICAgICBdOwogICAgfSk7CiAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKHJldCk7Cn07CmNvbnN0IE5vZGVUb0ZvcmNlTm9kZSA9IChub2RlKT0+ewogICAgY29uc3QgcmV0ID0gewogICAgICAgIG1vdmFibGU6IHRydWUsCiAgICAgICAgbm9kZUhhc2g6IG5vZGUuaGFzaCwKICAgICAgICB0aXRsZTogbm9kZS50aXRsZSwKICAgICAgICB0aHVtYm5haWw6IG5vZGUudGh1bWJuYWlsLAogICAgICAgIHZ4OiAwLAogICAgICAgIHZ5OiAwLAogICAgICAgIHg6IDAsCiAgICAgICAgeTogMCwKICAgICAgICBsaW5rczogbm9kZS52ZWN0b3IsCiAgICAgICAgcmVmZXJlcnM6IG5vZGUucmVmZXJlcnMKICAgIH07CiAgICByZXR1cm4gcmV0Owp9OwpjbGFzcyBOb1Njb3BlR3JhcGggewogICAgaW5pdCA9ICgpPT57CiAgICB9OwogICAgdXBkYXRlID0gKCk9PnsKICAgIH07CiAgICByZWxvYWQgPSBhc3luYyAoKT0+ewogICAgfTsKICAgIGRyYXcgPSAoKT0+ewogICAgfTsKICAgIHJlbW92ZURlcGVuZGFuY3kgPSAoKT0+ewogICAgfTsKfQpjbGFzcyBTY29wZUdyYXBoTWFuYWdlciB7CiAgICBidWZmZXJTaXplID0gMTA7CiAgICBoaXN0b3J5ID0gQXJyYXkoKTsKICAgIGhpc3RvcnlJbmRleCA9IC0xOwogICAgY3VycmVudFNjb3BlR3JhcGggPSBuZXcgTm9TY29wZUdyYXBoKCk7CiAgICBmZXRjaE5vZGUgPSBhc3luYyAoaGFzaDQpPT57CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH07CiAgICBjYW52YXNNYW5hZ2VyOwogICAgc3RvcmU7CiAgICBvbk5vZGVTZWxlY3RlZE9mVmlldyA9ICgpPT57CiAgICB9OwogICAgY29uc3RydWN0b3IoKXsKICAgIH0KICAgIGRlcGVuZGFuY3lNb2R1bGVJbmplY3Rpb24oY2FudmFzLCBzdG9yZSwgb25Ob2RlU2VsZWN0ZWRPZlZpZXcpIHsKICAgICAgICB0aGlzLmNhbnZhc01hbmFnZXIgPSBjYW52YXM7CiAgICAgICAgdGhpcy5zdG9yZSA9IHN0b3JlOwogICAgICAgIHRoaXMub25Ob2RlU2VsZWN0ZWRPZlZpZXcgPSBvbk5vZGVTZWxlY3RlZE9mVmlldzsKICAgIH0KICAgIHJlc3RhcnQgPSBhc3luYyAoaGFzaDQpPT57CiAgICAgICAgY29uc3Qgbm9kZSA9IGF3YWl0IHRoaXMuc3RvcmU/LmZldGNoKGhhc2g0KTsKICAgICAgICBpZiAoaXNOdWxsKG5vZGUpKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2Fybihg5oyH5a6a44OP44OD44K344OlOiAke2hhc2g0fSDjgafjg47jg7zjg4njgpLjg5Xjgqfjg4Pjg4HjgafjgY3jgb7jgZvjgpPjgafjgZfjgZ9gKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNOdWxsKHRoaXMuY2FudmFzTWFuYWdlcikgfHwgaXNOdWxsKHRoaXMuc3RvcmUpIHx8IGlzTnVsbCh0aGlzLm9uTm9kZVNlbGVjdGVkT2ZWaWV3KSkgewogICAgICAgICAgICBjb25zb2xlLndhcm4oIuW/heimgeOBquS+neWtmOOBjOazqOWFpeOBleOCjOOBpuOBhOOBvuOBm+OCkyIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRoaXMuY2FudmFzTWFuYWdlci5yZW1vdmVBbGxFdmVudExpc3RuZXIoKTsKICAgICAgICBjb25zdCBzY29wZSA9IG5ldyBTaW5nbGVOb2RlVGFyZ2V0U2NvcGVHcmFwaChub2RlLCB0aGlzLnN0b3JlLmZldGNoLCB0aGlzLmNhbnZhc01hbmFnZXIsIHRoaXMub25Ob2RlU2VsZWN0ZWRPZlZpZXcsIHRoaXMucmVzdGFydCk7CiAgICAgICAgaWYgKHNjb3BlKSB7CiAgICAgICAgICAgIGF3YWl0IHNjb3BlLnJlc2V0KCk7CiAgICAgICAgICAgIHRoaXMucHVzaFNjb3BlKHNjb3BlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogICAgcHVzaFNjb3BlKHNjb3BlKSB7CiAgICAgICAgdGhpcy5jdXJyZW50U2NvcGVHcmFwaC5yZW1vdmVEZXBlbmRhbmN5KCk7CiAgICAgICAgdGhpcy5jdXJyZW50U2NvcGVHcmFwaCA9IHNjb3BlOwogICAgfQogICAgdXBkYXRlID0gKCk9PnsKICAgICAgICB0aGlzLmN1cnJlbnRTY29wZUdyYXBoLnVwZGF0ZSgpOwogICAgfTsKICAgIGRyYXcgPSAoKT0+ewogICAgICAgIHRoaXMuY3VycmVudFNjb3BlR3JhcGguZHJhdygpOwogICAgfTsKICAgIGN1cnJlbnRTY29wZVJlbG9hZCA9IGFzeW5jICgpPT57CiAgICAgICAgYXdhaXQgdGhpcy5jdXJyZW50U2NvcGVHcmFwaC5yZWxvYWQoKTsKICAgIH07Cn0KY2xhc3MgU2luZ2xlTm9kZVRhcmdldFNjb3BlR3JhcGggewogICAgdGFyZ2V0OwogICAgZmV0Y2hOb2RlOwogICAgY2FudmFzTWFuYWdlcjsKICAgIG9uTm9kZVNlbGVjdGVkT2ZWaWV3OwogICAgbmV4dEdyYXBoUmVuZGVyOwogICAgZ3JhcGhOb2RlcyA9IHsKICAgIH07CiAgICBub2RlcyA9IHsKICAgIH07CiAgICBncmFwaDsKICAgIGdyYXBoSWQgPSAtMTsKICAgIGlzUmVidWlsZGluZyA9IGZhbHNlOwogICAgdXBkYXRhaW5nID0gZmFsc2U7CiAgICBjb25zdHJ1Y3Rvcih0YXJnZXQsIGZldGNoTm9kZTMgPSBhc3luYyAodXJpKT0+ewogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9LCBjYW52YXNNYW5hZ2VyMSwgb25Ob2RlU2VsZWN0ZWRPZlZpZXcsIG5leHRHcmFwaFJlbmRlcil7CiAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgdGhpcy5mZXRjaE5vZGUgPSBmZXRjaE5vZGUzOwogICAgICAgIHRoaXMuY2FudmFzTWFuYWdlciA9IGNhbnZhc01hbmFnZXIxOwogICAgICAgIHRoaXMub25Ob2RlU2VsZWN0ZWRPZlZpZXcgPSBvbk5vZGVTZWxlY3RlZE9mVmlldzsKICAgICAgICB0aGlzLm5leHRHcmFwaFJlbmRlciA9IG5leHRHcmFwaFJlbmRlcjsKICAgICAgICBpZiAodGFyZ2V0Lmhhc2ggIT0gIjU0NWVhNTM4NDYxMDAzZWZkYzhjODFjMjQ0NTMxYjAwM2Y2ZjI2Y2ZjY2Y2YzAwNzNiMzIzOWZkZWRmNDk0NDYiKSB7CiAgICAgICAgICAgIHRoaXMubm9kZXNbdGFyZ2V0Lmhhc2hdID0gTm9kZVRvRm9yY2VOb2RlKHRhcmdldCk7CiAgICAgICAgICAgIGlmIChjYW52YXNNYW5hZ2VyMS5ncmFwaENhbnZhcykgewogICAgICAgICAgICAgICAgdGhpcy5ub2Rlc1t0YXJnZXQuaGFzaF0ueCA9IGNhbnZhc01hbmFnZXIxLmdyYXBoQ2FudmFzLndpZHRoIC8gMjsKICAgICAgICAgICAgICAgIHRoaXMubm9kZXNbdGFyZ2V0Lmhhc2hdLnkgPSBjYW52YXNNYW5hZ2VyMS5ncmFwaENhbnZhcy5oZWlnaHQgLyAyOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcmVtb3ZlRGVwZW5kYW5jeSA9ICgpPT57CiAgICAgICAgaWYgKGlzTnVsbCh0aGlzLmdyYXBoKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuY2FudmFzTWFuYWdlci5yZW1vdmVFdmVudExpc3RuZXIoJ21vdXNlbW92ZScsIHRoaXMuZ3JhcGgucG9pbnRpbmdfY2hlY2spOwogICAgICAgIHRoaXMuY2FudmFzTWFuYWdlci5yZW1vdmVFdmVudExpc3RuZXIoJ21vdXNlZG93bicsIHRoaXMuZ3JhcGguZHJhZ19zdGFydCk7CiAgICAgICAgdGhpcy5jYW52YXNNYW5hZ2VyLnJlbW92ZUV2ZW50TGlzdG5lcignbW91c2V1cCcsIHRoaXMuZ3JhcGguZHJhZ19lbmQpOwogICAgICAgIHRoaXMuY2FudmFzTWFuYWdlci5yZW1vdmVFdmVudExpc3RuZXIoJ2RibGNsaWNrJywgdGhpcy5ncmFwaC5kb3VibGVDbGljayk7CiAgICB9OwogICAgcmVzZXQgPSBhc3luYyAoKT0+ewogICAgICAgIGNvbnN0IHRlbXBOb2RlRGljdCA9IHsKICAgICAgICB9OwogICAgICAgIGlmICh0aGlzLnRhcmdldC5oYXNoICE9ICI1NDVlYTUzODQ2MTAwM2VmZGM4YzgxYzI0NDUzMWIwMDNmNmYyNmNmY2NmNmMwMDczYjMyMzlmZGVkZjQ5NDQ2IikgewogICAgICAgICAgICBjb25zdCBjcml0ZXJpYSA9IE5vZGVUb0ZvcmNlTm9kZSh0aGlzLnRhcmdldCk7CiAgICAgICAgICAgIGNyaXRlcmlhLm1vdmFibGUgPSBmYWxzZTsKICAgICAgICAgICAgdGVtcE5vZGVEaWN0W3RoaXMudGFyZ2V0Lmhhc2hdID0gY3JpdGVyaWE7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGxpbmtzID0gR2V0Tm9kZUVkZ2VzKHRoaXMudGFyZ2V0KTsKICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IFtoYXNoNCwgZWRnZV0gb2YgbGlua3MpewogICAgICAgICAgICBjb25zdCBhID0gYXdhaXQgdGhpcy5mZXRjaE5vZGUoaGFzaDQpOwogICAgICAgICAgICBpZiAoYSkgewogICAgICAgICAgICAgICAgaWYgKGEuaGFzaCAhPSAiNTQ1ZWE1Mzg0NjEwMDNlZmRjOGM4MWMyNDQ1MzFiMDAzZjZmMjZjZmNjZjZjMDA3M2IzMjM5ZmRlZGY0OTQ0NiIpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wTm9kZURpY3RbYS5oYXNoXSA9IE5vZGVUb0ZvcmNlTm9kZShhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5jYW52YXNNYW5hZ2VyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmdyYXBoKSB7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmdyYXBoID0gbmV3IEdyYXBoKHRoaXMuY2FudmFzTWFuYWdlci5pZCgpLCAzMCwgdHJ1ZSwgZmFsc2UsIG51bGwsIHRoaXMuYWN0aXZhdGVOb2RlQ2FsbGJhY2ssIHRoaXMuZGVBY3RpdmF0ZU5vZGVDYWxsYmFjaywgdGhpcy5kb3VibGVDbGlja2VkTm9kZUNhbGxiYWNrKTsKICAgICAgICAgICAgICAgIHRoaXMuZ3JhcGhJZCA9IHRoaXMuZ3JhcGguaWQ7CiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhc01hbmFnZXIuYWRkRXZlbnRMaXN0bmVyKCdtb3VzZW1vdmUnLCB0aGlzLmdyYXBoLnBvaW50aW5nX2NoZWNrKTsKICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzTWFuYWdlci5hZGRFdmVudExpc3RuZXIoJ21vdXNlZG93bicsIHRoaXMuZ3JhcGguZHJhZ19zdGFydCk7CiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhc01hbmFnZXIuYWRkRXZlbnRMaXN0bmVyKCdtb3VzZXVwJywgdGhpcy5ncmFwaC5kcmFnX2VuZCk7CiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhc01hbmFnZXIuYWRkRXZlbnRMaXN0bmVyKCdkYmxjbGljaycsIHRoaXMuZ3JhcGguZG91YmxlQ2xpY2spOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucmVidWlsZEdyYXBoKHRoaXMubm9kZXMsIHRlbXBOb2RlRGljdCk7CiAgICAgICAgfQogICAgfTsKICAgIGFjdGl2YXRlTm9kZUNhbGxiYWNrID0gYXN5bmMgKGRlYWN0aXZhdGVOb2RlLCBhY3RpdmF0ZU5vZGUpPT57CiAgICAgICAgY29uc3Qgbm9kZSA9IGF3YWl0IHRoaXMuZmV0Y2hOb2RlKGFjdGl2YXRlTm9kZS5oYXNoKTsKICAgICAgICBpZiAobm9kZSkgewogICAgICAgICAgICB0aGlzLm9uTm9kZVNlbGVjdGVkT2ZWaWV3KG5vZGUpOwogICAgICAgIH0KICAgIH07CiAgICBkZUFjdGl2YXRlTm9kZUNhbGxiYWNrID0gKGRlYWN0aXZhdGVOb2RlKT0+ewogICAgfTsKICAgIGRvdWJsZUNsaWNrZWROb2RlQ2FsbGJhY2sgPSAobm9kZSk9PnsKICAgICAgICB0aGlzLm5leHRHcmFwaFJlbmRlcihub2RlLmhhc2gpOwogICAgfTsKICAgIHJlbG9hZCA9IGFzeW5jICgpPT57CiAgICAgICAgY29uc3QgcmVsYW9kZWRUYXJnZXQgPSBhd2FpdCB0aGlzLmZldGNoTm9kZSh0aGlzLnRhcmdldC5oYXNoKTsKICAgICAgICBpZiAocmVsYW9kZWRUYXJnZXQpIHRoaXMudGFyZ2V0ID0gcmVsYW9kZWRUYXJnZXQ7CiAgICAgICAgYXdhaXQgdGhpcy5yZXNldCgpOwogICAgfTsKICAgIGdyYXBoVXBkYXRlVGltZXIgPSAwOwogICAgdXBkYXRlID0gKCk9PnsKICAgICAgICBpZiAodGhpcy5pc1JlYnVpbGRpbmcpIHJldHVybjsKICAgICAgICBpZiAodGhpcy51cGRhdGFpbmcpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCLliY3lm57jga7jgrDjg6njg5XjgqLjg4Pjg5fjg4fjg7zjg4jjgYzoqLHlrrnmmYLplpPlhoXjgavntYLkuobjgZfjgabjgYTjgarjgYTjgaPjgb3jgYQiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnVwZGF0YWluZyA9IHRydWU7CiAgICAgICAgdGhpcy5Ub1N0YWJsZUdyYXBoKCk7CiAgICAgICAgdGhpcy51cGRhdGFpbmcgPSBmYWxzZTsKICAgIH07CiAgICBkcmF3ID0gKCk9PnsKICAgICAgICBpZiAodGhpcy5ncmFwaCkgewogICAgICAgICAgICB0aGlzLmdyYXBoLmRyYXcoKTsKICAgICAgICB9CiAgICB9OwogICAgVG9TdGFibGVHcmFwaCA9ICgpPT57CiAgICAgICAgT2JqZWN0LmVudHJpZXModGhpcy5ncmFwaE5vZGVzKS5mb3JFYWNoKChbaGFzaDQsIGdyYXBoTm9kZV0pPT57CiAgICAgICAgICAgIHRoaXMubm9kZXNbaGFzaDRdLnggPSBncmFwaE5vZGUueDsKICAgICAgICAgICAgdGhpcy5ub2Rlc1toYXNoNF0ueSA9IGdyYXBoTm9kZS55OwogICAgICAgIH0pOwogICAgICAgIHRoaXMubm9kZXMgPSBGb3JjZUdyYXBoVXBkYXRlKHRoaXMubm9kZXMsIHRoaXMuY2FudmFzTWFuYWdlci5oZWlnaHQoKSwgdGhpcy5jYW52YXNNYW5hZ2VyLndpZHRoKCkpOwogICAgICAgIE9iamVjdC5lbnRyaWVzKHRoaXMubm9kZXMpLmZvckVhY2goKFtoYXNoNCwgbm9kZV0pPT57CiAgICAgICAgICAgIHRoaXMuZ3JhcGhOb2Rlc1toYXNoNF0ueCA9IG5vZGUueDsKICAgICAgICAgICAgdGhpcy5ncmFwaE5vZGVzW2hhc2g0XS55ID0gbm9kZS55OwogICAgICAgIH0pOwogICAgfTsKICAgIHJlYnVpbGRHcmFwaCA9IChiZWZvcmVOb2RlRGljdCwgbm9kZXMpPT57CiAgICAgICAgaWYgKGlzTnVsbCh0aGlzLmdyYXBoKSkgcmV0dXJuOwogICAgICAgIHRoaXMuaXNSZWJ1aWxkaW5nID0gdHJ1ZTsKICAgICAgICBHcmFwaC5DbGVhcih0aGlzLmdyYXBoSWQpOwogICAgICAgIHRoaXMuZ3JhcGhOb2RlcyA9IHsKICAgICAgICB9OwogICAgICAgIGNvbnN0IGdyYXBoID0gdGhpcy5ncmFwaDsKICAgICAgICBPYmplY3QudmFsdWVzKG5vZGVzKS5mb3JFYWNoKChmb3JjZU5vZGUpPT57CiAgICAgICAgICAgIGlmIChiZWZvcmVOb2RlRGljdFtmb3JjZU5vZGUubm9kZUhhc2hdKSB7CiAgICAgICAgICAgICAgICBmb3JjZU5vZGUueCA9IGJlZm9yZU5vZGVEaWN0W2ZvcmNlTm9kZS5ub2RlSGFzaF0ueDsKICAgICAgICAgICAgICAgIGZvcmNlTm9kZS55ID0gYmVmb3JlTm9kZURpY3RbZm9yY2VOb2RlLm5vZGVIYXNoXS55OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZm9yY2VOb2RlLnggPSBSYW5nZVJhbmRvbSgwLCB0aGlzLmNhbnZhc01hbmFnZXIud2lkdGgoKSk7CiAgICAgICAgICAgICAgICBmb3JjZU5vZGUueSA9IFJhbmdlUmFuZG9tKDAsIHRoaXMuY2FudmFzTWFuYWdlci5oZWlnaHQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZ3JhcGhOb2RlID0gZ3JhcGgubm9kZShmb3JjZU5vZGUueCwgZm9yY2VOb2RlLnksIDQwLCAiIiwgZm9yY2VOb2RlLm5vZGVIYXNoKTsKICAgICAgICAgICAgY29uc29sZS5sb2coYG1ha2Ugbm9kZSAke2ZvcmNlTm9kZS50aXRsZX1gKTsKICAgICAgICAgICAgaWYgKGlzTnVsbChncmFwaE5vZGUpKSByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICBpZiAoZm9yY2VOb2RlLnRodW1ibmFpbCAhPSAiIikgewogICAgICAgICAgICAgICAgZ3JhcGhOb2RlLnNldEltYWdlKGZvcmNlTm9kZS50aHVtYm5haWwpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZ3JhcGhOb2RlLnNldFRleHQoZm9yY2VOb2RlLnRpdGxlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmdyYXBoTm9kZXNbZm9yY2VOb2RlLm5vZGVIYXNoXSA9IGdyYXBoTm9kZTsKICAgICAgICB9KTsKICAgICAgICBPYmplY3QudmFsdWVzKG5vZGVzKS5mb3JFYWNoKChmb3JjZU5vZGUpPT57CiAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGZvcmNlTm9kZS5saW5rcykuZm9yRWFjaCgoW2tleTIsIGVkZ2VdKT0+ewogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0MSA9IG5vZGVzW2tleTJdOwogICAgICAgICAgICAgICAgaWYgKCFpc051bGwodGFyZ2V0MSkgJiYgdGhpcy5ncmFwaE5vZGVzW3RhcmdldDEubm9kZUhhc2hdICYmIGZvcmNlTm9kZS5ub2RlSGFzaCAhPSB0YXJnZXQxLm5vZGVIYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IHRhcmdldDE7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYG1ha2UgZWRnZSAke2ZvcmNlTm9kZS50aXRsZX0gLT4gJHt0LnRpdGxlfWApOwogICAgICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGVkZ2UpLmZvckVhY2goKFtsYWJlbCwgd2VpZ2h0XSk9PnsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmFwaE5vZGVzW2ZvcmNlTm9kZS5ub2RlSGFzaF0uYmlEaXJlY3Rpb25hbCh0aGlzLmdyYXBoTm9kZXNbdC5ub2RlSGFzaF0sICIiKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ub2RlcyA9IG5vZGVzOwogICAgICAgIHRoaXMuaXNSZWJ1aWxkaW5nID0gZmFsc2U7CiAgICB9Owp9CmNvbnN0IHZpZXdlclJlcXVlc3RPZlJlbW90ZUdldCA9IGFzeW5jIChoYXNoNCwgZm9yY2UgPSBmYWxzZSk9PnsKICAgIGNvbnN0IHBhdGhTdHJ1Y3QgPSBtZXRhUmVzb3VyY2VQYXRoKGhhc2g0KTsKICAgIGlmIChyZW1vdGVTdG9yYWdlVVJMID09ICIiKSB7CiAgICAgICAgY29uc29sZS53YXJuKGBcclxuICAgIOODquODouODvOODiOOCueODiOODrOODvOOCuOODkeOCueOBjOioreWumuOBleOCjOOBpuOBhOOBvuOBm+OCk+OAglxyXG4gICAgSFRNTOWGheOBp+S4i+iomOOBruS+i+OBruOCiOOBhuOBq+ODjuODvOODieaDheWgseOBrumFjee9ruWgtOaJgOOCkuWumue+qeOBl+OBpuOBj+OBoOOBleOBhOOAglxyXG4gICAg5L6LOlxyXG4gICAgdmFyIHJlbW90ZVN0b3JhZ2VVUkwgPSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYmFWb2phZ2FudG8vaG9nZVJlcG9zaXRvcnkvbWFpbi8iXHJcbiAgICBgKTsKICAgIH0KICAgIGNvbnN0IHBhdGggPSByZW1vdGVTdG9yYWdlVVJMICsgcGF0aFN0cnVjdC5wcmVmaXggKyBwYXRoU3RydWN0Lmhhc2hEaXIgKyBwYXRoU3RydWN0Lmhhc2ggKyBwYXRoU3RydWN0LmV4dGVudGlvbjsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgR2V0UmVxdWVzdChwYXRoKTsKICAgIGlmIChpc051bGwocmVzcG9uc2UpKSByZXR1cm4gW107CiAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwogICAgY29uc29sZS5sb2coanNvbik7CiAgICBpZiAoTm9kZTEudmFsaWRhdGlvbihqc29uKSkgewogICAgICAgIGNvbnNvbGUubG9nKGByZW1vdGVHZXQ6ICR7anNvbn1gKTsKICAgICAgICBjb25zdCBub2RlQXJyYXkgPSBbCiAgICAgICAgICAgIGpzb24KICAgICAgICBdOwogICAgICAgIHJldHVybiBub2RlQXJyYXk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUud2FybigiTm9kZeOBqOOBl+OBpuino+mHiOOBp+OBjeOBquOBhOOCguOBruOCkuWPluW+l+OBl+OBvuOBl+OBnyIpOwogICAgICAgIHJldHVybiBbXTsKICAgIH0KfTsKY2xhc3MgVmlld2VyQXBwbGljYXRpb24gewogICAgZG9jdW1lbnQ7CiAgICBjb250YWluZXJOb2RlOwogICAgc3RvcmUgPSBuZXcgU3RvcmVkTm9kZXMoKTsKICAgIHNjb3BlR3JhcGhIaXN0b3J5ID0gbmV3IFNjb3BlR3JhcGhNYW5hZ2VyKCk7CiAgICBnbG9iYWxNZW51OwogICAgY2FudmFzTWFuYWdlcjsKICAgIGxvY2FsTWVudTsKICAgIHVwZGF0ZUZ1bmN0aW9ucyA9IFtdOwogICAgY29uc3RydWN0b3IoZG9jdW1lbnQyLCBjb250YWluZXJOb2RlKXsKICAgICAgICB0aGlzLmRvY3VtZW50ID0gZG9jdW1lbnQyOwogICAgICAgIHRoaXMuY29udGFpbmVyTm9kZSA9IGNvbnRhaW5lck5vZGU7CiAgICAgICAgdGhpcy5zdG9yZS5zZXRSZW1vdGVHZXRNZXRob2Qodmlld2VyUmVxdWVzdE9mUmVtb3RlR2V0KTsKICAgICAgICB0aGlzLnNjb3BlR3JhcGhIaXN0b3J5ID0gbmV3IFNjb3BlR3JhcGhNYW5hZ2VyKCk7CiAgICAgICAgdGhpcy5jYW52YXNNYW5hZ2VyID0gbmV3IENhbnZhc01hbmFnZXIodGhpcy5kb2N1bWVudCwgdGhpcy5jb250YWluZXJOb2RlKTsKICAgIH0KICAgIGluaXQgPSAoKT0+ewogICAgICAgIGlmIChpc051bGwodGhpcy5jYW52YXNNYW5hZ2VyKSB8fCBpc051bGwodGhpcy5jYW52YXNNYW5hZ2VyLmdyYXBoQ2FudmFzKSkgcmV0dXJuOwogICAgICAgIHRoaXMuY2FudmFzTWFuYWdlci5pbml0KCk7CiAgICAgICAgY29uc3QgZW50cnlQb2ludCA9IGJ1ZmZlclRvSGFzaCgiZW50cnlQb2ludCIpOwogICAgICAgIGNvbnN0IG4gPSBlbnRyeVBvaW50OwogICAgICAgIHRoaXMuc2NvcGVHcmFwaEhpc3RvcnkuZGVwZW5kYW5jeU1vZHVsZUluamVjdGlvbih0aGlzLmNhbnZhc01hbmFnZXIsIHRoaXMuc3RvcmUsIHRoaXMuYWN0aXZhdGVOb2RlKTsKICAgICAgICB0aGlzLnNjb3BlR3JhcGhIaXN0b3J5LnJlc3RhcnQobik7CiAgICAgICAgdGhpcy51cGRhdGUoKTsKICAgICAgICB0aGlzLmdsb2JhbE1lbnUgPSBHbG9iYWxNZW51LmluaXQodGhpcy5kb2N1bWVudCwgdGhpcy5jb250YWluZXJOb2RlLCB0aGlzLnJlbG9hZCwgdGhpcy5zY29wZUdyYXBoSGlzdG9yeSk7CiAgICAgICAgY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdsb2NhbG1lbnUtZGl2JywgTG9jYWxNZW51LCB7CiAgICAgICAgICAgIGV4dGVuZHM6ICdkaXYnCiAgICAgICAgfSk7CiAgICAgICAgY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdub2RlLWRldGFpbC1kaXYnLCBOb2RlRGV0YWlsLCB7CiAgICAgICAgICAgIGV4dGVuZHM6ICdkaXYnCiAgICAgICAgfSk7CiAgICB9OwogICAgcmVsb2FkID0gYXN5bmMgKCk9PnsKICAgICAgICBhd2FpdCB0aGlzLnNjb3BlR3JhcGhIaXN0b3J5LmN1cnJlbnRTY29wZVJlbG9hZCgpOwogICAgICAgIGlmICghaXNOdWxsKHRoaXMubG9jYWxNZW51KSkgewogICAgICAgICAgICB0aGlzLmxvY2FsTWVudS5yZWxvYWREZXRhaWwoKTsKICAgICAgICB9CiAgICB9OwogICAgYWN0aXZhdGVOb2RlID0gKG5vZGUpPT57CiAgICAgICAgaWYgKGlzTnVsbCh0aGlzLmxvY2FsTWVudSkpIHsKICAgICAgICAgICAgdGhpcy5sb2NhbE1lbnUgPSBuZXcgTG9jYWxNZW51KHRoaXMuc3RvcmUudGFnSGFzaERpY3QsIHRoaXMuc3RvcmUuZmV0Y2gsIHRoaXMuc3RvcmUudXBkYXRlLCB0aGlzLnJlbG9hZCk7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyTm9kZS5hcHBlbmRDaGlsZCh0aGlzLmxvY2FsTWVudSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubG9jYWxNZW51LnNldERldGFpbChub2RlKTsKICAgIH07CiAgICBzZXRVcGRhdGVGdW5jdGlvbiA9IChmbik9PnsKICAgICAgICB0aGlzLnVwZGF0ZUZ1bmN0aW9ucy5wdXNoKGZuKTsKICAgIH07CiAgICB1cGRhdGUgPSAoKT0+ewogICAgICAgIHRoaXMuY2FudmFzTWFuYWdlcj8udXBkYXRlKCk7CiAgICAgICAgdGhpcy5zY29wZUdyYXBoSGlzdG9yeS51cGRhdGUoKTsKICAgICAgICB0aGlzLnNjb3BlR3JhcGhIaXN0b3J5LmRyYXcoKTsKICAgICAgICB0aGlzLnVwZGF0ZUZ1bmN0aW9ucy5mb3JFYWNoKChlKT0+ewogICAgICAgICAgICBlKCk7CiAgICAgICAgfSk7CiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMudXBkYXRlKTsKICAgIH07Cn0KY2xhc3MgTG9jYWxNZW51IGV4dGVuZHMgSFRNTERpdkVsZW1lbnQgewogICAgZmV0Y2hOb2RlOwogICAgdXBkYXRlTm9kZTsKICAgIHJlbG9hZDsKICAgIGRldGFpbDsKICAgIGNvbnN0cnVjdG9yKHRhZ0hhc2hEaWN0MSwgZmV0Y2hOb2RlNCwgdXBkYXRlTm9kZTIsIHJlbG9hZDIpewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5mZXRjaE5vZGUgPSBmZXRjaE5vZGU0OwogICAgICAgIHRoaXMudXBkYXRlTm9kZSA9IHVwZGF0ZU5vZGUyOwogICAgICAgIHRoaXMucmVsb2FkID0gcmVsb2FkMjsKICAgICAgICB0aGlzLmlkID0gIm5ldHdvcmstZ3JhcGgtbG9jYWwtbWVudSI7CiAgICAgICAgdGhpcy5kZXRhaWwgPSBuZXcgTm9kZURldGFpbCh0aGlzLmZldGNoTm9kZSk7CiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmRldGFpbCk7CiAgICB9CiAgICBzZXREZXRhaWwobm9kZSkgewogICAgICAgIGlmIChpc051bGwodGhpcy5kZXRhaWwpKSByZXR1cm47CiAgICAgICAgdGhpcy5kZXRhaWwuc2V0RGV0YWlsKG5vZGUpOwogICAgfQogICAgcmVsb2FkRGV0YWlsKCkgewogICAgICAgIGlmICghaXNOdWxsKHRoaXMuZGV0YWlsKSkgewogICAgICAgICAgICB0aGlzLmRldGFpbC5yZWxvYWREZXRhaWwoKTsKICAgICAgICB9CiAgICB9Cn0KY2xhc3MgR2xvYmFsTWVudSB7CiAgICBkb2N1bWVudDsKICAgIHJvb3ROb2RlOwogICAgcmVsb2FkOwogICAgc2NvcGVNYW5hZ2VyOwogICAgY29uc3RydWN0b3IoZG9jdW1lbnQzLCByb290Tm9kZTIsIHJlbG9hZDMsIHNjb3BlTWFuYWdlcil7CiAgICAgICAgdGhpcy5kb2N1bWVudCA9IGRvY3VtZW50MzsKICAgICAgICB0aGlzLnJvb3ROb2RlID0gcm9vdE5vZGUyOwogICAgICAgIHRoaXMucmVsb2FkID0gcmVsb2FkMzsKICAgICAgICB0aGlzLnNjb3BlTWFuYWdlciA9IHNjb3BlTWFuYWdlcjsKICAgICAgICBjb25zdCB0b0FsbFNjb3BlID0gZG9jdW1lbnQzLmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgICAgIHRvQWxsU2NvcGUub25jbGljayA9ICgpPT57CiAgICAgICAgICAgIHRoaXMuc2NvcGVNYW5hZ2VyPy5yZXN0YXJ0KGJ1ZmZlclRvSGFzaCgibm9kZSIpKTsKICAgICAgICB9OwogICAgICAgIHRvQWxsU2NvcGUuaW5uZXJUZXh0ID0gYHRvQWxsU2NvcGVgOwogICAgICAgIHJvb3ROb2RlMi5hcHBlbmRDaGlsZCh0b0FsbFNjb3BlKTsKICAgICAgICBjb25zdCB0b1RhZ1Njb3BlID0gZG9jdW1lbnQzLmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgIHRvVGFnU2NvcGUub25jbGljayA9ICgpPT57CiAgICAgICAgICAgIHRoaXMuc2NvcGVNYW5hZ2VyPy5yZXN0YXJ0KGJ1ZmZlclRvSGFzaCgidGFnIikpOwogICAgICAgIH07CiAgICAgICAgdG9UYWdTY29wZS5pbm5lclRleHQgPSBgdG9UYWdTY29wZWA7CiAgICAgICAgcm9vdE5vZGUyLmFwcGVuZENoaWxkKHRvVGFnU2NvcGUpOwogICAgICAgIGNvbnN0IHRvQmxvYlNjb3BlID0gZG9jdW1lbnQzLmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgIHRvQmxvYlNjb3BlLm9uY2xpY2sgPSAoKT0+ewogICAgICAgICAgICB0aGlzLnNjb3BlTWFuYWdlcj8ucmVzdGFydChidWZmZXJUb0hhc2goImJsb2IiKSk7CiAgICAgICAgfTsKICAgICAgICB0b0Jsb2JTY29wZS5pbm5lclRleHQgPSBgdG9CbG9iU2NvcGVgOwogICAgICAgIHJvb3ROb2RlMi5hcHBlbmRDaGlsZCh0b0Jsb2JTY29wZSk7CiAgICAgICAgY29uc3QgdG9Ub2RheVNjb3BlID0gZG9jdW1lbnQzLmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgIHRvVG9kYXlTY29wZS5vbmNsaWNrID0gKCk9PnsKICAgICAgICAgICAgY29uc3QgcyA9IHRvZGF5U3RyaW5nKCk7CiAgICAgICAgICAgIGlmIChzKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNjb3BlTWFuYWdlcj8ucmVzdGFydChidWZmZXJUb0hhc2gocykpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB0b1RvZGF5U2NvcGUuaW5uZXJUZXh0ID0gYHRvVG9kYXlTY29wZWA7CiAgICAgICAgcm9vdE5vZGUyLmFwcGVuZENoaWxkKHRvVG9kYXlTY29wZSk7CiAgICB9CiAgICBzdGF0aWMgaW5pdCA9IChkb2N1bWVudDQsIHJvb3RFbGVtZW50LCByZWxvYWQ0LCBzY29wZU1hbmFnZXIxKT0+ewogICAgICAgIGNvbnN0IGdsb2JhbE1lbnUgPSBkb2N1bWVudDQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgaWYgKGlzTnVsbChnbG9iYWxNZW51KSkgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICBnbG9iYWxNZW51LmlkID0gIm5ldHdvcmstZ3JhcGgtZ2xvYmFsLW1lbnUiOwogICAgICAgIHJvb3RFbGVtZW50LmFwcGVuZENoaWxkKGdsb2JhbE1lbnUpOwogICAgICAgIGNvbnN0IGk1ID0gbmV3IEdsb2JhbE1lbnUoZG9jdW1lbnQ0LCBnbG9iYWxNZW51LCByZWxvYWQ0LCBzY29wZU1hbmFnZXIxKTsKICAgICAgICByZXR1cm4gaTU7CiAgICB9Owp9CndpbmRvdy5vbmxvYWQgPSAoKT0+ewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI25ldHdvcmstZ3JhcGgiKTsKICAgIGlmIChjb250YWluZXIpIHsKICAgICAgICBjb25zdCBhcHAgPSBuZXcgVmlld2VyQXBwbGljYXRpb24oZG9jdW1lbnQsIGNvbnRhaW5lcik7CiAgICAgICAgYXBwLmluaXQoKTsKICAgIH0KfTsK"></script>
</body>

</html>

<!--

* LICENSE

\`\`\`
MIT License

Copyright (c) 2021 ArbaVojaganto

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
\`\`\`

\`\`\`
MIT License

Copyright (c) 2020 Paul Fears

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
\`\`\`

\`\`\`
MIT License

Copyright 2018-2021 the Deno authors.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
\`\`\`

\`\`\`
  
Copyright (c) 2014 Masafumi Oyamada

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
\`\`\`
-->
`
addEventListener("fetch", (event: any) => {
  event.respondWith(
    new Response(html, {
      status: 200,
      headers: {
        server: "denosr",
        "content-type": "text/html",
      },
    })
  );
});
    